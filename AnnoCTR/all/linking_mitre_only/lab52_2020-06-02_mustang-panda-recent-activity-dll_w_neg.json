{"mention": "Mustang Panda", "context_left": "", "context_right": "Recent Activity: Dll-Sideloading trojans with temporal C2 servers", "_context_left": "", "_context_right": " Recent Activity: Dll-Sideloading trojans with temporal C2 servers", "sentence_left": "", "sentence_right": "June 02, 2020", "label": "[Mustang Panda](https://attack.mitre.org/groups/G0129) is a China-based cyber espionage threat actor that was first observed in 2017 but may have been conducting operations since at least 2014. [Mustang Panda](https://attack.mitre.org/groups/G0129) has targeted government entities, nonprofits, religious, and other non-governmental organizations in the U.S., Germany, Mongolia, Myanmar, Pakistan, and Vietnam, among others.(Citation: Crowdstrike MUSTANG PANDA June 2018)(Citation: Anomali MUSTANG PANDA October 2019)(Citation: Secureworks BRONZE PRESIDENT December 2019)", "label_id": 1139, "label_title": "Mustang Panda", "label_link": "https://attack.mitre.org/groups/G0129", "entity_class": "CE", "entity_type": "GROUP", "document": "lab52_2020-06-02_mustang-panda-recent-activity-dll"}
{"mention": "Dll-Sideloading trojans", "context_left": "Mustang Panda Recent Activity:", "context_right": "with temporal C2 servers", "_context_left": "Mustang Panda Recent Activity: ", "_context_right": " with temporal C2 servers", "sentence_left": "", "sentence_right": "June 02, 2020", "label": "Adversaries may execute their own malicious payloads by hijacking the way operating systems run programs. Hijacking execution flow can be for the purposes of persistence, since this hijacked execution may reoccur over time. Adversaries may also use these mechanisms to elevate privileges or evade defenses, such as application control or other restrictions on execution. There are many ways an adversary may hijack the flow of execution, including by manipulating how the operating system locates programs to be executed. How the operating system locates libraries to be used by a program can also be intercepted. Locations where the operating system looks for programs/resources, such as file directories and in the case of Windows the Registry, could also be poisoned to include malicious payloads.", "label_id": 185, "label_title": "Hijack Execution Flow", "label_link": "https://attack.mitre.org/techniques/T1574", "entity_class": "CE", "entity_type": "TECHNIQUE", "document": "lab52_2020-06-02_mustang-panda-recent-activity-dll"}
{"mention": "C2", "context_left": "Mustang Panda Recent Activity: Dll-Sideloading trojans with temporal", "context_right": "servers", "_context_left": "Mustang Panda Recent Activity: Dll-Sideloading trojans with temporal ", "_context_right": " servers", "sentence_left": "", "sentence_right": "June 02, 2020", "label": "The adversary is trying to communicate with compromised systems to control them. Command and Control consists of techniques that adversaries may use to communicate with systems under their control within a victim network. Adversaries commonly attempt to mimic normal, expected traffic to avoid detection. There are many ways an adversary can establish command and control with various levels of stealth depending on the victim’s network structure and defenses.", "label_id": 581, "label_title": "Command and Control", "label_link": "https://attack.mitre.org/tactics/TA0011", "entity_class": "CE", "entity_type": "TACTIC", "document": "lab52_2020-06-02_mustang-panda-recent-activity-dll"}
{"mention": "Dll-Sideload technique with a legitimate binary, to load a threat", "context_left": "Recently, from Lab52 we have detected a recent malware sample, using the", "context_right": ".", "_context_left": "Recently, from Lab52 we have detected a recent malware sample, using the ", "_context_right": ".", "sentence_left": "June 02, 2020", "sentence_right": "This particular sample has a very small DLL, that loads an encrypted file, which after being decrypted consists of a sample of the PlugX Trojan.", "label": "Adversaries may execute their own malicious payloads by hijacking the way operating systems run programs. Hijacking execution flow can be for the purposes of persistence, since this hijacked execution may reoccur over time. Adversaries may also use these mechanisms to elevate privileges or evade defenses, such as application control or other restrictions on execution. There are many ways an adversary may hijack the flow of execution, including by manipulating how the operating system locates programs to be executed. How the operating system locates libraries to be used by a program can also be intercepted. Locations where the operating system looks for programs/resources, such as file directories and in the case of Windows the Registry, could also be poisoned to include malicious payloads.", "label_id": 185, "label_title": "Hijack Execution Flow", "label_link": "https://attack.mitre.org/techniques/T1574", "entity_class": "CE", "entity_type": "TECHNIQUE", "document": "lab52_2020-06-02_mustang-panda-recent-activity-dll"}
{"mention": "with a legitimate binary", "context_left": "Recently, from Lab52 we have detected a recent malware sample, using the Dll-Sideload technique", "context_right": ", to load a threat.", "_context_left": "Recently, from Lab52 we have detected a recent malware sample, using the Dll-Sideload technique ", "_context_right": ", to load a threat.", "sentence_left": "June 02, 2020", "sentence_right": "This particular sample has a very small DLL, that loads an encrypted file, which after being decrypted consists of a sample of the PlugX Trojan.", "label": "Adversaries may attempt to manipulate features of their artifacts to make them appear legitimate or benign to users and/or security tools. Masquerading occurs when the name or location of an object, legitimate or malicious, is manipulated or abused for the sake of evading defenses and observation. This may include manipulating file metadata, tricking users into misidentifying the file type, and giving legitimate task or service names. Renaming abusable system utilities to evade security monitoring is also a form of [Masquerading](https://attack.mitre.org/techniques/T1036).(Citation: LOLBAS Main Site)", "label_id": 142, "label_title": "Masquerading", "label_link": "https://attack.mitre.org/techniques/T1036", "entity_class": "CI", "entity_type": "TECHNIQUE", "document": "lab52_2020-06-02_mustang-panda-recent-activity-dll"}
{"mention": "PlugX", "context_left": "This particular sample has a very small DLL, that loads an encrypted file, which after being decrypted consists of a sample of the", "context_right": "Trojan.", "_context_left": "This particular sample has a very small DLL, that loads an encrypted file, which after being decrypted consists of a sample of the ", "_context_right": " Trojan.", "sentence_left": "Recently, from Lab52 we have detected a recent malware sample, using the Dll-Sideload technique with a legitimate binary, to load a threat.", "sentence_right": "This technique, and final threat together, consists of one of the most common TTPs among some APT groups generally of Chinese origin such as APT1, APT27 and Mustang Panda.", "label": "[PlugX](https://attack.mitre.org/software/S0013) is a remote access tool (RAT) that uses modular plugins. It has been used by multiple threat groups. (Citation: Lastline PlugX Analysis) (Citation: FireEye Clandestine Fox Part 2) (Citation: New DragonOK) (Citation: Dell TG-3390)", "label_id": 861, "label_title": "PlugX", "label_link": "https://attack.mitre.org/software/S0013", "entity_class": "CE", "entity_type": "MALWARE", "document": "lab52_2020-06-02_mustang-panda-recent-activity-dll"}
{"mention": "very small DLL, that loads an encrypted file", "context_left": "This particular sample has a", "context_right": ", which after being decrypted consists of a sample of the PlugX Trojan.", "_context_left": "This particular sample has a ", "_context_right": ", which after being decrypted consists of a sample of the PlugX Trojan.", "sentence_left": "Recently, from Lab52 we have detected a recent malware sample, using the Dll-Sideload technique with a legitimate binary, to load a threat.", "sentence_right": "This technique, and final threat together, consists of one of the most common TTPs among some APT groups generally of Chinese origin such as APT1, APT27 and Mustang Panda.", "label": "Adversaries may execute their own malicious payloads by hijacking the way operating systems run programs. Hijacking execution flow can be for the purposes of persistence, since this hijacked execution may reoccur over time. Adversaries may also use these mechanisms to elevate privileges or evade defenses, such as application control or other restrictions on execution. There are many ways an adversary may hijack the flow of execution, including by manipulating how the operating system locates programs to be executed. How the operating system locates libraries to be used by a program can also be intercepted. Locations where the operating system looks for programs/resources, such as file directories and in the case of Windows the Registry, could also be poisoned to include malicious payloads.", "label_id": 185, "label_title": "Hijack Execution Flow", "label_link": "https://attack.mitre.org/techniques/T1574", "entity_class": "CI", "entity_type": "TECHNIQUE", "document": "lab52_2020-06-02_mustang-panda-recent-activity-dll"}
{"mention": "after being decrypted", "context_left": "This particular sample has a very small DLL, that loads an encrypted file, which", "context_right": "consists of a sample of the PlugX Trojan.", "_context_left": "This particular sample has a very small DLL, that loads an encrypted file, which ", "_context_right": " consists of a sample of the PlugX Trojan.", "sentence_left": "Recently, from Lab52 we have detected a recent malware sample, using the Dll-Sideload technique with a legitimate binary, to load a threat.", "sentence_right": "This technique, and final threat together, consists of one of the most common TTPs among some APT groups generally of Chinese origin such as APT1, APT27 and Mustang Panda.", "label": "Adversaries may use [Obfuscated Files or Information](https://attack.mitre.org/techniques/T1027) to hide artifacts of an intrusion from analysis. They may require separate mechanisms to decode or deobfuscate that information depending on how they intend to use it. Methods for doing that include built-in functionality of malware or by using utilities present on the system. One such example is use of [certutil](https://attack.mitre.org/software/S0160) to decode a remote access tool portable executable file that has been hidden inside a certificate file. (Citation: Malwarebytes Targeted Attack against Saudi Arabia) Another example is using the Windows <code>copy /b</code> command to reassemble binary fragments into a malicious payload. (Citation: Carbon Black Obfuscation Sept 2016) Sometimes a user's action may be required to open it for deobfuscation or decryption as part of [User Execution](https://attack.mitre.org/techniques/T1204). The user may also be required to input a password to open a password protected compressed/encrypted file that was provided by the adversary. (Citation: Volexity PowerDuke November 2016)", "label_id": 514, "label_title": "Deobfuscate/Decode Files or Information", "label_link": "https://attack.mitre.org/techniques/T1140", "entity_class": "CI", "entity_type": "TECHNIQUE", "document": "lab52_2020-06-02_mustang-panda-recent-activity-dll"}
{"mention": "APT1", "context_left": "This technique, and final threat together, consists of one of the most common TTPs among some APT groups generally of Chinese origin such as", "context_right": ", APT27 and Mustang Panda.", "_context_left": "This technique, and final threat together, consists of one of the most common TTPs among some APT groups generally of Chinese origin such as ", "_context_right": ", APT27 and Mustang Panda.", "sentence_left": "This particular sample has a very small DLL, that loads an encrypted file, which after being decrypted consists of a sample of the PlugX Trojan.", "sentence_right": "The sample in question is downloaded from the following link “http://miandfish.]store/player/install\\_flash\\_player.exe” and although in previous months, it had another hash, currently the sample hosted under that name has the following hash “c56ac01b3af452fedc0447d9e0fe184d093d3fd3c6631aa8182c752463de570c”.", "label": "[APT1](https://attack.mitre.org/groups/G0006) is a Chinese threat group that has been attributed to the 2nd Bureau of the People’s Liberation Army (PLA) General Staff Department’s (GSD) 3rd Department, commonly known by its Military Unit Cover Designator (MUCD) as Unit 61398. (Citation: Mandiant APT1)", "label_id": 1174, "label_title": "APT1", "label_link": "https://attack.mitre.org/groups/G0006", "entity_class": "CE", "entity_type": "GROUP", "document": "lab52_2020-06-02_mustang-panda-recent-activity-dll"}
{"mention": "APT27", "context_left": "This technique, and final threat together, consists of one of the most common TTPs among some APT groups generally of Chinese origin such as APT1,", "context_right": "and Mustang Panda.", "_context_left": "This technique, and final threat together, consists of one of the most common TTPs among some APT groups generally of Chinese origin such as APT1, ", "_context_right": " and Mustang Panda.", "sentence_left": "This particular sample has a very small DLL, that loads an encrypted file, which after being decrypted consists of a sample of the PlugX Trojan.", "sentence_right": "The sample in question is downloaded from the following link “http://miandfish.]store/player/install\\_flash\\_player.exe” and although in previous months, it had another hash, currently the sample hosted under that name has the following hash “c56ac01b3af452fedc0447d9e0fe184d093d3fd3c6631aa8182c752463de570c”.", "label": "Emissary Panda", "label_id": 1335, "label_title": "Emissary Panda", "label_link": "http://www.bosch.com#node1fvup9pj1x44", "entity_class": "CE", "entity_type": "GROUP", "document": "lab52_2020-06-02_mustang-panda-recent-activity-dll"}
{"mention": "Mustang Panda", "context_left": "This technique, and final threat together, consists of one of the most common TTPs among some APT groups generally of Chinese origin such as APT1, APT27 and", "context_right": ".", "_context_left": "This technique, and final threat together, consists of one of the most common TTPs among some APT groups generally of Chinese origin such as APT1, APT27 and ", "_context_right": ".", "sentence_left": "This particular sample has a very small DLL, that loads an encrypted file, which after being decrypted consists of a sample of the PlugX Trojan.", "sentence_right": "The sample in question is downloaded from the following link “http://miandfish.]store/player/install\\_flash\\_player.exe” and although in previous months, it had another hash, currently the sample hosted under that name has the following hash “c56ac01b3af452fedc0447d9e0fe184d093d3fd3c6631aa8182c752463de570c”.", "label": "[Mustang Panda](https://attack.mitre.org/groups/G0129) is a China-based cyber espionage threat actor that was first observed in 2017 but may have been conducting operations since at least 2014. [Mustang Panda](https://attack.mitre.org/groups/G0129) has targeted government entities, nonprofits, religious, and other non-governmental organizations in the U.S., Germany, Mongolia, Myanmar, Pakistan, and Vietnam, among others.(Citation: Crowdstrike MUSTANG PANDA June 2018)(Citation: Anomali MUSTANG PANDA October 2019)(Citation: Secureworks BRONZE PRESIDENT December 2019)", "label_id": 1139, "label_title": "Mustang Panda", "label_link": "https://attack.mitre.org/groups/G0129", "entity_class": "CE", "entity_type": "GROUP", "document": "lab52_2020-06-02_mustang-panda-recent-activity-dll"}
{"mention": "PlugX", "context_left": "The binary consists of an installer, which drops in the folder “C:\\ProgramData\\AAM Updatesnnk” the legitimate binary vulnerable to dll sideload, the small dll that acts as a loader for the final threat, and the binary file, which consists of the encrypted", "context_right": "sample.", "_context_left": "The binary consists of an installer, which drops in the folder “C:\\ProgramData\\AAM Updatesnnk” the legitimate binary vulnerable to dll sideload, the small dll that acts as a loader for the final threat, and the binary file, which consists of the encrypted ", "_context_right": " sample.", "sentence_left": "The sample in question is downloaded from the following link “http://miandfish.]store/player/install\\_flash\\_player.exe” and although in previous months, it had another hash, currently the sample hosted under that name has the following hash “c56ac01b3af452fedc0447d9e0fe184d093d3fd3c6631aa8182c752463de570c”.", "sentence_right": "![](https://lab52.io/blog/wp-content/uploads/2019/08/Captura-de-pantalla-de-2020-05-19-17-05-20-2.png)", "label": "[PlugX](https://attack.mitre.org/software/S0013) is a remote access tool (RAT) that uses modular plugins. It has been used by multiple threat groups. (Citation: Lastline PlugX Analysis) (Citation: FireEye Clandestine Fox Part 2) (Citation: New DragonOK) (Citation: Dell TG-3390)", "label_id": 861, "label_title": "PlugX", "label_link": "https://attack.mitre.org/software/S0013", "entity_class": "CE", "entity_type": "MALWARE", "document": "lab52_2020-06-02_mustang-panda-recent-activity-dll"}
{"mention": "binary vulnerable to dll sideload, the small dll that acts as a loader for the final threat", "context_left": "The binary consists of an installer, which drops in the folder “C:\\ProgramData\\AAM Updatesnnk” the legitimate", "context_right": ", and the binary file, which consists of the encrypted PlugX sample.", "_context_left": "The binary consists of an installer, which drops in the folder “C:\\ProgramData\\AAM Updatesnnk” the legitimate ", "_context_right": ", and the binary file, which consists of the encrypted PlugX sample.", "sentence_left": "The sample in question is downloaded from the following link “http://miandfish.]store/player/install\\_flash\\_player.exe” and although in previous months, it had another hash, currently the sample hosted under that name has the following hash “c56ac01b3af452fedc0447d9e0fe184d093d3fd3c6631aa8182c752463de570c”.", "sentence_right": "![](https://lab52.io/blog/wp-content/uploads/2019/08/Captura-de-pantalla-de-2020-05-19-17-05-20-2.png)", "label": "Adversaries may execute their own malicious payloads by hijacking the way operating systems run programs. Hijacking execution flow can be for the purposes of persistence, since this hijacked execution may reoccur over time. Adversaries may also use these mechanisms to elevate privileges or evade defenses, such as application control or other restrictions on execution. There are many ways an adversary may hijack the flow of execution, including by manipulating how the operating system locates programs to be executed. How the operating system locates libraries to be used by a program can also be intercepted. Locations where the operating system looks for programs/resources, such as file directories and in the case of Windows the Registry, could also be poisoned to include malicious payloads.", "label_id": 185, "label_title": "Hijack Execution Flow", "label_link": "https://attack.mitre.org/techniques/T1574", "entity_class": "CI", "entity_type": "TECHNIQUE", "document": "lab52_2020-06-02_mustang-panda-recent-activity-dll"}
{"mention": "deploying the three files, the installer runs the legitimate binary", "context_left": "After", "context_right": ", causing the final PlugX threat to be loaded by it.", "_context_left": "After ", "_context_right": ", causing the final PlugX threat to be loaded by it.", "sentence_left": "![](https://lab52.io/blog/wp-content/uploads/2019/08/Captura-de-pantalla-de-2020-05-19-17-05-20-2.png)", "sentence_right": "![](https://lab52.io/blog/wp-content/uploads/2019/08/Captura-de-pantalla-de-2020-05-19-17-07-14-3.png)", "label": "The adversary is trying to run malicious code. Execution consists of techniques that result in adversary-controlled code running on a local or remote system. Techniques that run malicious code are often paired with techniques from all other tactics to achieve broader goals, like exploring a network or stealing data. For example, an adversary might use a remote access tool to run a PowerShell script that does Remote System Discovery.", "label_id": 588, "label_title": "Execution", "label_link": "https://attack.mitre.org/tactics/TA0002", "entity_class": "CE", "entity_type": "TACTIC", "document": "lab52_2020-06-02_mustang-panda-recent-activity-dll"}
{"mention": "PlugX", "context_left": "After deploying the three files, the installer runs the legitimate binary, causing the final", "context_right": "threat to be loaded by it.", "_context_left": "After deploying the three files, the installer runs the legitimate binary, causing the final ", "_context_right": " threat to be loaded by it.", "sentence_left": "![](https://lab52.io/blog/wp-content/uploads/2019/08/Captura-de-pantalla-de-2020-05-19-17-05-20-2.png)", "sentence_right": "![](https://lab52.io/blog/wp-content/uploads/2019/08/Captura-de-pantalla-de-2020-05-19-17-07-14-3.png)", "label": "[PlugX](https://attack.mitre.org/software/S0013) is a remote access tool (RAT) that uses modular plugins. It has been used by multiple threat groups. (Citation: Lastline PlugX Analysis) (Citation: FireEye Clandestine Fox Part 2) (Citation: New DragonOK) (Citation: Dell TG-3390)", "label_id": 861, "label_title": "PlugX", "label_link": "https://attack.mitre.org/software/S0013", "entity_class": "CE", "entity_type": "MALWARE", "document": "lab52_2020-06-02_mustang-panda-recent-activity-dll"}
{"mention": "load any library named “hex.dll” that is next to the executable.", "context_left": "In this case, the legitimate vulnerable binary is part of Adobe’s Swite which will", "context_right": "", "_context_left": "In this case, the legitimate vulnerable binary is part of Adobe’s Swite which will ", "_context_right": "", "sentence_left": "![](https://lab52.io/blog/wp-content/uploads/2019/08/Captura-de-pantalla-de-2020-05-19-17-07-14-3.png)", "sentence_right": "![](https://lab52.io/blog/wp-content/uploads/2019/08/Captura-de-pantalla-de-2020-05-19-17-21-53-2.png)", "label": "Adversaries may execute their own malicious payloads by hijacking the way operating systems run programs. Hijacking execution flow can be for the purposes of persistence, since this hijacked execution may reoccur over time. Adversaries may also use these mechanisms to elevate privileges or evade defenses, such as application control or other restrictions on execution. There are many ways an adversary may hijack the flow of execution, including by manipulating how the operating system locates programs to be executed. How the operating system locates libraries to be used by a program can also be intercepted. Locations where the operating system looks for programs/resources, such as file directories and in the case of Windows the Registry, could also be poisoned to include malicious payloads.", "label_id": 185, "label_title": "Hijack Execution Flow", "label_link": "https://attack.mitre.org/techniques/T1574", "entity_class": "CE", "entity_type": "TECHNIQUE", "document": "lab52_2020-06-02_mustang-panda-recent-activity-dll"}
{"mention": "legitimate vulnerable binary is part of Adobe’s Swite", "context_left": "In this case, the", "context_right": "which will load any library named “hex.dll” that is next to the executable.", "_context_left": "In this case, the ", "_context_right": " which will load any library named “hex.dll” that is next to the executable.", "sentence_left": "![](https://lab52.io/blog/wp-content/uploads/2019/08/Captura-de-pantalla-de-2020-05-19-17-07-14-3.png)", "sentence_right": "![](https://lab52.io/blog/wp-content/uploads/2019/08/Captura-de-pantalla-de-2020-05-19-17-21-53-2.png)", "label": "Adversaries may exploit software vulnerabilities in client applications to execute code. Vulnerabilities can exist in software due to unsecure coding practices that can lead to unanticipated behavior. Adversaries can take advantage of certain vulnerabilities through targeted exploitation for the purpose of arbitrary code execution. Oftentimes the most valuable exploits to an offensive toolkit are those that can be used to obtain code execution on a remote system because they can be used to gain access to that system. Users will expect to see files related to the applications they commonly used to do work, so they are a useful target for exploit research and development because of their high utility. Several types exist: ### Browser-based Exploitation Web browsers are a common target through [Drive-by Compromise](https://attack.mitre.org/techniques/T1189) and [Spearphishing Link](https://attack.mitre.org/techniques/T1566/002). Endpoint systems may be compromised through normal web browsing or from certain users being targeted by links in spearphishing emails to adversary controlled sites used to exploit the web browser. These often do not require an action by the user for the exploit to be executed. ### Office Applications Common office and productivity applications such as Microsoft Office are also targeted through [Phishing](https://attack.mitre.org/techniques/T1566). Malicious files will be transmitted directly as attachments or through links to download them. These require the user to open the document or file for the exploit to run. ### Common Third-party Applications Other applications that are commonly seen or are part of the software deployed in a target network may also be used for exploitation. Applications such as Adobe Reader and Flash,", "label_id": 549, "label_title": "Exploitation for Client Execution", "label_link": "https://attack.mitre.org/techniques/T1203", "entity_class": "CI", "entity_type": "TECHNIQUE", "document": "lab52_2020-06-02_mustang-panda-recent-activity-dll"}
{"mention": "function that checks the existence of the .dat file", "context_left": "It has 4 exports that return 0 without doing anything, the Main function of the library, on the other hand, calls a", "context_right": "which is hardcoded (adobeupdate.dat in this case), loads it, extracts the first string of the binary and uses it as XOR key to decode the rest of the file, which consists on the final threat.", "_context_left": "It has 4 exports that return 0 without doing anything, the Main function of the library, on the other hand, calls a ", "_context_right": " which is hardcoded (adobeupdate.dat in this case), loads it, extracts the first string of the binary and uses it as XOR key to decode the rest of the file, which consists on the final threat.", "sentence_left": "![](https://lab52.io/blog/wp-content/uploads/2019/08/Captura-de-pantalla-de-2020-05-19-17-11-06-2.png)", "sentence_right": "The [following code](https://raw.githubusercontent.com/Bondey/PlugxScripts/master/PlugDecoder.py) in python imitates the logic of decoding:", "label": "Adversaries may enumerate files and directories or may search in specific locations of a host or network share for certain information within a file system. Adversaries may use the information from [File and Directory Discovery](https://attack.mitre.org/techniques/T1083) during automated discovery to shape follow-on behaviors, including whether or not the adversary fully infects the target and/or attempts specific actions. Many command shell utilities can be used to obtain this information. Examples include <code>dir</code>, <code>tree</code>, <code>ls</code>, <code>find</code>, and <code>locate</code>.(Citation: Windows Commands JPCERT) Custom tools may also be used to gather file and directory information and interact with the [Native API](https://attack.mitre.org/techniques/T1106).", "label_id": 75, "label_title": "File and Directory Discovery", "label_link": "https://attack.mitre.org/techniques/T1083", "entity_class": "CI", "entity_type": "TECHNIQUE", "document": "lab52_2020-06-02_mustang-panda-recent-activity-dll"}
{"mention": "extracts the first string of the binary and uses it as XOR key to decode the rest of the file", "context_left": "It has 4 exports that return 0 without doing anything, the Main function of the library, on the other hand, calls a function that checks the existence of the .dat file which is hardcoded (adobeupdate.dat in this case), loads it,", "context_right": ", which consists on the final threat.", "_context_left": "It has 4 exports that return 0 without doing anything, the Main function of the library, on the other hand, calls a function that checks the existence of the .dat file which is hardcoded (adobeupdate.dat in this case), loads it, ", "_context_right": ", which consists on the final threat.", "sentence_left": "![](https://lab52.io/blog/wp-content/uploads/2019/08/Captura-de-pantalla-de-2020-05-19-17-11-06-2.png)", "sentence_right": "The [following code](https://raw.githubusercontent.com/Bondey/PlugxScripts/master/PlugDecoder.py) in python imitates the logic of decoding:", "label": "Adversaries may use [Obfuscated Files or Information](https://attack.mitre.org/techniques/T1027) to hide artifacts of an intrusion from analysis. They may require separate mechanisms to decode or deobfuscate that information depending on how they intend to use it. Methods for doing that include built-in functionality of malware or by using utilities present on the system. One such example is use of [certutil](https://attack.mitre.org/software/S0160) to decode a remote access tool portable executable file that has been hidden inside a certificate file. (Citation: Malwarebytes Targeted Attack against Saudi Arabia) Another example is using the Windows <code>copy /b</code> command to reassemble binary fragments into a malicious payload. (Citation: Carbon Black Obfuscation Sept 2016) Sometimes a user's action may be required to open it for deobfuscation or decryption as part of [User Execution](https://attack.mitre.org/techniques/T1204). The user may also be required to input a password to open a password protected compressed/encrypted file that was provided by the adversary. (Citation: Volexity PowerDuke November 2016)", "label_id": 514, "label_title": "Deobfuscate/Decode Files or Information", "label_link": "https://attack.mitre.org/techniques/T1140", "entity_class": "CI", "entity_type": "TECHNIQUE", "document": "lab52_2020-06-02_mustang-panda-recent-activity-dll"}
{"mention": "finishes deciphering it,", "context_left": "When it", "context_right": "it loads the malware into memory, makes a “Memprotect” to make it executable and launches its logic from the byte 0 of the binary.", "_context_left": "When it ", "_context_right": " it loads the malware into memory, makes a “Memprotect” to make it executable and launches its logic from the byte 0 of the binary.", "sentence_left": "![](https://lab52.io/blog/wp-content/uploads/2019/08/Captura-de-pantalla-de-2020-05-19-17-27-10-2.png)", "sentence_right": "It is a functional PE, so this should not work, since it starts with the “MZ” header of a normal binary:", "label": "Adversaries may use [Obfuscated Files or Information](https://attack.mitre.org/techniques/T1027) to hide artifacts of an intrusion from analysis. They may require separate mechanisms to decode or deobfuscate that information depending on how they intend to use it. Methods for doing that include built-in functionality of malware or by using utilities present on the system. One such example is use of [certutil](https://attack.mitre.org/software/S0160) to decode a remote access tool portable executable file that has been hidden inside a certificate file. (Citation: Malwarebytes Targeted Attack against Saudi Arabia) Another example is using the Windows <code>copy /b</code> command to reassemble binary fragments into a malicious payload. (Citation: Carbon Black Obfuscation Sept 2016) Sometimes a user's action may be required to open it for deobfuscation or decryption as part of [User Execution](https://attack.mitre.org/techniques/T1204). The user may also be required to input a password to open a password protected compressed/encrypted file that was provided by the adversary. (Citation: Volexity PowerDuke November 2016)", "label_id": 514, "label_title": "Deobfuscate/Decode Files or Information", "label_link": "https://attack.mitre.org/techniques/T1140", "entity_class": "CI", "entity_type": "TECHNIQUE", "document": "lab52_2020-06-02_mustang-panda-recent-activity-dll"}
{"mention": "It is a functional PE", "context_left": "", "context_right": ", so this should not work, since it starts with the “MZ” header of a normal binary:", "_context_left": "", "_context_right": ", so this should not work, since it starts with the “MZ” header of a normal binary:", "sentence_left": "When it finishes deciphering it, it loads the malware into memory, makes a “Memprotect” to make it executable and launches its logic from the byte 0 of the binary.", "sentence_right": "![](https://lab52.io/blog/wp-content/uploads/2019/08/Captura-de-pantalla-de-2020-05-19-17-29-56-2.png)", "label": "Adversaries may inject code into processes in order to evade process-based defenses as well as possibly elevate privileges. Process injection is a method of executing arbitrary code in the address space of a separate live process. Running code in the context of another process may allow access to the process's memory, system/network resources, and possibly elevated privileges. Execution via process injection may also evade detection from security products since the execution is masked under a legitimate process. There are many different ways to inject code into a process, many of which abuse legitimate functionalities. These implementations exist for every major OS but are typically platform specific. More sophisticated samples may perform multiple process injections to segment modules and further evade detection, utilizing named pipes or other inter-process communication (IPC) mechanisms as a communication channel.", "label_id": 318, "label_title": "Process Injection", "label_link": "https://attack.mitre.org/techniques/T1055", "entity_class": "CE", "entity_type": "TECHNIQUE", "document": "lab52_2020-06-02_mustang-panda-recent-activity-dll"}
{"mention": "Cobalt Strike", "context_left": "But in this case it uses a technique already seen before in tools like the", "context_right": "Beacon that by modifying some bytes of the MZ header, it becomes meaningful executable code.", "_context_left": "But in this case it uses a technique already seen before in tools like the ", "_context_right": " Beacon that by modifying some bytes of the MZ header, it becomes meaningful executable code.", "sentence_left": "![](https://lab52.io/blog/wp-content/uploads/2019/08/Captura-de-pantalla-de-2020-05-19-17-29-56-2.png)", "sentence_right": "If we open the binary as a shellcode (de-compiling from byte 0) we see how they have modified the first bytes into a routine that jumps to a code zone, consisting of a PE loader:", "label": "[Cobalt Strike](https://attack.mitre.org/software/S0154) is a commercial, full-featured, remote access tool that bills itself as “adversary simulation software designed to execute targeted attacks and emulate the post-exploitation actions of advanced threat actors”. Cobalt Strike’s interactive post-exploit capabilities cover the full range of ATT&CK tactics, all executed within a single, integrated system.(Citation: cobaltstrike manual) In addition to its own capabilities, [Cobalt Strike](https://attack.mitre.org/software/S0154) leverages the capabilities of other well-known tools such as Metasploit and [Mimikatz](https://attack.mitre.org/software/S0002).(Citation: cobaltstrike manual)", "label_id": 1049, "label_title": "Cobalt Strike", "label_link": "https://attack.mitre.org/software/S0154", "entity_class": "CE", "entity_type": "MALWARE", "document": "lab52_2020-06-02_mustang-panda-recent-activity-dll"}
{"mention": "Beacon", "context_left": "But in this case it uses a technique already seen before in tools like the Cobalt Strike", "context_right": "that by modifying some bytes of the MZ header, it becomes meaningful executable code.", "_context_left": "But in this case it uses a technique already seen before in tools like the Cobalt Strike ", "_context_right": " that by modifying some bytes of the MZ header, it becomes meaningful executable code.", "sentence_left": "![](https://lab52.io/blog/wp-content/uploads/2019/08/Captura-de-pantalla-de-2020-05-19-17-29-56-2.png)", "sentence_right": "If we open the binary as a shellcode (de-compiling from byte 0) we see how they have modified the first bytes into a routine that jumps to a code zone, consisting of a PE loader:", "label": "[Cobalt Strike](https://attack.mitre.org/software/S0154) is a commercial, full-featured, remote access tool that bills itself as “adversary simulation software designed to execute targeted attacks and emulate the post-exploitation actions of advanced threat actors”. Cobalt Strike’s interactive post-exploit capabilities cover the full range of ATT&CK tactics, all executed within a single, integrated system.(Citation: cobaltstrike manual) In addition to its own capabilities, [Cobalt Strike](https://attack.mitre.org/software/S0154) leverages the capabilities of other well-known tools such as Metasploit and [Mimikatz](https://attack.mitre.org/software/S0002).(Citation: cobaltstrike manual)", "label_id": 1049, "label_title": "Cobalt Strike", "label_link": "https://attack.mitre.org/software/S0154", "entity_class": "CE", "entity_type": "MALWARE", "document": "lab52_2020-06-02_mustang-panda-recent-activity-dll"}
{"mention": "by modifying some bytes of the MZ header, it becomes meaningful executable code.", "context_left": "But in this case it uses a technique already seen before in tools like the Cobalt Strike Beacon that", "context_right": "", "_context_left": "But in this case it uses a technique already seen before in tools like the Cobalt Strike Beacon that ", "_context_right": "", "sentence_left": "![](https://lab52.io/blog/wp-content/uploads/2019/08/Captura-de-pantalla-de-2020-05-19-17-29-56-2.png)", "sentence_right": "If we open the binary as a shellcode (de-compiling from byte 0) we see how they have modified the first bytes into a routine that jumps to a code zone, consisting of a PE loader:", "label": "Adversaries may use [Obfuscated Files or Information](https://attack.mitre.org/techniques/T1027) to hide artifacts of an intrusion from analysis. They may require separate mechanisms to decode or deobfuscate that information depending on how they intend to use it. Methods for doing that include built-in functionality of malware or by using utilities present on the system. One such example is use of [certutil](https://attack.mitre.org/software/S0160) to decode a remote access tool portable executable file that has been hidden inside a certificate file. (Citation: Malwarebytes Targeted Attack against Saudi Arabia) Another example is using the Windows <code>copy /b</code> command to reassemble binary fragments into a malicious payload. (Citation: Carbon Black Obfuscation Sept 2016) Sometimes a user's action may be required to open it for deobfuscation or decryption as part of [User Execution](https://attack.mitre.org/techniques/T1204). The user may also be required to input a password to open a password protected compressed/encrypted file that was provided by the adversary. (Citation: Volexity PowerDuke November 2016)", "label_id": 514, "label_title": "Deobfuscate/Decode Files or Information", "label_link": "https://attack.mitre.org/techniques/T1140", "entity_class": "CI", "entity_type": "TECHNIQUE", "document": "lab52_2020-06-02_mustang-panda-recent-activity-dll"}
{"mention": "consisting of a PE loader", "context_left": "If we open the binary as a shellcode (de-compiling from byte 0) we see how they have modified the first bytes into a routine that jumps to a code zone,", "context_right": ":", "_context_left": "If we open the binary as a shellcode (de-compiling from byte 0) we see how they have modified the first bytes into a routine that jumps to a code zone, ", "_context_right": ":", "sentence_left": "But in this case it uses a technique already seen before in tools like the Cobalt Strike Beacon that by modifying some bytes of the MZ header, it becomes meaningful executable code.", "sentence_right": "![](https://lab52.io/blog/wp-content/uploads/2019/08/Captura-de-pantalla-de-2020-05-19-17-32-07-2.png)", "label": "Adversaries may inject code into processes in order to evade process-based defenses as well as possibly elevate privileges. Process injection is a method of executing arbitrary code in the address space of a separate live process. Running code in the context of another process may allow access to the process's memory, system/network resources, and possibly elevated privileges. Execution via process injection may also evade detection from security products since the execution is masked under a legitimate process. There are many different ways to inject code into a process, many of which abuse legitimate functionalities. These implementations exist for every major OS but are typically platform specific. More sophisticated samples may perform multiple process injections to segment modules and further evade detection, utilizing named pipes or other inter-process communication (IPC) mechanisms as a communication channel.", "label_id": 318, "label_title": "Process Injection", "label_link": "https://attack.mitre.org/techniques/T1055", "entity_class": "CE", "entity_type": "TECHNIQUE", "document": "lab52_2020-06-02_mustang-panda-recent-activity-dll"}
{"mention": "decrypting its configuration, it contains the folder where the binary must be installed", "context_left": "After", "context_right": ", a XOR key that will use to encrypt it’s traffic and a list of up to 4 domains or IP addresses of command and control servers together with the port to be used.", "_context_left": "After ", "_context_right": ", a XOR key that will use to encrypt it’s traffic and a list of up to 4 domains or IP addresses of command and control servers together with the port to be used.", "sentence_left": "This time the decryption key is hardcoded in the binary, and is the string “123456789”.", "sentence_right": "Generally the 4 C2 elements consists of the same domain repeated 4 times or 2 domains repeated twice each.", "label": "Adversaries may use [Obfuscated Files or Information](https://attack.mitre.org/techniques/T1027) to hide artifacts of an intrusion from analysis. They may require separate mechanisms to decode or deobfuscate that information depending on how they intend to use it. Methods for doing that include built-in functionality of malware or by using utilities present on the system. One such example is use of [certutil](https://attack.mitre.org/software/S0160) to decode a remote access tool portable executable file that has been hidden inside a certificate file. (Citation: Malwarebytes Targeted Attack against Saudi Arabia) Another example is using the Windows <code>copy /b</code> command to reassemble binary fragments into a malicious payload. (Citation: Carbon Black Obfuscation Sept 2016) Sometimes a user's action may be required to open it for deobfuscation or decryption as part of [User Execution](https://attack.mitre.org/techniques/T1204). The user may also be required to input a password to open a password protected compressed/encrypted file that was provided by the adversary. (Citation: Volexity PowerDuke November 2016)", "label_id": 514, "label_title": "Deobfuscate/Decode Files or Information", "label_link": "https://attack.mitre.org/techniques/T1140", "entity_class": "CI", "entity_type": "TECHNIQUE", "document": "lab52_2020-06-02_mustang-panda-recent-activity-dll"}
{"mention": "XOR key that will use to encrypt it’s traffic and a list of up to 4 domains or IP addresses of command and control servers together with the port to be used.", "context_left": "After decrypting its configuration, it contains the folder where the binary must be installed, a", "context_right": "", "_context_left": "After decrypting its configuration, it contains the folder where the binary must be installed, a ", "_context_right": "", "sentence_left": "This time the decryption key is hardcoded in the binary, and is the string “123456789”.", "sentence_right": "Generally the 4 C2 elements consists of the same domain repeated 4 times or 2 domains repeated twice each.", "label": "Adversaries may obfuscate command and control traffic to make it more difficult to detect. Command and control (C2) communications are hidden (but not necessarily encrypted) in an attempt to make the content more difficult to discover or decipher and to make the communication less conspicuous and hide commands from being seen. This encompasses many methods, such as adding junk data to protocol traffic, using steganography, or impersonating legitimate protocols.", "label_id": 415, "label_title": "Data Obfuscation", "label_link": "https://attack.mitre.org/techniques/T1001", "entity_class": "CI", "entity_type": "TECHNIQUE", "document": "lab52_2020-06-02_mustang-panda-recent-activity-dll"}
{"mention": "C2", "context_left": "Generally the 4", "context_right": "elements consists of the same domain repeated 4 times or 2 domains repeated twice each.", "_context_left": "Generally the 4 ", "_context_right": " elements consists of the same domain repeated 4 times or 2 domains repeated twice each.", "sentence_left": "After decrypting its configuration, it contains the folder where the binary must be installed, a XOR key that will use to encrypt it’s traffic and a list of up to 4 domains or IP addresses of command and control servers together with the port to be used.", "sentence_right": "After the analysis, both the loader in DLL format and the final encrypted threat (after decryption) have been compared with different campaign samples of groups known to use this dll sideload technique, and it has been possible to verify how both the loader and the final threat coincide in a high percentage with the samples of the “Mustang Panda” group analyzed in the following reports [[1]](https://www.anomali.com/blog/covid-19-themes-are-being-utilized-by-threat-actors-of-varying-sophistication) [[2]](https://blog.vincss.net/2020/03/re012-phan-tich-ma-doc-loi-dung-dich-COVID-19-de-phat-tan-gia-mao-chi-thi-cua-thu-tuong-Nguyen-Xuan-Phuc.html) [[3]](https://blog.vincss.net/2020/03/re012-phan-tich-ma-doc-loi-dung-dich-COVID-19-de-phat-tan-gia-mao-chi-thi-cua-thu-tuong-Nguyen-Xuan-Phuc-phan2.html).", "label": "The adversary is trying to communicate with compromised systems to control them. Command and Control consists of techniques that adversaries may use to communicate with systems under their control within a victim network. Adversaries commonly attempt to mimic normal, expected traffic to avoid detection. There are many ways an adversary can establish command and control with various levels of stealth depending on the victim’s network structure and defenses.", "label_id": 581, "label_title": "Command and Control", "label_link": "https://attack.mitre.org/tactics/TA0011", "entity_class": "CE", "entity_type": "TACTIC", "document": "lab52_2020-06-02_mustang-panda-recent-activity-dll"}
{"mention": "Mustang Panda", "context_left": "After the analysis, both the loader in DLL format and the final encrypted threat (after decryption) have been compared with different campaign samples of groups known to use this dll sideload technique, and it has been possible to verify how both the loader and the final threat coincide in a high percentage with the samples of the “", "context_right": "” group analyzed in the following reports [[1]](https://www.anomali.com/blog/covid-19-themes-are-being-utilized-by-threat-actors-of-varying-sophistication) [[2]](https://blog.vincss.net/2020/03/re012-phan-tich-ma-doc-loi-dung-dich-COVID-19-de-phat-tan-gia-mao-chi-thi-cua-thu-tuong-Nguyen-Xuan-Phuc.html) [[3]](https://blog.vincss.net/2020/03/re012-phan-tich-ma-doc-loi-dung-dich-COVID-19-de-phat-tan-gia-mao-chi-thi-cua-thu-tuong-Nguyen-Xuan-Phuc-phan2.html).", "_context_left": "After the analysis, both the loader in DLL format and the final encrypted threat (after decryption) have been compared with different campaign samples of groups known to use this dll sideload technique, and it has been possible to verify how both the loader and the final threat coincide in a high percentage with the samples of the “", "_context_right": "” group analyzed in the following reports [[1]](https://www.anomali.com/blog/covid-19-themes-are-being-utilized-by-threat-actors-of-varying-sophistication) [[2]](https://blog.vincss.net/2020/03/re012-phan-tich-ma-doc-loi-dung-dich-COVID-19-de-phat-tan-gia-mao-chi-thi-cua-thu-tuong-Nguyen-Xuan-Phuc.html) [[3]](https://blog.vincss.net/2020/03/re012-phan-tich-ma-doc-loi-dung-dich-COVID-19-de-phat-tan-gia-mao-chi-thi-cua-thu-tuong-Nguyen-Xuan-Phuc-phan2.html).", "sentence_left": "Generally the 4 C2 elements consists of the same domain repeated 4 times or 2 domains repeated twice each.", "sentence_right": "In fact, the loader of this campaign is able to load and run the samples of the campaigns analyzed in those reports, and the final threat uses exactly the same XOR key to decipher its configuration as the samples in those reports, so there is a high probability that it is a new campaign from this same group.", "label": "[Mustang Panda](https://attack.mitre.org/groups/G0129) is a China-based cyber espionage threat actor that was first observed in 2017 but may have been conducting operations since at least 2014. [Mustang Panda](https://attack.mitre.org/groups/G0129) has targeted government entities, nonprofits, religious, and other non-governmental organizations in the U.S., Germany, Mongolia, Myanmar, Pakistan, and Vietnam, among others.(Citation: Crowdstrike MUSTANG PANDA June 2018)(Citation: Anomali MUSTANG PANDA October 2019)(Citation: Secureworks BRONZE PRESIDENT December 2019)", "label_id": 1139, "label_title": "Mustang Panda", "label_link": "https://attack.mitre.org/groups/G0129", "entity_class": "CE", "entity_type": "GROUP", "document": "lab52_2020-06-02_mustang-panda-recent-activity-dll"}
{"mention": "loader in DLL format", "context_left": "After the analysis, both the", "context_right": "and the final encrypted threat (after decryption) have been compared with different campaign samples of groups known to use this dll sideload technique, and it has been possible to verify how both the loader and the final threat coincide in a high percentage with the samples of the “Mustang Panda” group analyzed in the following reports [[1]](https://www.anomali.com/blog/covid-19-themes-are-being-utilized-by-threat-actors-of-varying-sophistication) [[2]](https://blog.vincss.net/2020/03/re012-phan-tich-ma-doc-loi-dung-dich-COVID-19-de-phat-tan-gia-mao-chi-thi-cua-thu-tuong-Nguyen-Xuan-Phuc.html) [[3]](https://blog.vincss.net/2020/03/re012-phan-tich-ma-doc-loi-dung-dich-COVID-19-de-phat-tan-gia-mao-chi-thi-cua-thu-tuong-Nguyen-Xuan-Phuc-phan2.html).", "_context_left": "After the analysis, both the ", "_context_right": " and the final encrypted threat (after decryption) have been compared with different campaign samples of groups known to use this dll sideload technique, and it has been possible to verify how both the loader and the final threat coincide in a high percentage with the samples of the “Mustang Panda” group analyzed in the following reports [[1]](https://www.anomali.com/blog/covid-19-themes-are-being-utilized-by-threat-actors-of-varying-sophistication) [[2]](https://blog.vincss.net/2020/03/re012-phan-tich-ma-doc-loi-dung-dich-COVID-19-de-phat-tan-gia-mao-chi-thi-cua-thu-tuong-Nguyen-Xuan-Phuc.html) [[3]](https://blog.vincss.net/2020/03/re012-phan-tich-ma-doc-loi-dung-dich-COVID-19-de-phat-tan-gia-mao-chi-thi-cua-thu-tuong-Nguyen-Xuan-Phuc-phan2.html).", "sentence_left": "Generally the 4 C2 elements consists of the same domain repeated 4 times or 2 domains repeated twice each.", "sentence_right": "In fact, the loader of this campaign is able to load and run the samples of the campaigns analyzed in those reports, and the final threat uses exactly the same XOR key to decipher its configuration as the samples in those reports, so there is a high probability that it is a new campaign from this same group.", "label": "Adversaries may execute their own malicious payloads by hijacking the way operating systems run programs. Hijacking execution flow can be for the purposes of persistence, since this hijacked execution may reoccur over time. Adversaries may also use these mechanisms to elevate privileges or evade defenses, such as application control or other restrictions on execution. There are many ways an adversary may hijack the flow of execution, including by manipulating how the operating system locates programs to be executed. How the operating system locates libraries to be used by a program can also be intercepted. Locations where the operating system looks for programs/resources, such as file directories and in the case of Windows the Registry, could also be poisoned to include malicious payloads.", "label_id": 185, "label_title": "Hijack Execution Flow", "label_link": "https://attack.mitre.org/techniques/T1574", "entity_class": "CI", "entity_type": "TECHNIQUE", "document": "lab52_2020-06-02_mustang-panda-recent-activity-dll"}
{"mention": "dll sideload technique", "context_left": "After the analysis, both the loader in DLL format and the final encrypted threat (after decryption) have been compared with different campaign samples of groups known to use this", "context_right": ", and it has been possible to verify how both the loader and the final threat coincide in a high percentage with the samples of the “Mustang Panda” group analyzed in the following reports [[1]](https://www.anomali.com/blog/covid-19-themes-are-being-utilized-by-threat-actors-of-varying-sophistication) [[2]](https://blog.vincss.net/2020/03/re012-phan-tich-ma-doc-loi-dung-dich-COVID-19-de-phat-tan-gia-mao-chi-thi-cua-thu-tuong-Nguyen-Xuan-Phuc.html) [[3]](https://blog.vincss.net/2020/03/re012-phan-tich-ma-doc-loi-dung-dich-COVID-19-de-phat-tan-gia-mao-chi-thi-cua-thu-tuong-Nguyen-Xuan-Phuc-phan2.html).", "_context_left": "After the analysis, both the loader in DLL format and the final encrypted threat (after decryption) have been compared with different campaign samples of groups known to use this ", "_context_right": ", and it has been possible to verify how both the loader and the final threat coincide in a high percentage with the samples of the “Mustang Panda” group analyzed in the following reports [[1]](https://www.anomali.com/blog/covid-19-themes-are-being-utilized-by-threat-actors-of-varying-sophistication) [[2]](https://blog.vincss.net/2020/03/re012-phan-tich-ma-doc-loi-dung-dich-COVID-19-de-phat-tan-gia-mao-chi-thi-cua-thu-tuong-Nguyen-Xuan-Phuc.html) [[3]](https://blog.vincss.net/2020/03/re012-phan-tich-ma-doc-loi-dung-dich-COVID-19-de-phat-tan-gia-mao-chi-thi-cua-thu-tuong-Nguyen-Xuan-Phuc-phan2.html).", "sentence_left": "Generally the 4 C2 elements consists of the same domain repeated 4 times or 2 domains repeated twice each.", "sentence_right": "In fact, the loader of this campaign is able to load and run the samples of the campaigns analyzed in those reports, and the final threat uses exactly the same XOR key to decipher its configuration as the samples in those reports, so there is a high probability that it is a new campaign from this same group.", "label": "Adversaries may execute their own malicious payloads by hijacking the way operating systems run programs. Hijacking execution flow can be for the purposes of persistence, since this hijacked execution may reoccur over time. Adversaries may also use these mechanisms to elevate privileges or evade defenses, such as application control or other restrictions on execution. There are many ways an adversary may hijack the flow of execution, including by manipulating how the operating system locates programs to be executed. How the operating system locates libraries to be used by a program can also be intercepted. Locations where the operating system looks for programs/resources, such as file directories and in the case of Windows the Registry, could also be poisoned to include malicious payloads.", "label_id": 185, "label_title": "Hijack Execution Flow", "label_link": "https://attack.mitre.org/techniques/T1574", "entity_class": "CI", "entity_type": "TECHNIQUE", "document": "lab52_2020-06-02_mustang-panda-recent-activity-dll"}
{"mention": "final threat uses exactly the same XOR key to decipher its configuration", "context_left": "In fact, the loader of this campaign is able to load and run the samples of the campaigns analyzed in those reports, and the", "context_right": "as the samples in those reports, so there is a high probability that it is a new campaign from this same group.", "_context_left": "In fact, the loader of this campaign is able to load and run the samples of the campaigns analyzed in those reports, and the ", "_context_right": " as the samples in those reports, so there is a high probability that it is a new campaign from this same group.", "sentence_left": "After the analysis, both the loader in DLL format and the final encrypted threat (after decryption) have been compared with different campaign samples of groups known to use this dll sideload technique, and it has been possible to verify how both the loader and the final threat coincide in a high percentage with the samples of the “Mustang Panda” group analyzed in the following reports [[1]](https://www.anomali.com/blog/covid-19-themes-are-being-utilized-by-threat-actors-of-varying-sophistication) [[2]](https://blog.vincss.net/2020/03/re012-phan-tich-ma-doc-loi-dung-dich-COVID-19-de-phat-tan-gia-mao-chi-thi-cua-thu-tuong-Nguyen-Xuan-Phuc.html) [[3]](https://blog.vincss.net/2020/03/re012-phan-tich-ma-doc-loi-dung-dich-COVID-19-de-phat-tan-gia-mao-chi-thi-cua-thu-tuong-Nguyen-Xuan-Phuc-phan2.html).", "sentence_right": "This particular sample has the domains “www.destroy2013.]com” and “www.fitehook.]com” as c2 servers, and we have seen that they have a very characteristic behavior, since most of the day they resolve to 127.0.0.1, but from 1-3 AM (UTC) to 8-9 AM (UTC) it resolves to the IP “107.150.112.]250, except for weekends that it resolves constantly to 127.0.0.1, which could indicate that it is a campaign that is focused on a time zone in which those hours are working hours.", "label": "Adversaries may use [Obfuscated Files or Information](https://attack.mitre.org/techniques/T1027) to hide artifacts of an intrusion from analysis. They may require separate mechanisms to decode or deobfuscate that information depending on how they intend to use it. Methods for doing that include built-in functionality of malware or by using utilities present on the system. One such example is use of [certutil](https://attack.mitre.org/software/S0160) to decode a remote access tool portable executable file that has been hidden inside a certificate file. (Citation: Malwarebytes Targeted Attack against Saudi Arabia) Another example is using the Windows <code>copy /b</code> command to reassemble binary fragments into a malicious payload. (Citation: Carbon Black Obfuscation Sept 2016) Sometimes a user's action may be required to open it for deobfuscation or decryption as part of [User Execution](https://attack.mitre.org/techniques/T1204). The user may also be required to input a password to open a password protected compressed/encrypted file that was provided by the adversary. (Citation: Volexity PowerDuke November 2016)", "label_id": 514, "label_title": "Deobfuscate/Decode Files or Information", "label_link": "https://attack.mitre.org/techniques/T1140", "entity_class": "CI", "entity_type": "TECHNIQUE", "document": "lab52_2020-06-02_mustang-panda-recent-activity-dll"}
{"mention": "sample has the domains “www.destroy2013.]com” and “www.fitehook.]com” as c2 servers", "context_left": "This particular", "context_right": ", and we have seen that they have a very characteristic behavior, since most of the day they resolve to 127.0.0.1, but from 1-3 AM (UTC) to 8-9 AM (UTC) it resolves to the IP “107.150.112.]250, except for weekends that it resolves constantly to 127.0.0.1, which could indicate that it is a campaign that is focused on a time zone in which those hours are working hours.", "_context_left": "This particular ", "_context_right": ", and we have seen that they have a very characteristic behavior, since most of the day they resolve to 127.0.0.1, but from 1-3 AM (UTC) to 8-9 AM (UTC) it resolves to the IP “107.150.112.]250, except for weekends that it resolves constantly to 127.0.0.1, which could indicate that it is a campaign that is focused on a time zone in which those hours are working hours.", "sentence_left": "In fact, the loader of this campaign is able to load and run the samples of the campaigns analyzed in those reports, and the final threat uses exactly the same XOR key to decipher its configuration as the samples in those reports, so there is a high probability that it is a new campaign from this same group.", "sentence_right": "| IP | 81.16.28.]30 |", "label": "Adversaries may communicate using application layer protocols to avoid detection/network filtering by blending in with existing traffic. Commands to the remote system, and often the results of those commands, will be embedded within the protocol traffic between the client and server. Adversaries may utilize many different protocols, including those used for web browsing, transferring files, electronic mail, or DNS. For connections that occur internally within an enclave (such as those between a proxy or pivot node and other nodes), commonly used protocols are SMB, SSH, or RDP.", "label_id": 452, "label_title": "Application Layer Protocol", "label_link": "https://attack.mitre.org/techniques/T1071", "entity_class": "CI", "entity_type": "TECHNIQUE", "document": "lab52_2020-06-02_mustang-panda-recent-activity-dll"}
{"mention": "| SHA256 | 9c0f6f54e5ab9a86955f1a4beffd6f57c553e34b548a9d93f4207e6a7a6c8135 |", "context_left": "", "context_right": "", "_context_left": "", "_context_right": "", "sentence_left": "| SHA256 | c56ac01b3af452fedc0447d9e0fe184d093d3fd3c6631aa8182c752463de570c |", "sentence_right": "", "label": "No Annotation", "label_id": 1906, "label_title": "No Annotation", "label_link": "No Annotation", "entity_class": "CI", "entity_type": "TECHNIQUE", "document": "lab52_2020-06-02_mustang-panda-recent-activity-dll"}
{"mention": "After loading the IAT and leaving everything ready as a normal executable, this threat decrypts its own config, which is encrypted in XOR in the .data section of the binary.", "context_left": "", "context_right": "", "_context_left": "", "_context_right": "", "sentence_left": "![](https://lab52.io/blog/wp-content/uploads/2019/08/Captura-de-pantalla-de-2020-05-19-17-32-07-2.png)", "sentence_right": "This time the decryption key is hardcoded in the binary, and is the string “123456789”.", "label": "No Annotation", "label_id": 1906, "label_title": "No Annotation", "label_link": "No Annotation", "entity_class": "CI", "entity_type": "TECHNIQUE", "document": "lab52_2020-06-02_mustang-panda-recent-activity-dll"}
{"mention": "| DOMAIN | www.destroy2013.]com |", "context_left": "", "context_right": "", "_context_left": "", "_context_right": "", "sentence_left": "| IP | 107.150.112.]250 |", "sentence_right": "| DOMAIN | www.fitehook.]com |", "label": "No Annotation", "label_id": 1906, "label_title": "No Annotation", "label_link": "No Annotation", "entity_class": "CI", "entity_type": "TECHNIQUE", "document": "lab52_2020-06-02_mustang-panda-recent-activity-dll"}
{"mention": "The [following code](https://raw.githubusercontent.com/Bondey/PlugxScripts/master/PlugDecoder.py) in python imitates the logic of decoding:", "context_left": "", "context_right": "", "_context_left": "", "_context_right": "", "sentence_left": "It has 4 exports that return 0 without doing anything, the Main function of the library, on the other hand, calls a function that checks the existence of the .dat file which is hardcoded (adobeupdate.dat in this case), loads it, extracts the first string of the binary and uses it as XOR key to decode the rest of the file, which consists on the final threat.", "sentence_right": "![](https://lab52.io/blog/wp-content/uploads/2019/08/Captura-de-pantalla-de-2020-05-19-17-27-10-2.png)", "label": "No Annotation", "label_id": 1906, "label_title": "No Annotation", "label_link": "No Annotation", "entity_class": "CI", "entity_type": "TECHNIQUE", "document": "lab52_2020-06-02_mustang-panda-recent-activity-dll"}
{"mention": "| IP | 107.150.112.]250 |", "context_left": "", "context_right": "", "_context_left": "", "_context_right": "", "sentence_left": "| IP | 81.16.28.]30 |", "sentence_right": "| DOMAIN | www.destroy2013.]com |", "label": "No Annotation", "label_id": 1906, "label_title": "No Annotation", "label_link": "No Annotation", "entity_class": "CI", "entity_type": "TECHNIQUE", "document": "lab52_2020-06-02_mustang-panda-recent-activity-dll"}
{"mention": "| DOMAIN | miandfish.]store |", "context_left": "", "context_right": "", "_context_left": "", "_context_right": "", "sentence_left": "| DOMAIN | www.fitehook.]com |", "sentence_right": "| SHA256 | c56ac01b3af452fedc0447d9e0fe184d093d3fd3c6631aa8182c752463de570c |", "label": "No Annotation", "label_id": 1906, "label_title": "No Annotation", "label_link": "No Annotation", "entity_class": "CI", "entity_type": "TECHNIQUE", "document": "lab52_2020-06-02_mustang-panda-recent-activity-dll"}
{"mention": "| IP | 81.16.28.]30 |", "context_left": "", "context_right": "", "_context_left": "", "_context_right": "", "sentence_left": "This particular sample has the domains “www.destroy2013.]com” and “www.fitehook.]com” as c2 servers, and we have seen that they have a very characteristic behavior, since most of the day they resolve to 127.0.0.1, but from 1-3 AM (UTC) to 8-9 AM (UTC) it resolves to the IP “107.150.112.]250, except for weekends that it resolves constantly to 127.0.0.1, which could indicate that it is a campaign that is focused on a time zone in which those hours are working hours.", "sentence_right": "| IP | 107.150.112.]250 |", "label": "No Annotation", "label_id": 1906, "label_title": "No Annotation", "label_link": "No Annotation", "entity_class": "CI", "entity_type": "TECHNIQUE", "document": "lab52_2020-06-02_mustang-panda-recent-activity-dll"}
{"mention": "The sample in question is downloaded from the following link “http://miandfish.]store/player/install\\_flash\\_player.exe” and although in previous months, it had another hash, currently the sample hosted under that name has the following hash “c56ac01b3af452fedc0447d9e0fe184d093d3fd3c6631aa8182c752463de570c”.", "context_left": "", "context_right": "", "_context_left": "", "_context_right": "", "sentence_left": "This technique, and final threat together, consists of one of the most common TTPs among some APT groups generally of Chinese origin such as APT1, APT27 and Mustang Panda.", "sentence_right": "The binary consists of an installer, which drops in the folder “C:\\ProgramData\\AAM Updatesnnk” the legitimate binary vulnerable to dll sideload, the small dll that acts as a loader for the final threat, and the binary file, which consists of the encrypted PlugX sample.", "label": "No Annotation", "label_id": 1906, "label_title": "No Annotation", "label_link": "No Annotation", "entity_class": "CI", "entity_type": "TECHNIQUE", "document": "lab52_2020-06-02_mustang-panda-recent-activity-dll"}
{"mention": "| SHA256 | c56ac01b3af452fedc0447d9e0fe184d093d3fd3c6631aa8182c752463de570c |", "context_left": "", "context_right": "", "_context_left": "", "_context_right": "", "sentence_left": "| DOMAIN | miandfish.]store |", "sentence_right": "| SHA256 | 9c0f6f54e5ab9a86955f1a4beffd6f57c553e34b548a9d93f4207e6a7a6c8135 |", "label": "No Annotation", "label_id": 1906, "label_title": "No Annotation", "label_link": "No Annotation", "entity_class": "CI", "entity_type": "TECHNIQUE", "document": "lab52_2020-06-02_mustang-panda-recent-activity-dll"}
{"mention": "| DOMAIN | www.fitehook.]com |", "context_left": "", "context_right": "", "_context_left": "", "_context_right": "", "sentence_left": "| DOMAIN | www.destroy2013.]com |", "sentence_right": "| DOMAIN | miandfish.]store |", "label": "No Annotation", "label_id": 1906, "label_title": "No Annotation", "label_link": "No Annotation", "entity_class": "CI", "entity_type": "TECHNIQUE", "document": "lab52_2020-06-02_mustang-panda-recent-activity-dll"}
{"mention": "June 02, 2020", "context_left": "", "context_right": "", "_context_left": "", "_context_right": "", "sentence_left": "Mustang Panda Recent Activity: Dll-Sideloading trojans with temporal C2 servers", "sentence_right": "Recently, from Lab52 we have detected a recent malware sample, using the Dll-Sideload technique with a legitimate binary, to load a threat.", "label": "No Annotation", "label_id": 1906, "label_title": "No Annotation", "label_link": "No Annotation", "entity_class": "CI", "entity_type": "TECHNIQUE", "document": "lab52_2020-06-02_mustang-panda-recent-activity-dll"}
{"mention": "This time the decryption key is hardcoded in the binary, and is the string “123456789”.", "context_left": "", "context_right": "", "_context_left": "", "_context_right": "", "sentence_left": "After loading the IAT and leaving everything ready as a normal executable, this threat decrypts its own config, which is encrypted in XOR in the .data section of the binary.", "sentence_right": "After decrypting its configuration, it contains the folder where the binary must be installed, a XOR key that will use to encrypt it’s traffic and a list of up to 4 domains or IP addresses of command and control servers together with the port to be used.", "label": "No Annotation", "label_id": 1906, "label_title": "No Annotation", "label_link": "No Annotation", "entity_class": "CI", "entity_type": "TECHNIQUE", "document": "lab52_2020-06-02_mustang-panda-recent-activity-dll"}
{"mention": "That hex.dll, in this case is a very simple and relatively small loader:", "context_left": "", "context_right": "", "_context_left": "", "_context_right": "", "sentence_left": "![](https://lab52.io/blog/wp-content/uploads/2019/08/Captura-de-pantalla-de-2020-05-19-17-21-53-2.png)", "sentence_right": "![](https://lab52.io/blog/wp-content/uploads/2019/08/Captura-de-pantalla-de-2020-05-19-17-11-06-2.png)", "label": "No Annotation", "label_id": 1906, "label_title": "No Annotation", "label_link": "No Annotation", "entity_class": "CI", "entity_type": "TECHNIQUE", "document": "lab52_2020-06-02_mustang-panda-recent-activity-dll"}