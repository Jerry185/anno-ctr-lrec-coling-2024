<?xml version="1.0"?>
<TimeML xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="http://timeml.org/timeMLdocs/TimeML_1.2.1.xsd">
<DCT><TIMEX3 functionInDocument="CREATION_TIME" temporalFunction="false" tid="t0" type="DATE" value="2020-01-27">2020-01-27</TIMEX3></DCT>
<TEXT>
The Chicken Keeps Laying New Eggs: Uncovering New GC MaaS Tools Used By Top-tier Threat Actors   <TIMEX3 tid="t1" type="DATE" value="2020-01-27">Jan 27, 2020</TIMEX3>    ![](data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==) ![](https://quointelligence.eu/wp-content/uploads/2020/04/GC.png) Note: This article was initially written by the QuoINT Team as part of QuoScient GmbH.  Since the foundation of QuoIntelligence in <TIMEX3 tid="t2" type="DATE" value="2020-03">March 2020</TIMEX3>, this article was transferred to this website on <TIMEX3 tid="t3" type="DATE" value="2020-04-21">21 April 2020</TIMEX3>. Executive summary ================= Since <TIMEX3 tid="t4" type="DATE" value="2018">2018</TIMEX3>, QuoINT has tracked the evolution of the Golden Chickens (GC) Malware-as-a-Service provider (MaaS) and how different threat actors use it. <TIMEX3 tid="t5" type="DATE" value="2019">In 2019</TIMEX3>, we uncovered and classified seven additional tools linked to the GC MaaS, which add to the four ones [we uncovered in <TIMEX3 tid="t6" type="DATE" value="2018">2018</TIMEX3>](https://quointelligence.eu/2018/11/golden-chickens-uncovering-a-malware-as-a-service-maas-provider-and-two-new-threat-actors-using/). The new classified GC Tools are: * **TerraRecon.** A reconnaissance tool used to look for specific hardware & software used by companies operating in retail and payment services sectors. * **TerraStealer.** An information stealer, also known as *SONE*, or *StealerOne* * **VenomLNK.** A malware variant likely generated by a newer version of the VenomKit building kit. * **TerraWiper.** AMaster Boot Record (MBR) wiper. * **TerraCrypt.** A ransomware, also known as *PureLocker.* * **TerraTV.** A custom DLL designed to hijack legit TeamViewer applications. * **lite\_more\_eggs.** A lite version of more\_eggs used as a loader. **Key Points** * This blog post aims at clarifying the existing knowledge on this MaaS, and to further uncover additional details that can support researchers and analysts while attributing attacks relying on the MaaS tools and services. Lastly, the described tools’ techniques (mapped with MITRE ATT&CK) can support defenders in better detecting the GC MaaS tools activities. * GC remains as the preferred MaaS provider for certain top-tier e-crime threat actor groups that rely on targeted attacks to achieve their fraudulent objectives. This is due to the reliability the GC MaaS offering provides in terms of resiliency and flexibility. * GC MaaS operator demonstrates continuous effort in updating existing tools and developing new ones, as well as maintaining the underlying network infrastructure. * Some of the new tools we have uncovered were highly likely coded exclusively for one specific threat actor. We observed the use of such tools only in very targeted attacks against the retail and financial sectors. Introduction ============ <TIMEX3 tid="t7" type="DATE" value="2018">In 2018</TIMEX3>, QuoINT was engaged by one of its customers to attribute a spear phishing email attack that was matching the Cobalt Group’s Tactics, Techniques, and Procedures (TTPs) described by multiple security researchers during that time. Our intelligence analysis not only concluded that the attack was not perpetrated by the Cobalt Group, but that the public attribution of most of their last attacks was fundamentally biased: researchers were attributing attacks not to **one** threat actor, but to a specific set of tools and services provided by a specific Malware-as-a-Service (MaaS) provider and used by **multiple** threat actors. In [our <TIMEX3 tid="t8" type="DATE" value="2018">2018</TIMEX3> blog post](https://quointelligence.eu/2018/11/golden-chickens-uncovering-a-malware-as-a-service-maas-provider-and-two-new-threat-actors-using/), we publicly disclosed our analysis of this MaaS, internally named as *Golden Chickens (GC)*, and categorized its multiple clients as GC01, GC02, and GCxx based on their overall motives, means, and opportunities. The peculiarity of the GC MaaS relies on its exclusivity as it is only used for very targeted attacks: if the GC MaaS operator finds out that its services are used for a wide-spread campaign, it will immediately terminate any business relationship with the responsible client. Since our publication, multiple security analysts, researchers, and vendors have cited our publication, and some have contacted us to establish a sharing partnership: * IBM X-Force, [*More\_eggs, Anyone. Threat Actor ITG08 Strikes Again*](https://securityintelligence.com/posts/more_eggs-anyone-threat-actor-itg08-strikes-again/) * ProofPoint, [*Fake Jobs: Campaigns Delivering More\_eggs Backdoor via Fake Job Offers*](https://www.proofpoint.com/us/threat-insight/post/fake-jobs-campaigns-delivering-moreeggs-backdoor-fake-job-offers) * Intezer, [*PureLocker: New Ransomware-as-a-Service Being Used in Targeted Attacks Against Servers*](https://intezer.com/blog-purelocker-ransomware-being-used-in-targeted-attacks-against-servers/) * ReversingLabs, [*Going Behind the Scenes of Cybercrime Group FIN6’s Attack On Retail and Hospitality*](https://blog.reversinglabs.com/blog/going-behind-the-scene-of-cybercrime-group-fin6s-attack-on-retail-and-hospitality) This recognition supports the achievement of our publication’s primary objective: to bring clarification to the community while attributing attacks relying on this MaaS provider, as previously they were often misattributed to other threat actors. Secondly, by declassifying the information contained in this new blog post, we also want to spread further awareness across network defenders and threat intelligence analysts. Due to its success, the GC MaaS is growing in popularity, and multiple top-tier threat actor groups have relied on it for their targeted attacks since at least <TIMEX3 tid="t9" type="DATE" value="2017">2017</TIMEX3>. By ensuring that companies’ digital assets are protected against GC MaaS TTPs, defenders can drastically reduce the risk posed by multiple threat actors. >  > **TO NOTE**: Since we first publicly uncovered GC MaaS operations, we deliberately decided to not publicly expose any information about the MaaS operator. We ask other researchers/vendors to follow and respect our decision (please [contact us](https://quointelligence.eu/#contact) to understand why). >  >  >  Primer: TerraLoader and more\_eggs ================================== As stated before, the purpose of this new blog post is to highlight the latest tools identified in the GC MaaS catalog. For this reason, it is important to first cover the cornerstones of the MaaS, including the two most renown attack tools used to gain initial foothold and establish persistence on a victim’s system. TerraLoader ----------- * Loader — Windows Dynamic Link Library (DLL) * Written in PureBasic * Low AV Detection TerraLoader can be considered as *the* *flagship product* of GC MaaS service portfolio. TerraLoader is a multipurpose loader written in PureBasic, and its inner logics can be seen in all the other Terra* tools provided by the GC MaaS — this is the reason why we use the Terra* naming convention. GC clients use TerraLoader to load second-stage malwares, including more\_eggs, and Remote Access Tools (RATs) such as NetWire, Remcos and Revenge RAT. Although there is a general consensus within the community that TerraLoader and more\_eggs are the same thing, we distinguish them as two separate tools, even if we have never observed more\_eggs being dropped by something different than TerraLoader. The MaaS operator’s service model relies on building a custom loader for each customer, and if required, eventually returning it with the supporting command and control (C2) infrastructure (often hosted on the Kazakh ccTLD, .kz). Starting in <TIMEX3 tid="t10" type="DATE" value="2019-02">February 2019</TIMEX3>, we began observing an increase of TerraLoader variants signed with valid certificates issued to fake companies registered in the U.K.  The new variants demonstrated that signed TerraLoader samples with valid certificates is an extremely effective technique to evade Anti-Virus (AV) solutions, as their initial detection rates ranged from low to undetected. ![](data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==) ![](https://miro.medium.com/max/2172/1*quSa4ihhqAMnI6tucAph1g.png) *Figure 1 —An example of a provider for valid digital certificates* Nowadays, observing malwares signed with legit certificates issued by Comodo/Sectigo is a common trend due to the ease of acquiring those certificates from one of the many providers in the underground forums, as shown in the image above. The business model behind underground certificate providers relies on creating real companies (common occurrence in the U.K.), requesting a valid certificate from a Certificate Authority, and then reselling it. more\_eggs ========== * Backdoor malware * Written in JavaScript (JS) * Fully undetected (FUD) The tool more\_eggs is a JS backdoor capable of beaconing to a fixed C2 server and executing additional payloads downloaded from an external Web resource. The backdoor is loaded onto a victim’s system encrypted, inside of another JavaScript, with obfuscated function names, variable names and encryption keys. By loading an obfuscated JS directly in memory, the GC guarantees clients high resiliency since most AVs fails to detect it. The more\_eggs building kit allows customization of its multiple variables, for values such as the C2 server (Gate*)*, beaconing and sleeping time (hit\_each), and part of the cryptographic key used for ciphering the C2 communications (Rkey). ![Standard more_eggs configuration included in the header](data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==) ![Standard more_eggs configuration included in the header](https://miro.medium.com/max/1466/1*4-c5mmWrm1mHQwZe0qDs-w.png) *Figure 2 — Standard more\_eggs configuration included in the header* GC clients who purchased the more\_eggs variants can further customize the generated JS file by adding specific variables (as long as they don’t interfere with the logic and C2 communications). For instance, more\_eggs samples attributed to GC02 contained the extra unused variable *Researchers*, differently from the ones attributed to other actors. ![more_eggs configuration including a customized variable (Researchers)](data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==) ![more_eggs configuration including a customized variable (Researchers)](https://miro.medium.com/max/1768/1*2DfC-5SBidOeyLmPjZddHg.png) *Figure 3 — more\_eggs configuration including a customized variable (Researchers)* Latest Tools Discovered ======================= As we continue to investigate the attack operations instrumented by the GC MaaS, we are able to uncover more offerings from its catalog. A quick snapshot of the latest discovered tools is depicted in the image below. ![](data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==) ![](https://miro.medium.com/max/4082/1*L8XIH-alxjO85Wfg4i6t6g.png) Figure — 4 GC Maas — New tools classified in <TIMEX3 tid="t11" type="DATE" value="2019">2019</TIMEX3> by QuoINT TerraTV ======= <TIMEX3 tid="t12" type="DATE" value="2018">In 2018</TIMEX3>, [VISA](https://usa.visa.com/dam/VCOM/global/support-legal/documents/fin6-cybercrime-group-expands-threat-To-ecommerce-merchants.pdf) reported attacks attributed to FIN6 that targeted eCommerce merchants. The attacks relied on different GC MaaS malwares and infrastructure, various post exploitation tools, and a malicious signed sample which is noted as a *TeamViewer component*. As we further evaluated the reporting and analyzed the reported samples, we discovered that such TeamViewer component was matching many features of known Terra* variants, such as the use of PureBasic and the implementation of specific obfuscation routines. Hence, we classified the TeamViewer component as TerraTV, and found multiple variants of it while searching across our sources and repositories. The use of TerraTV is observed in the following kill-chain: * A Nullsoft Scriptable Install System (NSIS) installer is deployed on the victim system containing a DLL (TerraLoader) which is executed via `regsvr32.exe` * TerraLoader unpacks a legit TeamViewer client (signed by TeamViewer GmbH) matching the platform (x86 / x64) and a signed DLL `avicap32.dll` (TerraTV). Notably, `avicap32.dll` is a legit Windows DLL residing in `C:\Windows\system32\` containing functions for the Windows API that are required by TeamViewer to stream the user’s desktop over the network * The TeamViewer client is executed and, by leveraging a technique known as [*DLL Search Order Hijacking*](https://attack.mitre.org/techniques/T1038/), it loads the malicious `avicap32.dll` from its own directory before attempting to load the legit one installed in `C:\Windows\system32\` * The malicious DLL, TerraTV, hijacks multiple API calls in order to hide its windows and icon in the system tray (so the victim does not realise that TeamViewer is currently running) and intercepts the client’s access credentials * Stolen access credentials are sent to a hardcoded C2 server * The attackers can remote access into the compromised computer via legit TeamViewer connection The table below lists the four TerraTV sample we collected across <TIMEX3 tid="t13" type="DATE" value="2017">2017</TIMEX3> and <TIMEX3 tid="t14" type="DATE" value="2018">2018</TIMEX3>. All the observed TerraTV samples were signed with legitimate certificates issued by Comodo/Sectigo to registered (fake) companies. | SHA256 | Compilation Timestamp | Signature Date | Certificate Valid To | Certificate Signer | | --- | --- | --- | --- | --- | | b35834b29fae93c8841b4694bac9d06b5df0bf338a53b63fc0d4fa53dbc9f683 | <TIMEX3 tid="t15" type="DATE" value="2017-09-27">2017-09-27</TIMEX3> 15:38:54 | <TIMEX3 tid="t16" type="DATE" value="2017-09-27">2017-09-27</TIMEX3> 21:13:00 | <TIMEX3 tid="t17" type="DATE" value="2017-11-29">2017-11-29</TIMEX3> | IT GRUPP. OOO | | cd56cf243b6ed99804bd85a77667525f728e820e94d751ac42e6f3ea7aa43557 | <TIMEX3 tid="t18" type="DATE" value="2001-08-17">2001-08-17</TIMEX3> 20:52:32 | <TIMEX3 tid="t19" type="DATE" value="2018-09-21">2018-09-21</TIMEX3> 16:19:00 | <TIMEX3 tid="t20" type="DATE" value="2019-07-12">2019-07-12</TIMEX3> | BUDDY ASSIST LIMITED | | 96e906aeb393355fe7b67d465f60e16053e988e51f21ac68b780e3836327532d | <TIMEX3 tid="t21" type="DATE" value="2018-09-26">2018-09-26</TIMEX3> 20:12:40 | <TIMEX3 tid="t22" type="DATE" value="2018-09-26">2018-09-26</TIMEX3> 21:32:00 | <TIMEX3 tid="t23" type="DATE" value="2019-08-21">2019-08-21</TIMEX3> | AJALA INVESTMENTS LTD | | 1adc890756dc9a9f3f50272fa541273968d1feb3d5f51fa415db1ce70c9412d3 | <TIMEX3 tid="t24" type="DATE" value="2019-05-03">2018-10-03</TIMEX3> 16:51:52 | <TIMEX3 tid="t25" type="DATE" value="2018-10-03">2018-10-03</TIMEX3> 17:55:00 | <TIMEX3 tid="t26" type="DATE" value="2019-05-03">2019-05-03</TIMEX3> | MJO TM LTD | TerraRecon ========== TerraRecon is a reconnaissance tool used in highly targeted attacks that occurred at least between <TIMEX3 tid="t27" type="DATE" value="2016">2016</TIMEX3> and <TIMEX3 tid="t28" type="DATE" value="2018">2018</TIMEX3>. Although we are unaware of the full kill-chain that led to the execution of TerraRecon, it is fair to assume that attackers used it as a second or third stage malware. TerraRecon’s primary objective is to scan the infected system for the presence of very specific hardware and software used in the retail and money transfer services, like: * Western Union Software likely used in offices located in Italy * Western Union and Wacom Signing Pads * Yubico’s Yubikeys QuoINT was able to map three different versions of TerraRecon, and — based on the compilation timestamps of the samples analyzed and the timeline when they were likely used — concluded that the malware family potentially existed since at least <TIMEX3 tid="t29" type="DATE" value="2013">2013</TIMEX3>. | TerraRecon Version | SHA256 | Compilation Time | | --- | --- | --- | | Version 3 | 9e254ee0e9d151732f396eba6c748396d6a8c98a3d45e7232c8b3a4786cfded7 | <TIMEX3 tid="t30" type="DATE" value="2017-07-28">2017-07-28</TIMEX3> 09:17:30 | | Version 2 | 56da825d8abb8c57e79bb381c01063073ffdfe3a867744ca11af101685fdce3a | <TIMEX3 tid="t31" type="DATE" value="2016-01-09">2016:01:09</TIMEX3> 19:01:47 | | Version 1 | d36996c032cdf538fc93cfca95cfc4ebaaf2bfb57163248b379bbb3d4883cd73 | <TIMEX3 tid="t32" type="DATE" value="2013-09-07">2013:09:07</TIMEX3> 03:57:15 | During the code analysis of TerraRecon, it was evident that the standalone executable file shares a significant amount of code with TerraLoader, including string obfuscation, key brute-forcing, runtime function resolution, and a kill-switch feature. We assess with high confidence that the same person, either the MaaS operator or a separate malware author, coded both TerraRecon and TerraLoader. As we have previously noted, the MaaS operator’s business model also relies on ad-hoc development request, so the custom development of TerraRecon seems to be a reasonable request. Due to TerraRecon’s focused reconnaissance, we assess with high confidence that the tool was developed for a specific customer, or limited group, having the financial capability to pay for its development. This conclusion likely indicates the request originates from a mid to top tier e-crime operator. By corroborating the scope of the tool, its objectives, its C2 infrastructure, and the sightings timelines, we attributed the exclusive use of TerraRecon to FIN6 with high confidence. TerraRecon gathers system information, checks for file paths, and Active X controls related to very specific software and hardware. TerraRecon v3 first brute-forces the string XOR encryption key and checks if the <TIMEX3 tid="t33" type="DATE" value="2018">current year</TIMEX3> is <TIMEX3 tid="t34" type="DATE" value="2018">2018</TIMEX3>, and if not, it stops. By design, the variant includes a kill-switch functionality indicating that the malware will only operate during the specified year. The malware also performs an Internet connectivity check, as it attempts to resolve the hostname `*ocsp.comodoca.com*`, which which is the valid Online Certificate Status Protocol (OCSP) URL for Comodo used to check the status of a certificate. To note, none of the analyzed TerraRecon variants bear digital signatures. In addition, we did not observe the kill-switch functionality or internet connectivity check in either TerraRecon v2 or v1. The malware will begin the reconnaissance activity on the victim machine by extracting the *pc\_name* and *user\_name* of the system. Next, it walks through a checklist of very specific software/hardware of interest, and whenever one of the checks is successful, a flag is set to make a callback to the C2. If the flag is not set by the end of the checklist, the malware will not callback. If the initial callback fails, the malware will only attempt one additional time. After reporting the checklist matches, it will delete itself via a BAT file. All the analyzed TerraRecon samples make method calls on specific ActiveX controls (COM Object) to determine if the prerequisites on the checklist exist on the victim machine. Essentially, ActiveX controls are a small piece of software used by programs to make it available in the browser. TerraRecon establishes its C2 communication via HTTP GET request and transmits the results of the victim machine check as parameters in the URL.  TerraRecon v3 transmits its results with a long version of the parameters whereas TerraRecon v1 and v2 use a shortened version. Another difference between the variants is that TerraRecon v3 is written in PureBasic, in contrast to TerraRecon v1 and v2 which are written in Visual Basic. The table below lists all main characteristics of TerraTV variants by focusing on the checks they perform on the targeted systems. ![](data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==) ![](https://miro.medium.com/max/2662/1*WbuRnBfPbOEJTYUovyZ87Q.png) *Table 3 — TerraRecon version features and checklist* Interestingly, the file name of the TerraRecon v3 sample that was uploaded to VirusTotal in <TIMEX3 tid="t35" type="DATE" value="2019-03">March 2019</TIMEX3> was ‘*ETDAniConf.exe*’, which imitates the name of a driver used by ELAN (ELAN Microelectronics Corp. Smart-Pads (multi-finger touch pad) for many PC manufacturers. ![](data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==) ![](https://miro.medium.com/max/2676/1*dlblBMyBK-Q7ECz4L1AIhQ.png) *Figure 5 — TerraRecon sample’s information from VirusTotal* Golden Chicken MaaS Licensing — Kill-switch ------------------------------------------- After discovering the GC MaaS operator’s implementation of kill-switch functionality — a feature which disallows the execution of a malware sample beyond a hardcoded date, time or year value — in both TerraRecon and TerraLoader variants, we began to question if it was implemented more widespread throughout the MaaS catalog. As a result, we identified that the GC MaaS operator frequently implemented a kill-switch feature largely in at least TerraLoader samples, dated for the years <TIMEX3 tid="t36" type="DATE" value="2018">2018</TIMEX3> or <TIMEX3 tid="t37" type="DATE" value="2019">2019</TIMEX3>. It is very likely the GC MaaS operator implements the kill-switch feature in order to limit the use of the particular malware a threat actor purchases to keep them as a returning customer, in other words, it’s the GC MaaS way to do *software* *licensing*. TerraStealer ============ First observed in <TIMEX3 tid="t38" type="DATE" value="2017">2017</TIMEX3>, TerraStealer is a malware advertised in underground as SONE (Stealer One) forums by the GC MaaS operator as SONE.  TerraStealer is an information stealer targeting various applications, such as email clients, web browsers, and file transfer utilities. Based on our code analysis of an earlier SONE payload, the malware is sharing all the obfuscation routines and procedure calls during execution as TerraLoader. However, the purpose of the malware differs from TerraLoader as it focuses on information theft. The analyzed TerraStealer variants employ anti-analysis techniques in an attempt to complicate analysis, such as checking the process used to execute it (e.g. `odbcconf.exe` vs `regsvr32.exe`). Traffic to the C2 server is sent over HTTPS after it is encrypted internally, however, Figure 6 shows the initial message to the C2 in plaintext from a memory dump obtained during dynamic analysis. ![](data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==) ![](https://miro.medium.com/max/2502/1*yjBop9suH7LQ0ZeUBxpuFA.png) *Figure 6 — TerraStealer initial C2 message* Further, we observed the following strings while analysing C2 communications: ``` </sone\_email> <sone\_name> <sone\_entry> <sone\_program> </sone\_program> <sone\_protocol> … ``` From observing the deobfuscated payload strings, we can assess with high confidence that TerraStealer functions as an information stealer. TerraStealer targets a list of web browsers, e-mail clients, and FTP clients, including popular products such as Google Chrome, Firefox, Internet Explorer (versions 4–11), Microsoft Edge, Microsoft Outlook <TIMEX3 tid="t39" type="DATE" value="2000">2000</TIMEX3>–<TIMEX3 tid="t40" type="DATE" value="2016">2016</TIMEX3>, Thunderbird, FileZilla, and WinSCP. We have observed multiple GC clients using TerraLoader, more\_eggs and TerraStealer tools in conjunction during their attacks. One of those is FIN6, which VISA [reported](https://usa.visa.com/dam/VCOM/global/support-legal/documents/fin6-cybercrime-group-expands-threat-To-ecommerce-merchants.pdf) being used during the internal reconnaissance phase of the compromised network to gather information and credentials, targeting eCommerce merchants and point-of-sales (PoS) systems. VenomLNK ======== We have observed a Windows Shortcut file dubbed as VenomLNK used in various campaigns involving different infection chains. We hypothesize this is a new variation of a previously highlighted malicious document kit builder known as VenomKit, a building-kit tool that threat actors use to craft malicious Rich Text File (RTF) documents that exploit multiple vulnerabilities. Successful exploitation of those vulnerabilities leads to the delivery of batch and scriptlet files on a system and execution to download the second stage payload from a Web resource. ![](data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==) ![](https://miro.medium.com/max/2010/1*d-vkimNeP7qggIRayl5zVA.png) *Figure 7 — VenomLNK infection chain observed since <TIMEX3 tid="t41" type="DATE" value="2018">2018</TIMEX3>* TerraCrypt ========== Similar to other GC MaaS tools, the TerraCrypt ransomware is written in PureBasic code and shares key code similarities to TerraLoader. <TIMEX3 tid="t42" type="DATE" value="2019-10">In October 2019</TIMEX3>, QuoINT became aware of a new ransomware strain we internally track as TerraCrypt. <TIMEX3 tid="t43" type="DATE" value="2019-11">In November 2019</TIMEX3>, researchers at IBM X-Force and Intezer jointly released a [blog post](http://www.intezer.com/blog-purelocker-ransomware-being-used-in-targeted-attacks-against-servers/) detailing the same ransomware strain, which they dubbed PureLocker. The main TerraCrypt functionality can be resumed as follow: * The ransomware processes files on the infected system by excluding from the decryption certain extensions and paths * For each file to encrypt, it generates a 128bit Initialization Vector (IV) and a 256bit key * Every file is encrypted with AES using the key and the IV (probably CBC mode) * It uses an [hardcoded RSA key](https://gist.githubusercontent.com/m-quoint/0ee693fecff761ab90c0a7f567dfd631/raw/6105b01a4dfd57ff072fa635e0b2b2e2a2d87d68/QuoINT_TerraCrypt_PureCrypt_Hardcoded_Key) to encrypt the AES key and IV and append that encrypted data to the file (512 bits) (HTML table) Although not unique, the ransom note instructs the victim to contact the attacker through the anonymous and encrypted Proton email address to decrypt files, with no mention of payment type or amount. (HTML table) ![](data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==) ![](https://quointelligence.eu/wp-content/uploads/2020/04/ransom_note.png) *Figure 8 — Example of the hardcoded ransom note* The same CR1 string which is included in the attacker’s email address in the ransom note, is also the file extension appended to encrypted files on an infected system and stated at the top of the ransom note. Although the ransom note states, *“Your private key will be deleted after 7 days”,* the malwares does not generate any network traffic. This observation implies that the ransomware does not provide the attacker any capability to understand when (or if) the attack worked. Which implies two hypotheses: * The ransomware is deployed through other loaders or backdoors. For instance, if it is dropped by more\_eggs, attackers would know when and if the ransomware got installed on the targeted machine since they have already maintained persistence on it * Attackers have no way to enforce the seven-days policy since the could not be aware when and if the ransom got installed Due to the tight service level agreement that the GC MaaS operator enforces on his clients (in this case, threat actors using TerraCrypt), we assess the first hypothesis as most likely. TerraWiper ========== <TIMEX3 tid="t44" type="DATE" value="2018-10">In October 2018</TIMEX3> while hunting for TerraCrypt variants we discovered a wiper malware we dubbed TerraWiper. TerraWiper is a Master Boot Record (MBR) wiper compiled from PureBasic, and it uses a slightly different version of the obfuscator used for TerraLoader variants. TerraWiper samples attempt to render a machine unbootable by zero-ing its MBR.  Therefore, it would be possible for an infected computer to easily recover the data, or to make the machine boot again by fixing its MBR. The attribution of TerraWiper to GC MaaS relies on the following traits discovered while reversing its code: * Code written in PureBasic. * Using the same string obfuscation (XOR). * The XOR key is brute-forced in the beginning. * The string obfuscation has the same bug (index starting at 1 not 0). * The calling convention in the compiled binary is different to all the TerraLoader variants we know and other associated GC tools. * Functions are normally imported and called; usually at least the functions being used in the main functionality are loaded dynamically by name, or in later TerraLoader variants, by hash value. * The main code structure looks slightly different, potentially due to the other differences. Based on analysis of the tool, we assess with high confidence that TerraWiper is a tool attributed to the GC MaaS and created or coded by the same author or developer of TerraLoader. Integrated into the samples is a certain User Access Control (UAC) bypass technique which is described [here](https://enigma0x3.net/2016/08/15/fileless-uac-bypass-using-eventvwr-exe-and-registry-hijacking/). Essentially, it involves writing its own executable into the registry under `Software\Classes\mscfile\shell\open\command` and then launching `%SYSTEMROOT%\System32\eventvwr.exe`. If the executable runs with elevated privileges, it then overwrites the MBR and tries to reboot the machine. (HTML table) ![](data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==) ![](https://quointelligence.eu/wp-content/uploads/2020/04/terrawiper_code.png) The [code](https://gist.github.com/m-quoint/ec1d1fc8840303a9f07a47fc12985768#file-quoint_terra_wiper-c) above contains the TerraWiper decompiled function code — it is opening the physical drive and writing 512 bytes zeroes to it, which is effectively overwriting the MBR with zeroes lite\_more\_eggs ================ The tool lite\_more\_eggs is a JS loader similar to the more\_eggs JS backdoor. The JS loader is basically the same code basis as more\_eggs which is the reason we dubbed it lite\_more\_eggs. ![](data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==) ![](https://miro.medium.com/max/4232/1*UUxaAUlIERsO6stuu6YK-g.png) F*igure 9 — comparison of more\_eggs vs lite\_more\_eggs* In our observations of campaigns utilizing lite\_more\_eggs, the JS code drops a more\_eggs variant. In a few select instances where TerraLoader or lite\_more\_eggs variants had no digital certificate, the delivered more\_eggs version was always an older version, specifically “2.0b”. The majority of occurrences involve the use of digitally signed TerraLoader and lite\_more\_eggs variants. ![](data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==) ![](https://miro.medium.com/max/1474/1*dB3fNpal2BvyArMgoc1OcA.png) F*igure 10 — configuration of More\_eggs delivered by a lite\_more\_eggs sample* In the configuration files of more\_eggs variants which were delivered by lite\_more\_eggs, we have continously observed the js gate variable (*lite\_more\_eggs C2*). Conclusion ========== The GC MaaS operator continues to exhibit the ability to offer a versatile catalog of attack tools and its underlying C2 infrastructure. With the identification of all the tools covered in this blog post, it emphasizes that the GC MaaS can offer the entire attack kill-chain to fulfil requests for mid-top tier actors executing targeted operations against high value targets. <TIMEX3 tid="t45" type="DATE" value="2019">In 2019</TIMEX3>, we observed a continuous improvement of GC’s tools, supporting the healthy business that the operator has put in place. We expect the MaaS to continue to prove its success and profitability, as we can confirm at least two top-tier e-crime threat actors have utilized its services among others. Indicator of Compromise ======================= TerraRecon ---------- 9e254ee0e9d151732f396eba6c748396d6a8c98a3d45e7232c8b3a4786cfded7 56da825d8abb8c57e79bb381c01063073ffdfe3a867744ca11af101685fdce3a d36996c032cdf538fc93cfca95cfc4ebaaf2bfb57163248b379bbb3d4883cd73 ### C2s: hxxps://api[.]outlook[.]kz/api/v2 hxxp://update[.]office[.]com[.]kz/ping.php hxxps://mail[.]cdn-line[.]kz/ping.php TerraWiper ---------- 06ec6f367990dfc2d09c505ce03965ac7baa942c39fdacf91844edecc821e72c d3c9791ed73a4d09ee99d74b80bcc75f454011e607bf73a57268ae3485527a3b TerraTV ------- 1adc890756dc9a9f3f50272fa541273968d1feb3d5f51fa415db1ce70c9412d3 cd56cf243b6ed99804bd85a77667525f728e820e94d751ac42e6f3ea7aa43557 b35834b29fae93c8841b4694bac9d06b5df0bf338a53b63fc0d4fa53dbc9f683 ### C2s: hxxps://ssl[.]gstatic[.]kz/ui/v3 hxxps://oneppdatemicro[.]com/login.php hxxps://webmail[.]maildomain[.]kz/include/ajax.php lite\_more\_eggs ---------------- 309a08034a5c0b1f9f0836ee39a366e577766d6009d243f3fd8ebf16f65778d6 (decrypted) ### C2 hxxps://api2[.]gcdn[.]kz/en/v2 MITRE Att&ck ============ TerraRecon ========== **Defense Evasion** ``` [T1107 — File Deletion](https://attack.mitre.org/techniques/T1107/) ``` **Command and Control** ``` [T1043 — Commonly Used Port](https://attack.mitre.org/techniques/T1043/) [T1071 — Standard Application Layer Protocol](https://attack.mitre.org/techniques/T1071/) [T1032 — Standard Cryptographic Protocol](https://attack.mitre.org/techniques/T1032/) ``` **Exfiltration** ``` [T1041 — Exfiltration Over Command and Control Channel](https://attack.mitre.org/techniques/T1041/) ``` **Discovery** ``` [T1082 — System Information Discovery](https://attack.mitre.org/techniques/T1082/) [T1119 — Automated Collection](https://attack.mitre.org/techniques/T1119/) ``` **Execution** ``` [T1064 — Scripting](https://attack.mitre.org/techniques/T1064/) [T1059 — Command-Line Interface](https://attack.mitre.org/techniques/T1059/) ``` TerraStealer ============ **Defense Evasion, Execution** ``` [T1218 — Signed Binary Proxy Execution](https://attack.mitre.org/techniques/T1218/) [T1117 — Regsvr32](https://attack.mitre.org/techniques/T1117/) ``` **Discovery** ``` [T1082 — System Information Discovery](https://attack.mitre.org/techniques/T1082/) [T1119 — Automated Collection](https://attack.mitre.org/techniques/T1119/) ``` **Command and Control** ``` [T1043 — Commonly Used Port](https://attack.mitre.org/techniques/T1043/) [T1071 — Standard Application Layer Protocol](https://attack.mitre.org/techniques/T1071/) [T1032 — Standard Cryptographic Protocol](https://attack.mitre.org/techniques/T1032/) [T1041 — Exfiltration Over Command and Control Channel](https://attack.mitre.org/techniques/T1041/) ``` TerraWiper ========== **Defense Evasion** ``` [T1027 — Obfuscated Files or Information](https://attack.mitre.org/techniques/T1027/) [T1140 — Deobfuscate/Decode Files or Information](https://attack.mitre.org/techniques/T1140/) [T1088 — Bypass User Account Control](https://attack.mitre.org/techniques/T1088/) ``` **Privilege Escalation** ``` [T1088 — Bypass User Account Control](https://attack.mitre.org/techniques/T1088/) ``` **Impact** ``` [T1487 — Disk Structure Wipe](https://attack.mitre.org/techniques/T1487/) [T1529 — System Shutdown/Reboot](https://attack.mitre.org/techniques/T1529/) ``` TerraTV ======= **Defense Evasion** ``` [T1218 — Signed Binary Proxy Execution](https://attack.mitre.org/techniques/T1218/) [T1073 — DLL Side-Loading](https://attack.mitre.org/techniques/T1073/) [T1117 — Regsvr32](https://attack.mitre.org/techniques/T1117/) [T1027 — Obfuscated Files or Information](https://attack.mitre.org/techniques/T1027/) [T1140 — Deobfuscate/Decode Files or Information](https://attack.mitre.org/techniques/T1140/) ``` **Execution** ``` [T1218 — Signed Binary Proxy Execution](https://attack.mitre.org/techniques/T1218/) [T1117 — Regsvr32](https://attack.mitre.org/techniques/T1117/) ``` **Persistence, Privilege Escalation, Credential Access** ``` [T1179 — Hooking](https://attack.mitre.org/techniques/T1179/) [T1038 — DLL Search Order Hijacking](https://attack.mitre.org/techniques/T1038/) ``` **Command and Control** ``` [T1043 — Commonly Used Port](https://attack.mitre.org/techniques/T1043/) [T1071 — Standard Application Layer Protocol](https://attack.mitre.org/techniques/T1071/) [T1032 — Standard Cryptographic Protocol](https://attack.mitre.org/techniques/T1032/) [T1041 — Exfiltration Over Command and Control Channel](https://attack.mitre.org/techniques/T1041/) ``` TerraCrypt ========== **Defense Evasion** ``` [T1027 — Obfuscated Files or Information](https://attack.mitre.org/techniques/T1027/) [T1140 — Deobfuscate/Decode Files or Information](https://attack.mitre.org/techniques/T1140/) ``` **Impact** ``` [T1486 — Data Encrypted for Impact](https://attack.mitre.org/techniques/T1486/) ``` lite\_more\_eggs ================ **Defense Evasion** ``` [T1216 — Signed Script Proxy Execution](https://attack.mitre.org/techniques/T1216/) [T1027 — Obfuscated Files or Information](https://attack.mitre.org/techniques/T1027/) [T1140 — Deobfuscate/Decode Files or Information](https://attack.mitre.org/techniques/T1140/) ``` **Execution** ``` [T1216 — Signed Script Proxy Execution](https://attack.mitre.org/techniques/T1216/) ``` **Command and Control** ``` [T1043 — Commonly Used Port](https://attack.mitre.org/techniques/T1043/) [T1071 — Standard Application Layer Protocol](https://attack.mitre.org/techniques/T1071/) [T1032 — Standard Cryptographic Protocol](https://attack.mitre.org/techniques/T1032/) [T1105 — Remote File Copy](https://attack.mitre.org/techniques/T1105) ``` [Learn more about our Threat Intelligence service](https://quointelligence.eu/#offering) * [Follow](https://twitter.com/QuoIntelligence "Follow on Twitter")[Follow](https://twitter.com/QuoIntelligence "Twitter") * [Follow](https://www.linkedin.com/company/quointelligence/ "Follow on LinkedIn")[Follow](https://www.linkedin.com/company/quointelligence/ "LinkedIn") 
</TEXT>
</TimeML>