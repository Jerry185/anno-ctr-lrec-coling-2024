<?xml version="1.0"?>
<TimeML xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="http://timeml.org/timeMLdocs/TimeML_1.2.1.xsd">
<DCT><TIMEX3 functionInDocument="CREATION_TIME" temporalFunction="false" tid="t0" type="DATE" value="2014-09-05">2014-09-05</TIMEX3></DCT>
<TEXT>
Nuclear Exploit Kit And Flash CVE-2014-0515    <TIMEX3 tid="t1" type="DATE" value="2014-09-05">September 05, 2014</TIMEX3>       For this blog, we'd like to walk you through a recent attack involving Nuclear Exploit Kit (EK) that we analyzed.  It was found leveraging CVE-2014-0515, a buffer overflow in Adobe Flash Player discovered in <TIMEX3 tid="t2" type="DATE" value="2014-04">April 2014</TIMEX3>.  Nuclear Exploit kit targets a number of known vulnerabilities including:  * pdf - PDF:Exploit.PDF-JS  * swf - [CVE-2014-0515](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2014-0515)  * jar  - [CVE-2012-0507](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2012-0507)  Below are the files which were downloaded during the exploitation attempts observed:    | FILE TYPE | MD5 | SIZE | CVE/THREAT | VT HITS |  | FLASH | [A1465ECE32FA3106AA88FD666EBF8C78](https://www.virustotal.com/#/file/e165b73eb2f84f5fd5e85e4aecdfea947e51a0556d70f08924e8f1c28fd1079a/analysis/1409822286/) | 5614 | [CVE-2014-0515](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2014-0515) | 18 / 53 |  | JAR | [A93F603A95282B80D8AFD3F23C4D4889](https://www.virustotal.com/#/file/367e0eb7dba190f23666e2bc89baf5d2f79460a98cf19a5155f7c4b7f1f5c864/analysis/1409822484/) | 12396 | [CVE-2012-0507](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2012-0507) | 26 / 54 |  | PDF | [19ED55EF17A49451D8052D0B51C66239](https://www.virustotal.com/#/file/7ae6cce3edf2f690fbbba2c4da2b6674abb386ff5d3c639b9214fb51fac62879/analysis/) | 9770 | Exploit.PDF-JS | 22 / 54 |  | EXE | [8BCE8A59F9E789BEFB9D178C9A03FB66](https://www.virustotal.com/#/file/355546c6bb8fde63f5cfdd663996df3222aa154f06d33fe4b81c2d5085166ee1/analysis/1409822816/) | 104960 | Win32/Zemot | 39 / 53 |  Although there are other associated vulnerabilities that are being exploited by Nuclear Exploit kit, we will limit this blog post to reviewing the Flash exploitation (CVE-2014-0515).  **Nuclear EK Landing**    Unlike other EKs such as RIG, Nuclear EK's landing page code is highly obfuscated.  [![](/cdn-cgi/image/format=auto/sites/default/files/images/blogs/-8bh9lFvQ2Tg/U_CAy8QJ9tI/AAAAAAAAAKc/0bLlcyXJp20/s1600/Landing_page_Obfuscated.png)](/sites/default/files/images/blogs/-8bh9lFvQ2Tg/U_CAy8QJ9tI/AAAAAAAAAKc/0bLlcyXJp20/s1600/Landing_page_Obfuscated.png)  (Fig 1: Obfuscated Landing Page)     After de-obfuscation, the page looks as follows:    [![](/cdn-cgi/image/format=auto/sites/default/files/images/blogs/-5cvOdasMY9c/U_CBA-FgUpI/AAAAAAAAAKk/GdLBPbAbYMw/s1600/2.png)](/sites/default/files/images/blogs/-5cvOdasMY9c/U_CBA-FgUpI/AAAAAAAAAKk/GdLBPbAbYMw/s1600/2.png)  (Fig 2: De-Obfuscated Landing Page)     Nuclear EK's landing page checks for the following antivirus (AV) driver files and if finds any, terminates the exploitation process.  We have seen these checks before in RIG EK too.  [![](/cdn-cgi/image/format=auto/sites/default/files/images/blogs/-G4b14FF_gkk/U_CBKkeQLDI/AAAAAAAAAKs/ShxYFzrFQp8/s1600/3.png)](/sites/default/files/images/blogs/-G4b14FF_gkk/U_CBKkeQLDI/AAAAAAAAAKs/ShxYFzrFQp8/s1600/3.png)  (Fig 3: Check for AV driver files)    If this AV check is passed, a javascript function then checks the installed Flash version and if a vulnerable version is detected on the client's browser, a call is then made to a dynamic Flash object creation module.  [![](/cdn-cgi/image/format=auto/sites/default/files/images/blogs/-hwAYg8QuDRw/U_CBhO0I3II/AAAAAAAAALE/eVIpPt1ULtw/s1600/6.png)](/sites/default/files/images/blogs/-hwAYg8QuDRw/U_CBhO0I3II/AAAAAAAAALE/eVIpPt1ULtw/s1600/6.png)  (Fig 4: Flash Call)   Here are the vulnerable Flash player checks:    [![](/cdn-cgi/image/format=auto/sites/default/files/images/blogs/-NeC6gkYVjVc/U_CBbS8IGNI/AAAAAAAAAK8/pSmO1pxG-yk/s1600/5.png)](/sites/default/files/images/blogs/-NeC6gkYVjVc/U_CBbS8IGNI/AAAAAAAAAK8/pSmO1pxG-yk/s1600/5.png)  (Fig 5: Checks if vulnerable version installed)    If the version check passes, the Flash exploitation process will commence as seen below.  **CVE-2014-0515 exploit analysis**    Here is the code that dynamically creates a new Flash Object:    [![](/cdn-cgi/image/format=auto/sites/default/files/images/blogs/-HU_R2GXGbkU/U_CBSYY2AyI/AAAAAAAAAK0/a0urhBfH07Y/s1600/4.png)](/sites/default/files/images/blogs/-HU_R2GXGbkU/U_CBSYY2AyI/AAAAAAAAAK0/a0urhBfH07Y/s1600/4.png)  (Fig 6: Flash Object Creation)     The Flash exploit payload that gets downloaded is highly obfuscated to evade AV detection.  Below is a snippet of decompiled code from this Flash exploit:    [![](/cdn-cgi/image/format=auto/sites/default/files/images/blogs/--Ahp1BgVUTw/U_CCKPjjfWI/AAAAAAAAALQ/34jglb43PtU/s1600/7.png)](/sites/default/files/images/blogs/--Ahp1BgVUTw/U_CCKPjjfWI/AAAAAAAAALQ/34jglb43PtU/s1600/7.png)    (Fig 7: Decompiled Flash File)    There are two hard coded snippets of obfuscated shellcode in the action script as seen below:    [![](/cdn-cgi/image/format=auto/sites/default/files/images/blogs/-wBa0ojYuLU4/U_CCaQT3-2I/AAAAAAAAALY/2hu7Zd7Kp1k/s1600/x1.png)](/sites/default/files/images/blogs/-wBa0ojYuLU4/U_CCaQT3-2I/AAAAAAAAALY/2hu7Zd7Kp1k/s1600/x1.png)  [![](/cdn-cgi/image/format=auto/sites/default/files/images/blogs/-Zdq2f7jdyIQ/U_CCer6foXI/AAAAAAAAALg/-ceCcwy-CFU/s1600/x2.png)](/sites/default/files/images/blogs/-Zdq2f7jdyIQ/U_CCer6foXI/AAAAAAAAALg/-ceCcwy-CFU/s1600/x2.png)  (Fig x1,x2: Raw Shellcodes)      After de-obfuscating on the run time, it adds bytecode to a Shader Object from one of the de-obfuscated shell code snippets.  [![](/cdn-cgi/image/format=auto/sites/default/files/images/blogs/-bhqWCW5P8a4/U_CDFUScNhI/AAAAAAAAAMQ/aQWsQmKerDY/s1600/13.png)](/sites/default/files/images/blogs/-bhqWCW5P8a4/U_CDFUScNhI/AAAAAAAAAMQ/aQWsQmKerDY/s1600/13.png)       (Fig 8: Shader Byte Code Filler)    The Shader's Pixel Bender is where this malformed byte code is written, which triggers the vulnerability.  Here is the Malformed byte code:   [![](/cdn-cgi/image/format=auto/sites/default/files/images/blogs/-s0Yxhq1jbNI/VAg9j2IWxnI/AAAAAAAAAOA/bZoKKaPLqyY/s1600/byteCode.png)](/sites/default/files/images/blogs/-s0Yxhq1jbNI/VAg9j2IWxnI/AAAAAAAAAOA/bZoKKaPLqyY/s1600/byteCode.png)  (Fig 9: Malformed data for Pixel Shader)    **Disassembling Pixel Bender's byte code**   We used Tinc Uro's program to get the PixelBender binary data decompiled.  [![](/cdn-cgi/image/format=auto/sites/default/files/images/blogs/-Q8wby6vhbFE/VAhd9lOOFiI/AAAAAAAAAOM/HVqlRYw1uF0/s1600/pixelblender.png)](/sites/default/files/images/blogs/-Q8wby6vhbFE/VAhd9lOOFiI/AAAAAAAAAOM/HVqlRYw1uF0/s1600/pixelblender.png)  (Fig 10: Decompiled PixelBender data)   We can see the inappropriate content here.  The Shader Object takes a float parameter whose default value is set to a matrix of 4x4 floats and the second float value of this matrix is invalid value triggering the vulnerability.  **Conclusion**    Since the downfall of the popular Blackhole Exploit Kit, we have seen the advent of many new Exploit Kits.  Nuclear Exploit Kit definitely ranks in the Top 5 prevalent EKs in the wild at the moment.  We have seen an increasing number of compromised sites and scam pages leading to Nuclear Exploit Kit in past three months.  Some of the notable compromised sites during this time frame that were redirecting to Nuclear EK includes:    SocialBlade.com - A youtube statistics tracking site.  AskMen.com - Men's entertainment website    Facebook.com survey scam pages    Exploit kits generally make use of known vulnerabilities and Flash is a popular target.  CVE-2014-0515 in particular targets a Flash vulnerability in Flash versions before 11.7.700.279 and 11.8.x through 13.0.x before 13.0.0.206 on Windows and OS X, and before 11.2.202.356 on Linux.  It's critical to ensure that your employees aren't running outdated versions of Flash as it is commonly targeted by EKs.  **References:**   * <http://help.adobe.com/en_US/FlashPlatform/reference/actionscript/3/>  * <http://www.semantiscope.com/research/BHDC2010/BHDC-2010-Paper.pdf>  * http://www.kaourantin.net/2008/09/pixel-bender-pbj-files.html  * <http://www.free-decompiler.com/flash/download.html>  * <http://malware-traffic-analysis.net/>  - [Rubin Azad](https://plus.google.com/104146181744475380439/)
</TEXT>
</TimeML>