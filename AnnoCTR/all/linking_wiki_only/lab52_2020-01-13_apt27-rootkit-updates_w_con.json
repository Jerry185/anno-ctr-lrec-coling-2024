{"mention": "APT", "context_left": "January 13, 2020 Within the toolset of the different", "context_right": "groups, one of the most interesting elements and the one that generally worries the most, are their capabilities in Ring0, generally RootKit/Bootkit type threats that act with the maximum level of privileges. An example of this type of threats is the RootKit module of ZxShell RAT used by Emissary Panda (APT27), of which there is a relatively recent sample (Uploaded to Virustotal since 2019-09-21 17:59:39) that is also correctly signed, so it can be loaded in the latest version of Windows 10 and is perfectly functional as far as we have been able to check.", "_context_left": "Within the toolset of the different ", "_context_right": " groups, one of the most interesting elements and the one that generally worries the most, are their capabilities in Ring0, generally RootKit/Bootkit type threats that act with the maximum level of privileges.", "sentence_left": "January 13, 2020", "sentence_right": "An example of this type of threats is the RootKit module of ZxShell RAT used by Emissary Panda (APT27), of which there is a relatively recent sample (Uploaded to Virustotal since 2019-09-21 17:59:39) that is also correctly signed, so it can be loaded in the latest version of Windows 10 and is perfectly functional as far as we have been able to check.", "label": "An advanced persistent threat (APT) is a stealthy computer network attack in which a person or group gains unauthorized access to a network and remains undetected for an extended period. The term's definition was traditionally associated with state sponsorship, but over the last few years there have been multiple examples of non-state sponsored groups conducting large-scale targeted intrusions for specific goals.  An APT may have either business or political motives. APT processes require a high degree of covertness over a long period of time. The \"advanced\" process signifies sophisticated techniques using malware to exploit vulnerabilities in systems. The \"persistent\" process suggests that an external command and control system is continuously monitoring and extracting data from a specific target. The \"threat\" process indicates human involvement in orchestrating the attack.  APT usually refers to a group, such as a government, with both the capability and the intent to target, persistently and effectively, a specific entity. The term is commonly used to refer to cyber threats, in particular that of Internet-enabled espionage using a variety of intelligence gathering techniques to access sensitive information, but applies equally to other threats such as that of traditional espionage or attacks. Other recognized attack vectors include infected media, supply chain compromise, and human intelligence and deception. The purpose of these attacks is to place custom malicious code on one or multiple computers for specific tasks and to remain undetected for the longest possible period. Knowing the attacker artifacts, such as file names, can help a professional make a network-wide search", "label_id": 3008833, "label_title": "Advanced persistent threat", "label_link": "https://en.wikipedia.org/wiki?curid=25874360", "entity_class": "CE", "entity_type": "CON", "document": "lab52_2020-01-13_apt27-rootkit-updates"}
{"mention": "lab52", "context_left": "An example of this type of threats is the RootKit module of ZxShell RAT used by Emissary Panda (APT27), of which there is a relatively recent sample (Uploaded to Virustotal since 2019-09-21 17:59:39) that is also correctly signed, so it can be loaded in the latest version of Windows 10 and is perfectly functional as far as we have been able to check. ![](https://", "context_right": ".io/blog/wp-content/uploads/2020/01/Captura-de-pantalla-de-2020-01-13-11-32-47.png) Sysmon DriverLoaded event", "_context_left": "![](https://", "_context_right": ".io/blog/wp-content/uploads/2020/01/Captura-de-pantalla-de-2020-01-13-11-32-47.png)", "sentence_left": "An example of this type of threats is the RootKit module of ZxShell RAT used by Emissary Panda (APT27), of which there is a relatively recent sample (Uploaded to Virustotal since 2019-09-21 17:59:39) that is also correctly signed, so it can be loaded in the latest version of Windows 10 and is perfectly functional as far as we have been able to check.", "sentence_right": "Sysmon DriverLoaded event", "label": "A company, abbreviated as co., is a legal entity made up of an association of people, be they natural, legal, or a mixture of both, for carrying on a commercial or industrial enterprise. Company members share a common purpose, and unite to focus their various talents and organize their collectively available skills or resources to achieve specific, declared goals. Companies take various forms, such as:   A company or association of persons can be created at law as a legal person so that the company in itself can accept limited liability for civil responsibility and taxation incurred as members perform (or fail to discharge) their duty within the publicly declared \"\"birth certificate\"\" or published policy.  Companies as legal persons may associate and register themselves collectively as other companies – often known as a corporate group. When a company closes, it may need a \"\"death certificate\"\" to avoid further legal obligations.", "label_id": 986634, "label_title": "Company", "label_link": "https://en.wikipedia.org/wiki?curid=4918223", "entity_class": "NE", "entity_type": "ORG", "document": "lab52_2020-01-13_apt27-rootkit-updates"}
{"mention": "GitHub", "context_left": "A complete analysis of this threat can be found made by the analyst Ori Damari (@0xrepnz) in his blog (<https://repnz.github.io/posts/autochk-rootkit-analysis/>). After analyzing this threat and describing its capabilities, he has rewritten the source code from a sample of this threat uploaded in 2018 to Virustotal, and published it in", "context_right": ", which greatly facilitates the analysis of newer versions. As he describes in his blog, the capabilities of this Rootkit are basically the following:", "_context_left": "After analyzing this threat and describing its capabilities, he has rewritten the source code from a sample of this threat uploaded in 2018 to Virustotal, and published it in ", "_context_right": ", which greatly facilitates the analysis of newer versions.", "sentence_left": "A complete analysis of this threat can be found made by the analyst Ori Damari (@0xrepnz) in his blog (<https://repnz.github.io/posts/autochk-rootkit-analysis/>).", "sentence_right": "As he describes in his blog, the capabilities of this Rootkit are basically the following:", "label": "GitHub is an American company that provides hosting for software development version control using Git. It is a subsidiary of Microsoft, which acquired the company in 2018 for $7.5 billion. It offers all of the distributed version control and source code management (SCM) functionality of Git as well as adding its own features. It provides access control and several collaboration features such as bug tracking, feature requests, task management, and wikis for every project.  GitHub offers plans for free, professional, and enterprise accounts. Free GitHub accounts are commonly used to host open source projects. As of January 2019, GitHub offers unlimited private repositories to all plans, including free accounts. As of May 2019, GitHub reports having over 37 million users and more than 100 million repositories (including at least 28 million public repositories), making it the largest host of source code in the world.", "label_id": 2294705, "label_title": "GitHub", "label_link": "https://en.wikipedia.org/wiki?curid=18545292", "entity_class": "NE", "entity_type": "ORG", "document": "lab52_2020-01-13_apt27-rootkit-updates"}
{"mention": "lab52", "context_left": "If you try to call CreateFile() to open a malicious file you’ll get a handle to a benign file. ![](https://", "context_right": ".io/blog/wp-content/uploads/2020/01/Captura-de-pantalla-de-2020-01-13-11-39-50_arrows-1024x435.png) * **Network Connection Hiding**", "_context_left": "![](https://", "_context_right": ".io/blog/wp-content/uploads/2020/01/Captura-de-pantalla-de-2020-01-13-11-39-50_arrows-1024x435.png)", "sentence_left": "If you try to call CreateFile() to open a malicious file you’ll get a handle to a benign file.", "sentence_right": "* **Network Connection Hiding**", "label": "A company, abbreviated as co., is a legal entity made up of an association of people, be they natural, legal, or a mixture of both, for carrying on a commercial or industrial enterprise. Company members share a common purpose, and unite to focus their various talents and organize their collectively available skills or resources to achieve specific, declared goals. Companies take various forms, such as:   A company or association of persons can be created at law as a legal person so that the company in itself can accept limited liability for civil responsibility and taxation incurred as members perform (or fail to discharge) their duty within the publicly declared \"\"birth certificate\"\" or published policy.  Companies as legal persons may associate and register themselves collectively as other companies – often known as a corporate group. When a company closes, it may need a \"\"death certificate\"\" to avoid further legal obligations.", "label_id": 986634, "label_title": "Company", "label_link": "https://en.wikipedia.org/wiki?curid=4918223", "entity_class": "NE", "entity_type": "ORG", "document": "lab52_2020-01-13_apt27-rootkit-updates"}
{"mention": "GitHub", "context_left": "We found interesting to analyze the differences between the 2018 version and the most recent 2019 version in order to try to identify new capabilities or changes in its capabilities. After comparing both samples using the", "context_right": "source code, we have been able to see that most of the functions are identical, except for 5 of them (including the Driver’s entrypoint): ![](https://lab52.io/blog/wp-content/uploads/2020/01/Captura-de-pantalla-de-2020-01-10-14-25-57-1024x188.png)", "_context_left": "After comparing both samples using the ", "_context_right": " source code, we have been able to see that most of the functions are identical, except for 5 of them (including the Driver’s entrypoint):", "sentence_left": "We found interesting to analyze the differences between the 2018 version and the most recent 2019 version in order to try to identify new capabilities or changes in its capabilities.", "sentence_right": "![](https://lab52.io/blog/wp-content/uploads/2020/01/Captura-de-pantalla-de-2020-01-10-14-25-57-1024x188.png)", "label": "GitHub is an American company that provides hosting for software development version control using Git. It is a subsidiary of Microsoft, which acquired the company in 2018 for $7.5 billion. It offers all of the distributed version control and source code management (SCM) functionality of Git as well as adding its own features. It provides access control and several collaboration features such as bug tracking, feature requests, task management, and wikis for every project.  GitHub offers plans for free, professional, and enterprise accounts. Free GitHub accounts are commonly used to host open source projects. As of January 2019, GitHub offers unlimited private repositories to all plans, including free accounts. As of May 2019, GitHub reports having over 37 million users and more than 100 million repositories (including at least 28 million public repositories), making it the largest host of source code in the world.", "label_id": 2294705, "label_title": "GitHub", "label_link": "https://en.wikipedia.org/wiki?curid=18545292", "entity_class": "NE", "entity_type": "ORG", "document": "lab52_2020-01-13_apt27-rootkit-updates"}
{"mention": "lab52", "context_left": "After comparing both samples using the GitHub source code, we have been able to see that most of the functions are identical, except for 5 of them (including the Driver’s entrypoint): ![](https://", "context_right": ".io/blog/wp-content/uploads/2020/01/Captura-de-pantalla-de-2020-01-10-14-25-57-1024x188.png) Identical functions in both versions", "_context_left": "![](https://", "_context_right": ".io/blog/wp-content/uploads/2020/01/Captura-de-pantalla-de-2020-01-10-14-25-57-1024x188.png)", "sentence_left": "After comparing both samples using the GitHub source code, we have been able to see that most of the functions are identical, except for 5 of them (including the Driver’s entrypoint):", "sentence_right": "Identical functions in both versions", "label": "A company, abbreviated as co., is a legal entity made up of an association of people, be they natural, legal, or a mixture of both, for carrying on a commercial or industrial enterprise. Company members share a common purpose, and unite to focus their various talents and organize their collectively available skills or resources to achieve specific, declared goals. Companies take various forms, such as:   A company or association of persons can be created at law as a legal person so that the company in itself can accept limited liability for civil responsibility and taxation incurred as members perform (or fail to discharge) their duty within the publicly declared \"\"birth certificate\"\" or published policy.  Companies as legal persons may associate and register themselves collectively as other companies – often known as a corporate group. When a company closes, it may need a \"\"death certificate\"\" to avoid further legal obligations.", "label_id": 986634, "label_title": "Company", "label_link": "https://en.wikipedia.org/wiki?curid=4918223", "entity_class": "NE", "entity_type": "ORG", "document": "lab52_2020-01-13_apt27-rootkit-updates"}
{"mention": "lab52", "context_left": "Identical functions in both versions ![](https://", "context_right": ".io/blog/wp-content/uploads/2020/01/Captura-de-pantalla-de-2020-01-10-14-25-24.png) Different functions", "_context_left": "![](https://", "_context_right": ".io/blog/wp-content/uploads/2020/01/Captura-de-pantalla-de-2020-01-10-14-25-24.png)", "sentence_left": "Identical functions in both versions", "sentence_right": "Different functions", "label": "A company, abbreviated as co., is a legal entity made up of an association of people, be they natural, legal, or a mixture of both, for carrying on a commercial or industrial enterprise. Company members share a common purpose, and unite to focus their various talents and organize their collectively available skills or resources to achieve specific, declared goals. Companies take various forms, such as:   A company or association of persons can be created at law as a legal person so that the company in itself can accept limited liability for civil responsibility and taxation incurred as members perform (or fail to discharge) their duty within the publicly declared \"\"birth certificate\"\" or published policy.  Companies as legal persons may associate and register themselves collectively as other companies – often known as a corporate group. When a company closes, it may need a \"\"death certificate\"\" to avoid further legal obligations.", "label_id": 986634, "label_title": "Company", "label_link": "https://en.wikipedia.org/wiki?curid=4918223", "entity_class": "NE", "entity_type": "ORG", "document": "lab52_2020-01-13_apt27-rootkit-updates"}
{"mention": "lab52", "context_left": "* The first one basically consists in that they have reversed the list of strings that identify the files that the Driver hides by default when it is loaded: ![](https://", "context_right": ".io/blog/wp-content/uploads/2020/01/Captura-de-pantalla-de-2020-01-13-12-48-53.png)Old and New list of file names At code level, the impact this has had is that the function that redirects these files, now uses the “wcrev” function that flips the strings before passing them to the function that hides the files:", "_context_left": "![](https://", "_context_right": ".io/blog/wp-content/uploads/2020/01/Captura-de-pantalla-de-2020-01-13-12-48-53.png)Old and New list of file names", "sentence_left": "* The first one basically consists in that they have reversed the list of strings that identify the files that the Driver hides by default when it is loaded:", "sentence_right": "At code level, the impact this has had is that the function that redirects these files, now uses the “wcrev” function that flips the strings before passing them to the function that hides the files:", "label": "A company, abbreviated as co., is a legal entity made up of an association of people, be they natural, legal, or a mixture of both, for carrying on a commercial or industrial enterprise. Company members share a common purpose, and unite to focus their various talents and organize their collectively available skills or resources to achieve specific, declared goals. Companies take various forms, such as:   A company or association of persons can be created at law as a legal person so that the company in itself can accept limited liability for civil responsibility and taxation incurred as members perform (or fail to discharge) their duty within the publicly declared \"\"birth certificate\"\" or published policy.  Companies as legal persons may associate and register themselves collectively as other companies – often known as a corporate group. When a company closes, it may need a \"\"death certificate\"\" to avoid further legal obligations.", "label_id": 986634, "label_title": "Company", "label_link": "https://en.wikipedia.org/wiki?curid=4918223", "entity_class": "NE", "entity_type": "ORG", "document": "lab52_2020-01-13_apt27-rootkit-updates"}
{"mention": "lab52", "context_left": "At code level, the impact this has had is that the function that redirects these files, now uses the “wcrev” function that flips the strings before passing them to the function that hides the files: ![](https://", "context_right": ".io/blog/wp-content/uploads/2020/01/Captura-de-pantalla-de-2020-01-13-11-19-52Arrows-1024x346.png) New code (Red) and old code (Green)", "_context_left": "![](https://", "_context_right": ".io/blog/wp-content/uploads/2020/01/Captura-de-pantalla-de-2020-01-13-11-19-52Arrows-1024x346.png)", "sentence_left": "At code level, the impact this has had is that the function that redirects these files, now uses the “wcrev” function that flips the strings before passing them to the function that hides the files:", "sentence_right": "New code (Red) and old code (Green)", "label": "A company, abbreviated as co., is a legal entity made up of an association of people, be they natural, legal, or a mixture of both, for carrying on a commercial or industrial enterprise. Company members share a common purpose, and unite to focus their various talents and organize their collectively available skills or resources to achieve specific, declared goals. Companies take various forms, such as:   A company or association of persons can be created at law as a legal person so that the company in itself can accept limited liability for civil responsibility and taxation incurred as members perform (or fail to discharge) their duty within the publicly declared \"\"birth certificate\"\" or published policy.  Companies as legal persons may associate and register themselves collectively as other companies – often known as a corporate group. When a company closes, it may need a \"\"death certificate\"\" to avoid further legal obligations.", "label_id": 986634, "label_title": "Company", "label_link": "https://en.wikipedia.org/wiki?curid=4918223", "entity_class": "NE", "entity_type": "ORG", "document": "lab52_2020-01-13_apt27-rootkit-updates"}
{"mention": "Microsoft", "context_left": "New code (Red) and old code (Green) * Secondly, they have tried to disguise their use of the undocumented", "context_right": "API “ObReferenceObjectByName”, which is used to get the pointer to the different Driver\\_Object drivers they intend to hook in each case. Until now, they had the name of this function in their strings, and used it to resolve it by passing its name to the MmGetSystemRoutineAddress API which returns a pointer to it.", "_context_left": "* Secondly, they have tried to disguise their use of the undocumented ", "_context_right": " API “ObReferenceObjectByName”, which is used to get the pointer to the different Driver\\_Object drivers they intend to hook in each case.", "sentence_left": "New code (Red) and old code (Green)", "sentence_right": "Until now, they had the name of this function in their strings, and used it to resolve it by passing its name to the MmGetSystemRoutineAddress API which returns a pointer to it.", "label": "Microsoft Corporation is an American multinational technology company with headquarters in Redmond, Washington. It develops, manufactures, licenses, supports and sells computer software, consumer electronics, personal computers, and related services. Its best known software products are the Microsoft Windows line of operating systems, the Microsoft Office suite, and the Internet Explorer and Edge Web browsers. Its flagship hardware products are the Xbox video game consoles and the Microsoft Surface lineup of touchscreen personal computers. As of 2016, it is the world's largest software maker by revenue, and one of the world's most valuable companies. The word \"Microsoft\" is a portmanteau of \"microcomputer\" and \"software\". Microsoft is ranked No. 30 in the 2018 Fortune 500 rankings of the largest United States corporations by total revenue.  Microsoft was founded by Bill Gates and Paul Allen on April 4, 1975, to develop and sell BASIC interpreters for the Altair 8800. It rose to dominate the personal computer operating system market with MS-DOS in the mid-1980s, followed by Microsoft Windows. The company's 1986 initial public offering (IPO), and subsequent rise in its share price, created three billionaires and an estimated 12,000 millionaires among Microsoft employees. Since the 1990s, it has increasingly diversified from the operating system market and has made a number of corporate acquisitions, their largest being the acquisition of LinkedIn for $26.2 billion in December 2016, followed by their acquisition of Skype Technologies for $8.5 billion in May 2011.  , Microsoft is market-dominant in the IBM PC compatible operating system market and the office software suite", "label_id": 9231, "label_title": "Microsoft", "label_link": "https://en.wikipedia.org/wiki?curid=19001", "entity_class": "NE", "entity_type": "ORG", "document": "lab52_2020-01-13_apt27-rootkit-updates"}
{"mention": "lab52", "context_left": "Now they only keep part of the name, and complete the rest in a slightly more complex way before calling MmGetSystemRoutineAddress by building it from characters they store in the registers and other areas of the binary: ![](https://", "context_right": ".io/blog/wp-content/uploads/2020/01/Captura-de-pantalla-de-2020-01-13-11-34-49-1-1024x564.png) *New code (Red) and old code (Green)*", "_context_left": "![](https://", "_context_right": ".io/blog/wp-content/uploads/2020/01/Captura-de-pantalla-de-2020-01-13-11-34-49-1-1024x564.png)", "sentence_left": "Now they only keep part of the name, and complete the rest in a slightly more complex way before calling MmGetSystemRoutineAddress by building it from characters they store in the registers and other areas of the binary:", "sentence_right": "*New code (Red) and old code (Green)*", "label": "A company, abbreviated as co., is a legal entity made up of an association of people, be they natural, legal, or a mixture of both, for carrying on a commercial or industrial enterprise. Company members share a common purpose, and unite to focus their various talents and organize their collectively available skills or resources to achieve specific, declared goals. Companies take various forms, such as:   A company or association of persons can be created at law as a legal person so that the company in itself can accept limited liability for civil responsibility and taxation incurred as members perform (or fail to discharge) their duty within the publicly declared \"\"birth certificate\"\" or published policy.  Companies as legal persons may associate and register themselves collectively as other companies – often known as a corporate group. When a company closes, it may need a \"\"death certificate\"\" to avoid further legal obligations.", "label_id": 986634, "label_title": "Company", "label_link": "https://en.wikipedia.org/wiki?curid=4918223", "entity_class": "NE", "entity_type": "ORG", "document": "lab52_2020-01-13_apt27-rootkit-updates"}
{"mention": "lab52", "context_left": "An example is the end of the driver entry function, where untill now, at the end they only called two functions that initialized the logic of hiding connections and redirecting files, and now, they have extracted part of the logic of these functions and moved it right after each one of them, but without any impact on the capabilities and behavior of the Driver: ![](https://", "context_right": ".io/blog/wp-content/uploads/2020/01/Captura-de-pantalla-de-2020-01-10-14-49-10-1024x130.png) *New code (Red) and old code (Green)﻿*", "_context_left": "![](https://", "_context_right": ".io/blog/wp-content/uploads/2020/01/Captura-de-pantalla-de-2020-01-10-14-49-10-1024x130.png)", "sentence_left": "An example is the end of the driver entry function, where untill now, at the end they only called two functions that initialized the logic of hiding connections and redirecting files, and now, they have extracted part of the logic of these functions and moved it right after each one of them, but without any impact on the capabilities and behavior of the Driver:", "sentence_right": "*New code (Red) and old code (Green)﻿*", "label": "A company, abbreviated as co., is a legal entity made up of an association of people, be they natural, legal, or a mixture of both, for carrying on a commercial or industrial enterprise. Company members share a common purpose, and unite to focus their various talents and organize their collectively available skills or resources to achieve specific, declared goals. Companies take various forms, such as:   A company or association of persons can be created at law as a legal person so that the company in itself can accept limited liability for civil responsibility and taxation incurred as members perform (or fail to discharge) their duty within the publicly declared \"\"birth certificate\"\" or published policy.  Companies as legal persons may associate and register themselves collectively as other companies – often known as a corporate group. When a company closes, it may need a \"\"death certificate\"\" to avoid further legal obligations.", "label_id": 986634, "label_title": "Company", "label_link": "https://en.wikipedia.org/wiki?curid=4918223", "entity_class": "NE", "entity_type": "ORG", "document": "lab52_2020-01-13_apt27-rootkit-updates"}