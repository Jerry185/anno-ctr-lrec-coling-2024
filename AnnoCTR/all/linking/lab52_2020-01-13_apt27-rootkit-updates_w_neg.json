{"mention": "APT27", "context_left": "", "context_right": "ZxShell RootKit module updates", "_context_left": "", "_context_right": " ZxShell RootKit module updates", "sentence_left": "", "sentence_right": "January 13, 2020", "label": "Emissary Panda", "label_id": 1335, "label_title": "Emissary Panda", "label_link": "http://www.bosch.com#node1fvup9pj1x44", "entity_class": "CE", "entity_type": "GROUP", "document": "lab52_2020-01-13_apt27-rootkit-updates"}
{"mention": "ZxShell", "context_left": "APT27", "context_right": "RootKit module updates", "_context_left": "APT27 ", "_context_right": " RootKit module updates", "sentence_left": "", "sentence_right": "January 13, 2020", "label": "[ZxShell](https://attack.mitre.org/software/S0412) is a remote administration tool and backdoor that can be downloaded from the Internet, particularly from Chinese hacker websites. It has been used since at least 2004.(Citation: FireEye APT41 Aug 2019)(Citation: Talos ZxShell Oct 2014 )", "label_id": 1001, "label_title": "ZxShell", "label_link": "https://attack.mitre.org/software/S0412", "entity_class": "CE", "entity_type": "MALWARE", "document": "lab52_2020-01-13_apt27-rootkit-updates"}
{"mention": "RootKit", "context_left": "APT27 ZxShell", "context_right": "module updates", "_context_left": "APT27 ZxShell ", "_context_right": " module updates", "sentence_left": "", "sentence_right": "January 13, 2020", "label": "Adversaries may use rootkits to hide the presence of programs, files, network connections, services, drivers, and other system components. Rootkits are programs that hide the existence of malware by intercepting/hooking and modifying operating system API calls that supply system information. (Citation: Symantec Windows Rootkits) Rootkits or rootkit enabling functionality may reside at the user or kernel level in the operating system or lower, to include a hypervisor, Master Boot Record, or [System Firmware](https://attack.mitre.org/techniques/T1542/001). (Citation: Wikipedia Rootkit) Rootkits have been seen for Windows, Linux, and Mac OS X systems. (Citation: CrowdStrike Linux Rootkit) (Citation: BlackHat Mac OSX Rootkit)", "label_id": 57, "label_title": "Rootkit", "label_link": "https://attack.mitre.org/techniques/T1014", "entity_class": "CE", "entity_type": "TECHNIQUE", "document": "lab52_2020-01-13_apt27-rootkit-updates"}
{"mention": "APT", "context_left": "Within the toolset of the different", "context_right": "groups, one of the most interesting elements and the one that generally worries the most, are their capabilities in Ring0, generally RootKit/Bootkit type threats that act with the maximum level of privileges.", "_context_left": "Within the toolset of the different ", "_context_right": " groups, one of the most interesting elements and the one that generally worries the most, are their capabilities in Ring0, generally RootKit/Bootkit type threats that act with the maximum level of privileges.", "sentence_left": "January 13, 2020", "sentence_right": "An example of this type of threats is the RootKit module of ZxShell RAT used by Emissary Panda (APT27), of which there is a relatively recent sample (Uploaded to Virustotal since 2019-09-21 17:59:39) that is also correctly signed, so it can be loaded in the latest version of Windows 10 and is perfectly functional as far as we have been able to check.", "label": "An advanced persistent threat (APT) is a stealthy computer network attack in which a person or group gains unauthorized access to a network and remains undetected for an extended period. The term's definition was traditionally associated with state sponsorship, but over the last few years there have been multiple examples of non-state sponsored groups conducting large-scale targeted intrusions for specific goals.  An APT may have either business or political motives. APT processes require a high degree of covertness over a long period of time. The \"advanced\" process signifies sophisticated techniques using malware to exploit vulnerabilities in systems. The \"persistent\" process suggests that an external command and control system is continuously monitoring and extracting data from a specific target. The \"threat\" process indicates human involvement in orchestrating the attack.  APT usually refers to a group, such as a government, with both the capability and the intent to target, persistently and effectively, a specific entity. The term is commonly used to refer to cyber threats, in particular that of Internet-enabled espionage using a variety of intelligence gathering techniques to access sensitive information, but applies equally to other threats such as that of traditional espionage or attacks. Other recognized attack vectors include infected media, supply chain compromise, and human intelligence and deception. The purpose of these attacks is to place custom malicious code on one or multiple computers for specific tasks and to remain undetected for the longest possible period. Knowing the attacker artifacts, such as file names, can help a professional make a network-wide search", "label_id": 3008833, "label_title": "Advanced persistent threat", "label_link": "https://en.wikipedia.org/wiki?curid=25874360", "entity_class": "CE", "entity_type": "CON", "document": "lab52_2020-01-13_apt27-rootkit-updates"}
{"mention": "RootKit", "context_left": "Within the toolset of the different APT groups, one of the most interesting elements and the one that generally worries the most, are their capabilities in Ring0, generally", "context_right": "/Bootkit type threats that act with the maximum level of privileges.", "_context_left": "Within the toolset of the different APT groups, one of the most interesting elements and the one that generally worries the most, are their capabilities in Ring0, generally ", "_context_right": "/Bootkit type threats that act with the maximum level of privileges.", "sentence_left": "January 13, 2020", "sentence_right": "An example of this type of threats is the RootKit module of ZxShell RAT used by Emissary Panda (APT27), of which there is a relatively recent sample (Uploaded to Virustotal since 2019-09-21 17:59:39) that is also correctly signed, so it can be loaded in the latest version of Windows 10 and is perfectly functional as far as we have been able to check.", "label": "Adversaries may use rootkits to hide the presence of programs, files, network connections, services, drivers, and other system components. Rootkits are programs that hide the existence of malware by intercepting/hooking and modifying operating system API calls that supply system information. (Citation: Symantec Windows Rootkits) Rootkits or rootkit enabling functionality may reside at the user or kernel level in the operating system or lower, to include a hypervisor, Master Boot Record, or [System Firmware](https://attack.mitre.org/techniques/T1542/001). (Citation: Wikipedia Rootkit) Rootkits have been seen for Windows, Linux, and Mac OS X systems. (Citation: CrowdStrike Linux Rootkit) (Citation: BlackHat Mac OSX Rootkit)", "label_id": 57, "label_title": "Rootkit", "label_link": "https://attack.mitre.org/techniques/T1014", "entity_class": "CE", "entity_type": "TECHNIQUE", "document": "lab52_2020-01-13_apt27-rootkit-updates"}
{"mention": "Bootkit", "context_left": "Within the toolset of the different APT groups, one of the most interesting elements and the one that generally worries the most, are their capabilities in Ring0, generally RootKit/", "context_right": "type threats that act with the maximum level of privileges.", "_context_left": "Within the toolset of the different APT groups, one of the most interesting elements and the one that generally worries the most, are their capabilities in Ring0, generally RootKit/", "_context_right": " type threats that act with the maximum level of privileges.", "sentence_left": "January 13, 2020", "sentence_right": "An example of this type of threats is the RootKit module of ZxShell RAT used by Emissary Panda (APT27), of which there is a relatively recent sample (Uploaded to Virustotal since 2019-09-21 17:59:39) that is also correctly signed, so it can be loaded in the latest version of Windows 10 and is perfectly functional as far as we have been able to check.", "label": "Adversaries may abuse Pre-OS Boot mechanisms as a way to establish persistence on a system. During the booting process of a computer, firmware and various startup services are loaded before the operating system. These programs control flow of execution before the operating system takes control.(Citation: Wikipedia Booting) Adversaries may overwrite data in boot drivers or firmware such as BIOS (Basic Input/Output System) and The Unified Extensible Firmware Interface (UEFI) to persist on systems at a layer below the operating system. This can be particularly difficult to detect as malware at this level will not be detected by host software-based defenses.", "label_id": 311, "label_title": "Pre-OS Boot", "label_link": "https://attack.mitre.org/techniques/T1542", "entity_class": "CE", "entity_type": "TECHNIQUE", "document": "lab52_2020-01-13_apt27-rootkit-updates"}
{"mention": "RootKit", "context_left": "An example of this type of threats is the", "context_right": "module of ZxShell RAT used by Emissary Panda (APT27), of which there is a relatively recent sample (Uploaded to Virustotal since 2019-09-21 17:59:39) that is also correctly signed, so it can be loaded in the latest version of Windows 10 and is perfectly functional as far as we have been able to check.", "_context_left": "An example of this type of threats is the ", "_context_right": " module of ZxShell RAT used by Emissary Panda (APT27), of which there is a relatively recent sample (Uploaded to Virustotal since 2019-09-21 17:59:39) that is also correctly signed, so it can be loaded in the latest version of Windows 10 and is perfectly functional as far as we have been able to check.", "sentence_left": "Within the toolset of the different APT groups, one of the most interesting elements and the one that generally worries the most, are their capabilities in Ring0, generally RootKit/Bootkit type threats that act with the maximum level of privileges.", "sentence_right": "![](https://lab52.io/blog/wp-content/uploads/2020/01/Captura-de-pantalla-de-2020-01-13-11-32-47.png)", "label": "Adversaries may use rootkits to hide the presence of programs, files, network connections, services, drivers, and other system components. Rootkits are programs that hide the existence of malware by intercepting/hooking and modifying operating system API calls that supply system information. (Citation: Symantec Windows Rootkits) Rootkits or rootkit enabling functionality may reside at the user or kernel level in the operating system or lower, to include a hypervisor, Master Boot Record, or [System Firmware](https://attack.mitre.org/techniques/T1542/001). (Citation: Wikipedia Rootkit) Rootkits have been seen for Windows, Linux, and Mac OS X systems. (Citation: CrowdStrike Linux Rootkit) (Citation: BlackHat Mac OSX Rootkit)", "label_id": 57, "label_title": "Rootkit", "label_link": "https://attack.mitre.org/techniques/T1014", "entity_class": "CE", "entity_type": "TECHNIQUE", "document": "lab52_2020-01-13_apt27-rootkit-updates"}
{"mention": "ZxShell", "context_left": "An example of this type of threats is the RootKit module of", "context_right": "RAT used by Emissary Panda (APT27), of which there is a relatively recent sample (Uploaded to Virustotal since 2019-09-21 17:59:39) that is also correctly signed, so it can be loaded in the latest version of Windows 10 and is perfectly functional as far as we have been able to check.", "_context_left": "An example of this type of threats is the RootKit module of ", "_context_right": " RAT used by Emissary Panda (APT27), of which there is a relatively recent sample (Uploaded to Virustotal since 2019-09-21 17:59:39) that is also correctly signed, so it can be loaded in the latest version of Windows 10 and is perfectly functional as far as we have been able to check.", "sentence_left": "Within the toolset of the different APT groups, one of the most interesting elements and the one that generally worries the most, are their capabilities in Ring0, generally RootKit/Bootkit type threats that act with the maximum level of privileges.", "sentence_right": "![](https://lab52.io/blog/wp-content/uploads/2020/01/Captura-de-pantalla-de-2020-01-13-11-32-47.png)", "label": "[ZxShell](https://attack.mitre.org/software/S0412) is a remote administration tool and backdoor that can be downloaded from the Internet, particularly from Chinese hacker websites. It has been used since at least 2004.(Citation: FireEye APT41 Aug 2019)(Citation: Talos ZxShell Oct 2014 )", "label_id": 1001, "label_title": "ZxShell", "label_link": "https://attack.mitre.org/software/S0412", "entity_class": "CE", "entity_type": "MALWARE", "document": "lab52_2020-01-13_apt27-rootkit-updates"}
{"mention": "Emissary Panda", "context_left": "An example of this type of threats is the RootKit module of ZxShell RAT used by", "context_right": "(APT27), of which there is a relatively recent sample (Uploaded to Virustotal since 2019-09-21 17:59:39) that is also correctly signed, so it can be loaded in the latest version of Windows 10 and is perfectly functional as far as we have been able to check.", "_context_left": "An example of this type of threats is the RootKit module of ZxShell RAT used by ", "_context_right": " (APT27), of which there is a relatively recent sample (Uploaded to Virustotal since 2019-09-21 17:59:39) that is also correctly signed, so it can be loaded in the latest version of Windows 10 and is perfectly functional as far as we have been able to check.", "sentence_left": "Within the toolset of the different APT groups, one of the most interesting elements and the one that generally worries the most, are their capabilities in Ring0, generally RootKit/Bootkit type threats that act with the maximum level of privileges.", "sentence_right": "![](https://lab52.io/blog/wp-content/uploads/2020/01/Captura-de-pantalla-de-2020-01-13-11-32-47.png)", "label": "Emissary Panda", "label_id": 1335, "label_title": "Emissary Panda", "label_link": "http://www.bosch.com#node1fvup9pj1x44", "entity_class": "CE", "entity_type": "GROUP", "document": "lab52_2020-01-13_apt27-rootkit-updates"}
{"mention": "APT27", "context_left": "An example of this type of threats is the RootKit module of ZxShell RAT used by Emissary Panda (", "context_right": "), of which there is a relatively recent sample (Uploaded to Virustotal since 2019-09-21 17:59:39) that is also correctly signed, so it can be loaded in the latest version of Windows 10 and is perfectly functional as far as we have been able to check.", "_context_left": "An example of this type of threats is the RootKit module of ZxShell RAT used by Emissary Panda (", "_context_right": "), of which there is a relatively recent sample (Uploaded to Virustotal since 2019-09-21 17:59:39) that is also correctly signed, so it can be loaded in the latest version of Windows 10 and is perfectly functional as far as we have been able to check.", "sentence_left": "Within the toolset of the different APT groups, one of the most interesting elements and the one that generally worries the most, are their capabilities in Ring0, generally RootKit/Bootkit type threats that act with the maximum level of privileges.", "sentence_right": "![](https://lab52.io/blog/wp-content/uploads/2020/01/Captura-de-pantalla-de-2020-01-13-11-32-47.png)", "label": "Emissary Panda", "label_id": 1335, "label_title": "Emissary Panda", "label_link": "http://www.bosch.com#node1fvup9pj1x44", "entity_class": "CE", "entity_type": "GROUP", "document": "lab52_2020-01-13_apt27-rootkit-updates"}
{"mention": "lab52", "context_left": "![](https://", "context_right": ".io/blog/wp-content/uploads/2020/01/Captura-de-pantalla-de-2020-01-13-11-32-47.png)", "_context_left": "![](https://", "_context_right": ".io/blog/wp-content/uploads/2020/01/Captura-de-pantalla-de-2020-01-13-11-32-47.png)", "sentence_left": "An example of this type of threats is the RootKit module of ZxShell RAT used by Emissary Panda (APT27), of which there is a relatively recent sample (Uploaded to Virustotal since 2019-09-21 17:59:39) that is also correctly signed, so it can be loaded in the latest version of Windows 10 and is perfectly functional as far as we have been able to check.", "sentence_right": "Sysmon DriverLoaded event", "label": "A company, abbreviated as co., is a legal entity made up of an association of people, be they natural, legal, or a mixture of both, for carrying on a commercial or industrial enterprise. Company members share a common purpose, and unite to focus their various talents and organize their collectively available skills or resources to achieve specific, declared goals. Companies take various forms, such as:   A company or association of persons can be created at law as a legal person so that the company in itself can accept limited liability for civil responsibility and taxation incurred as members perform (or fail to discharge) their duty within the publicly declared \"\"birth certificate\"\" or published policy.  Companies as legal persons may associate and register themselves collectively as other companies – often known as a corporate group. When a company closes, it may need a \"\"death certificate\"\" to avoid further legal obligations.", "label_id": 986634, "label_title": "Company", "label_link": "https://en.wikipedia.org/wiki?curid=4918223", "entity_class": "NE", "entity_type": "ORG", "document": "lab52_2020-01-13_apt27-rootkit-updates"}
{"mention": "GitHub", "context_left": "After analyzing this threat and describing its capabilities, he has rewritten the source code from a sample of this threat uploaded in 2018 to Virustotal, and published it in", "context_right": ", which greatly facilitates the analysis of newer versions.", "_context_left": "After analyzing this threat and describing its capabilities, he has rewritten the source code from a sample of this threat uploaded in 2018 to Virustotal, and published it in ", "_context_right": ", which greatly facilitates the analysis of newer versions.", "sentence_left": "A complete analysis of this threat can be found made by the analyst Ori Damari (@0xrepnz) in his blog (<https://repnz.github.io/posts/autochk-rootkit-analysis/>).", "sentence_right": "As he describes in his blog, the capabilities of this Rootkit are basically the following:", "label": "GitHub is an American company that provides hosting for software development version control using Git. It is a subsidiary of Microsoft, which acquired the company in 2018 for $7.5 billion. It offers all of the distributed version control and source code management (SCM) functionality of Git as well as adding its own features. It provides access control and several collaboration features such as bug tracking, feature requests, task management, and wikis for every project.  GitHub offers plans for free, professional, and enterprise accounts. Free GitHub accounts are commonly used to host open source projects. As of January 2019, GitHub offers unlimited private repositories to all plans, including free accounts. As of May 2019, GitHub reports having over 37 million users and more than 100 million repositories (including at least 28 million public repositories), making it the largest host of source code in the world.", "label_id": 2294705, "label_title": "GitHub", "label_link": "https://en.wikipedia.org/wiki?curid=18545292", "entity_class": "NE", "entity_type": "ORG", "document": "lab52_2020-01-13_apt27-rootkit-updates"}
{"mention": "Rootkit", "context_left": "As he describes in his blog, the capabilities of this", "context_right": "are basically the following:", "_context_left": "As he describes in his blog, the capabilities of this ", "_context_right": " are basically the following:", "sentence_left": "After analyzing this threat and describing its capabilities, he has rewritten the source code from a sample of this threat uploaded in 2018 to Virustotal, and published it in GitHub, which greatly facilitates the analysis of newer versions.", "sentence_right": "* **File Redirection**", "label": "Adversaries may use rootkits to hide the presence of programs, files, network connections, services, drivers, and other system components. Rootkits are programs that hide the existence of malware by intercepting/hooking and modifying operating system API calls that supply system information. (Citation: Symantec Windows Rootkits) Rootkits or rootkit enabling functionality may reside at the user or kernel level in the operating system or lower, to include a hypervisor, Master Boot Record, or [System Firmware](https://attack.mitre.org/techniques/T1542/001). (Citation: Wikipedia Rootkit) Rootkits have been seen for Windows, Linux, and Mac OS X systems. (Citation: CrowdStrike Linux Rootkit) (Citation: BlackHat Mac OSX Rootkit)", "label_id": 57, "label_title": "Rootkit", "label_link": "https://attack.mitre.org/techniques/T1014", "entity_class": "CE", "entity_type": "TECHNIQUE", "document": "lab52_2020-01-13_apt27-rootkit-updates"}
{"mention": "Redirect malicious files to benign files", "context_left": "–", "context_right": ".", "_context_left": "– ", "_context_right": ".", "sentence_left": "* **File Redirection**", "sentence_right": "If you try to call CreateFile() to open a malicious file you’ll get a handle to a benign file.", "label": "Adversaries may attempt to manipulate features of their artifacts to make them appear legitimate or benign to users and/or security tools. Masquerading occurs when the name or location of an object, legitimate or malicious, is manipulated or abused for the sake of evading defenses and observation. This may include manipulating file metadata, tricking users into misidentifying the file type, and giving legitimate task or service names. Renaming abusable system utilities to evade security monitoring is also a form of [Masquerading](https://attack.mitre.org/techniques/T1036).(Citation: LOLBAS Main Site)", "label_id": 142, "label_title": "Masquerading", "label_link": "https://attack.mitre.org/techniques/T1036", "entity_class": "CI", "entity_type": "TECHNIQUE", "document": "lab52_2020-01-13_apt27-rootkit-updates"}
{"mention": "you try to call CreateFile() to open a malicious file you’ll get a handle to a benign file.", "context_left": "If", "context_right": "", "_context_left": "If ", "_context_right": "", "sentence_left": "– Redirect malicious files to benign files.", "sentence_right": "![](https://lab52.io/blog/wp-content/uploads/2020/01/Captura-de-pantalla-de-2020-01-13-11-39-50_arrows-1024x435.png)", "label": "Adversaries may attempt to manipulate features of their artifacts to make them appear legitimate or benign to users and/or security tools. Masquerading occurs when the name or location of an object, legitimate or malicious, is manipulated or abused for the sake of evading defenses and observation. This may include manipulating file metadata, tricking users into misidentifying the file type, and giving legitimate task or service names. Renaming abusable system utilities to evade security monitoring is also a form of [Masquerading](https://attack.mitre.org/techniques/T1036).(Citation: LOLBAS Main Site)", "label_id": 142, "label_title": "Masquerading", "label_link": "https://attack.mitre.org/techniques/T1036", "entity_class": "CI", "entity_type": "TECHNIQUE", "document": "lab52_2020-01-13_apt27-rootkit-updates"}
{"mention": "lab52", "context_left": "![](https://", "context_right": ".io/blog/wp-content/uploads/2020/01/Captura-de-pantalla-de-2020-01-13-11-39-50_arrows-1024x435.png)", "_context_left": "![](https://", "_context_right": ".io/blog/wp-content/uploads/2020/01/Captura-de-pantalla-de-2020-01-13-11-39-50_arrows-1024x435.png)", "sentence_left": "If you try to call CreateFile() to open a malicious file you’ll get a handle to a benign file.", "sentence_right": "* **Network Connection Hiding**", "label": "A company, abbreviated as co., is a legal entity made up of an association of people, be they natural, legal, or a mixture of both, for carrying on a commercial or industrial enterprise. Company members share a common purpose, and unite to focus their various talents and organize their collectively available skills or resources to achieve specific, declared goals. Companies take various forms, such as:   A company or association of persons can be created at law as a legal person so that the company in itself can accept limited liability for civil responsibility and taxation incurred as members perform (or fail to discharge) their duty within the publicly declared \"\"birth certificate\"\" or published policy.  Companies as legal persons may associate and register themselves collectively as other companies – often known as a corporate group. When a company closes, it may need a \"\"death certificate\"\" to avoid further legal obligations.", "label_id": 986634, "label_title": "Company", "label_link": "https://en.wikipedia.org/wiki?curid=4918223", "entity_class": "NE", "entity_type": "ORG", "document": "lab52_2020-01-13_apt27-rootkit-updates"}
{"mention": "Network Connection Hiding", "context_left": "* **", "context_right": "**", "_context_left": "* **", "_context_right": "**", "sentence_left": "![](https://lab52.io/blog/wp-content/uploads/2020/01/Captura-de-pantalla-de-2020-01-13-11-39-50_arrows-1024x435.png)", "sentence_right": "– Hide network connections from tools like netstat,proceshacker…", "label": "Adversaries may attempt to hide artifacts associated with their behaviors to evade detection. Operating systems may have features to hide various artifacts, such as important system files and administrative task execution, to avoid disrupting user work environments and prevent users from changing files or features on the system. Adversaries may abuse these features to hide artifacts such as files, directories, user accounts, or other system activity to evade detection.(Citation: Sofacy Komplex Trojan)(Citation: Cybereason OSX Pirrit)(Citation: MalwareBytes ADS July 2015) Adversaries may also attempt to hide artifacts associated with malicious behavior by creating computing regions that are isolated from common security instrumentation, such as through the use of virtualization technology.(Citation: Sophos Ragnar May 2020)", "label_id": 486, "label_title": "Hide Artifacts", "label_link": "https://attack.mitre.org/techniques/T1564", "entity_class": "CI", "entity_type": "TECHNIQUE", "document": "lab52_2020-01-13_apt27-rootkit-updates"}
{"mention": "Hide network connections", "context_left": "–", "context_right": "from tools like netstat,proceshacker…", "_context_left": "– ", "_context_right": " from tools like netstat,proceshacker…", "sentence_left": "* **Network Connection Hiding**", "sentence_right": "We found interesting to analyze the differences between the 2018 version and the most recent 2019 version in order to try to identify new capabilities or changes in its capabilities.", "label": "Adversaries may attempt to hide artifacts associated with their behaviors to evade detection. Operating systems may have features to hide various artifacts, such as important system files and administrative task execution, to avoid disrupting user work environments and prevent users from changing files or features on the system. Adversaries may abuse these features to hide artifacts such as files, directories, user accounts, or other system activity to evade detection.(Citation: Sofacy Komplex Trojan)(Citation: Cybereason OSX Pirrit)(Citation: MalwareBytes ADS July 2015) Adversaries may also attempt to hide artifacts associated with malicious behavior by creating computing regions that are isolated from common security instrumentation, such as through the use of virtualization technology.(Citation: Sophos Ragnar May 2020)", "label_id": 486, "label_title": "Hide Artifacts", "label_link": "https://attack.mitre.org/techniques/T1564", "entity_class": "CI", "entity_type": "TECHNIQUE", "document": "lab52_2020-01-13_apt27-rootkit-updates"}
{"mention": "GitHub", "context_left": "After comparing both samples using the", "context_right": "source code, we have been able to see that most of the functions are identical, except for 5 of them (including the Driver’s entrypoint):", "_context_left": "After comparing both samples using the ", "_context_right": " source code, we have been able to see that most of the functions are identical, except for 5 of them (including the Driver’s entrypoint):", "sentence_left": "We found interesting to analyze the differences between the 2018 version and the most recent 2019 version in order to try to identify new capabilities or changes in its capabilities.", "sentence_right": "![](https://lab52.io/blog/wp-content/uploads/2020/01/Captura-de-pantalla-de-2020-01-10-14-25-57-1024x188.png)", "label": "GitHub is an American company that provides hosting for software development version control using Git. It is a subsidiary of Microsoft, which acquired the company in 2018 for $7.5 billion. It offers all of the distributed version control and source code management (SCM) functionality of Git as well as adding its own features. It provides access control and several collaboration features such as bug tracking, feature requests, task management, and wikis for every project.  GitHub offers plans for free, professional, and enterprise accounts. Free GitHub accounts are commonly used to host open source projects. As of January 2019, GitHub offers unlimited private repositories to all plans, including free accounts. As of May 2019, GitHub reports having over 37 million users and more than 100 million repositories (including at least 28 million public repositories), making it the largest host of source code in the world.", "label_id": 2294705, "label_title": "GitHub", "label_link": "https://en.wikipedia.org/wiki?curid=18545292", "entity_class": "NE", "entity_type": "ORG", "document": "lab52_2020-01-13_apt27-rootkit-updates"}
{"mention": "lab52", "context_left": "![](https://", "context_right": ".io/blog/wp-content/uploads/2020/01/Captura-de-pantalla-de-2020-01-10-14-25-57-1024x188.png)", "_context_left": "![](https://", "_context_right": ".io/blog/wp-content/uploads/2020/01/Captura-de-pantalla-de-2020-01-10-14-25-57-1024x188.png)", "sentence_left": "After comparing both samples using the GitHub source code, we have been able to see that most of the functions are identical, except for 5 of them (including the Driver’s entrypoint):", "sentence_right": "Identical functions in both versions", "label": "A company, abbreviated as co., is a legal entity made up of an association of people, be they natural, legal, or a mixture of both, for carrying on a commercial or industrial enterprise. Company members share a common purpose, and unite to focus their various talents and organize their collectively available skills or resources to achieve specific, declared goals. Companies take various forms, such as:   A company or association of persons can be created at law as a legal person so that the company in itself can accept limited liability for civil responsibility and taxation incurred as members perform (or fail to discharge) their duty within the publicly declared \"\"birth certificate\"\" or published policy.  Companies as legal persons may associate and register themselves collectively as other companies – often known as a corporate group. When a company closes, it may need a \"\"death certificate\"\" to avoid further legal obligations.", "label_id": 986634, "label_title": "Company", "label_link": "https://en.wikipedia.org/wiki?curid=4918223", "entity_class": "NE", "entity_type": "ORG", "document": "lab52_2020-01-13_apt27-rootkit-updates"}
{"mention": "lab52", "context_left": "![](https://", "context_right": ".io/blog/wp-content/uploads/2020/01/Captura-de-pantalla-de-2020-01-10-14-25-24.png)", "_context_left": "![](https://", "_context_right": ".io/blog/wp-content/uploads/2020/01/Captura-de-pantalla-de-2020-01-10-14-25-24.png)", "sentence_left": "Identical functions in both versions", "sentence_right": "Different functions", "label": "A company, abbreviated as co., is a legal entity made up of an association of people, be they natural, legal, or a mixture of both, for carrying on a commercial or industrial enterprise. Company members share a common purpose, and unite to focus their various talents and organize their collectively available skills or resources to achieve specific, declared goals. Companies take various forms, such as:   A company or association of persons can be created at law as a legal person so that the company in itself can accept limited liability for civil responsibility and taxation incurred as members perform (or fail to discharge) their duty within the publicly declared \"\"birth certificate\"\" or published policy.  Companies as legal persons may associate and register themselves collectively as other companies – often known as a corporate group. When a company closes, it may need a \"\"death certificate\"\" to avoid further legal obligations.", "label_id": 986634, "label_title": "Company", "label_link": "https://en.wikipedia.org/wiki?curid=4918223", "entity_class": "NE", "entity_type": "ORG", "document": "lab52_2020-01-13_apt27-rootkit-updates"}
{"mention": "focused on avoiding detections by slightly “obfuscating” some IOCs hardcoded as strings and code modification without impact in the capabilities on the driver", "context_left": "After analyzing the differences between this 5 funtcions, we have been able to observe that all the changes are", "context_right": "…", "_context_left": "After analyzing the differences between this 5 funtcions, we have been able to observe that all the changes are ", "_context_right": "…", "sentence_left": "Different functions", "sentence_right": "In total, there are three notable changes between the two versions:", "label": "Adversaries may attempt to make an executable or file difficult to discover or analyze by encrypting, encoding, or otherwise obfuscating its contents on the system or in transit. This is common behavior that can be used across different platforms and the network to evade defenses. Payloads may be compressed, archived, or encrypted in order to avoid detection. These payloads may be used during Initial Access or later to mitigate detection. Sometimes a user's action may be required to open and [Deobfuscate/Decode Files or Information](https://attack.mitre.org/techniques/T1140) for [User Execution](https://attack.mitre.org/techniques/T1204). The user may also be required to input a password to open a password protected compressed/encrypted file that was provided by the adversary. (Citation: Volexity PowerDuke November 2016) Adversaries may also used compressed or archived scripts, such as JavaScript. Portions of files can also be encoded to hide the plain-text strings that would otherwise help defenders with discovery. (Citation: Linux/Cdorked.A We Live Security Analysis) Payloads may also be split into separate, seemingly benign files that only reveal malicious functionality when reassembled. (Citation: Carbon Black Obfuscation Sept 2016) Adversaries may also obfuscate commands executed from payloads or directly via a [Command and Scripting Interpreter](https://attack.mitre.org/techniques/T1059). Environment variables, aliases, characters, and other platform/language specific semantics can be used to evade signature based detections and application control mechanisms. (Citation: FireEye Obfuscation June 2017) (Citation: FireEye Revoke-Obfuscation July 2017)(Citation: PaloAlto EncodedCommand March 2017)", "label_id": 544, "label_title": "Obfuscated Files or Information", "label_link": "https://attack.mitre.org/techniques/T1027", "entity_class": "CI", "entity_type": "TECHNIQUE", "document": "lab52_2020-01-13_apt27-rootkit-updates"}
{"mention": "lab52", "context_left": "![](https://", "context_right": ".io/blog/wp-content/uploads/2020/01/Captura-de-pantalla-de-2020-01-13-12-48-53.png)Old and New list of file names", "_context_left": "![](https://", "_context_right": ".io/blog/wp-content/uploads/2020/01/Captura-de-pantalla-de-2020-01-13-12-48-53.png)Old and New list of file names", "sentence_left": "* The first one basically consists in that they have reversed the list of strings that identify the files that the Driver hides by default when it is loaded:", "sentence_right": "At code level, the impact this has had is that the function that redirects these files, now uses the “wcrev” function that flips the strings before passing them to the function that hides the files:", "label": "A company, abbreviated as co., is a legal entity made up of an association of people, be they natural, legal, or a mixture of both, for carrying on a commercial or industrial enterprise. Company members share a common purpose, and unite to focus their various talents and organize their collectively available skills or resources to achieve specific, declared goals. Companies take various forms, such as:   A company or association of persons can be created at law as a legal person so that the company in itself can accept limited liability for civil responsibility and taxation incurred as members perform (or fail to discharge) their duty within the publicly declared \"\"birth certificate\"\" or published policy.  Companies as legal persons may associate and register themselves collectively as other companies – often known as a corporate group. When a company closes, it may need a \"\"death certificate\"\" to avoid further legal obligations.", "label_id": 986634, "label_title": "Company", "label_link": "https://en.wikipedia.org/wiki?curid=4918223", "entity_class": "NE", "entity_type": "ORG", "document": "lab52_2020-01-13_apt27-rootkit-updates"}
{"mention": "flips the strings before passing them to the function that hides the files", "context_left": "At code level, the impact this has had is that the function that redirects these files, now uses the “wcrev” function that", "context_right": ":", "_context_left": "At code level, the impact this has had is that the function that redirects these files, now uses the “wcrev” function that ", "_context_right": ":", "sentence_left": "![](https://lab52.io/blog/wp-content/uploads/2020/01/Captura-de-pantalla-de-2020-01-13-12-48-53.png)Old and New list of file names", "sentence_right": "![](https://lab52.io/blog/wp-content/uploads/2020/01/Captura-de-pantalla-de-2020-01-13-11-19-52Arrows-1024x346.png)", "label": "Adversaries may attempt to make an executable or file difficult to discover or analyze by encrypting, encoding, or otherwise obfuscating its contents on the system or in transit. This is common behavior that can be used across different platforms and the network to evade defenses. Payloads may be compressed, archived, or encrypted in order to avoid detection. These payloads may be used during Initial Access or later to mitigate detection. Sometimes a user's action may be required to open and [Deobfuscate/Decode Files or Information](https://attack.mitre.org/techniques/T1140) for [User Execution](https://attack.mitre.org/techniques/T1204). The user may also be required to input a password to open a password protected compressed/encrypted file that was provided by the adversary. (Citation: Volexity PowerDuke November 2016) Adversaries may also used compressed or archived scripts, such as JavaScript. Portions of files can also be encoded to hide the plain-text strings that would otherwise help defenders with discovery. (Citation: Linux/Cdorked.A We Live Security Analysis) Payloads may also be split into separate, seemingly benign files that only reveal malicious functionality when reassembled. (Citation: Carbon Black Obfuscation Sept 2016) Adversaries may also obfuscate commands executed from payloads or directly via a [Command and Scripting Interpreter](https://attack.mitre.org/techniques/T1059). Environment variables, aliases, characters, and other platform/language specific semantics can be used to evade signature based detections and application control mechanisms. (Citation: FireEye Obfuscation June 2017) (Citation: FireEye Revoke-Obfuscation July 2017)(Citation: PaloAlto EncodedCommand March 2017)", "label_id": 544, "label_title": "Obfuscated Files or Information", "label_link": "https://attack.mitre.org/techniques/T1027", "entity_class": "CI", "entity_type": "TECHNIQUE", "document": "lab52_2020-01-13_apt27-rootkit-updates"}
{"mention": "lab52", "context_left": "![](https://", "context_right": ".io/blog/wp-content/uploads/2020/01/Captura-de-pantalla-de-2020-01-13-11-19-52Arrows-1024x346.png)", "_context_left": "![](https://", "_context_right": ".io/blog/wp-content/uploads/2020/01/Captura-de-pantalla-de-2020-01-13-11-19-52Arrows-1024x346.png)", "sentence_left": "At code level, the impact this has had is that the function that redirects these files, now uses the “wcrev” function that flips the strings before passing them to the function that hides the files:", "sentence_right": "New code (Red) and old code (Green)", "label": "A company, abbreviated as co., is a legal entity made up of an association of people, be they natural, legal, or a mixture of both, for carrying on a commercial or industrial enterprise. Company members share a common purpose, and unite to focus their various talents and organize their collectively available skills or resources to achieve specific, declared goals. Companies take various forms, such as:   A company or association of persons can be created at law as a legal person so that the company in itself can accept limited liability for civil responsibility and taxation incurred as members perform (or fail to discharge) their duty within the publicly declared \"\"birth certificate\"\" or published policy.  Companies as legal persons may associate and register themselves collectively as other companies – often known as a corporate group. When a company closes, it may need a \"\"death certificate\"\" to avoid further legal obligations.", "label_id": 986634, "label_title": "Company", "label_link": "https://en.wikipedia.org/wiki?curid=4918223", "entity_class": "NE", "entity_type": "ORG", "document": "lab52_2020-01-13_apt27-rootkit-updates"}
{"mention": "Microsoft", "context_left": "* Secondly, they have tried to disguise their use of the undocumented", "context_right": "API “ObReferenceObjectByName”, which is used to get the pointer to the different Driver\\_Object drivers they intend to hook in each case.", "_context_left": "* Secondly, they have tried to disguise their use of the undocumented ", "_context_right": " API “ObReferenceObjectByName”, which is used to get the pointer to the different Driver\\_Object drivers they intend to hook in each case.", "sentence_left": "New code (Red) and old code (Green)", "sentence_right": "Until now, they had the name of this function in their strings, and used it to resolve it by passing its name to the MmGetSystemRoutineAddress API which returns a pointer to it.", "label": "Microsoft Corporation is an American multinational technology company with headquarters in Redmond, Washington. It develops, manufactures, licenses, supports and sells computer software, consumer electronics, personal computers, and related services. Its best known software products are the Microsoft Windows line of operating systems, the Microsoft Office suite, and the Internet Explorer and Edge Web browsers. Its flagship hardware products are the Xbox video game consoles and the Microsoft Surface lineup of touchscreen personal computers. As of 2016, it is the world's largest software maker by revenue, and one of the world's most valuable companies. The word \"Microsoft\" is a portmanteau of \"microcomputer\" and \"software\". Microsoft is ranked No. 30 in the 2018 Fortune 500 rankings of the largest United States corporations by total revenue.  Microsoft was founded by Bill Gates and Paul Allen on April 4, 1975, to develop and sell BASIC interpreters for the Altair 8800. It rose to dominate the personal computer operating system market with MS-DOS in the mid-1980s, followed by Microsoft Windows. The company's 1986 initial public offering (IPO), and subsequent rise in its share price, created three billionaires and an estimated 12,000 millionaires among Microsoft employees. Since the 1990s, it has increasingly diversified from the operating system market and has made a number of corporate acquisitions, their largest being the acquisition of LinkedIn for $26.2 billion in December 2016, followed by their acquisition of Skype Technologies for $8.5 billion in May 2011.  , Microsoft is market-dominant in the IBM PC compatible operating system market and the office software suite", "label_id": 9231, "label_title": "Microsoft", "label_link": "https://en.wikipedia.org/wiki?curid=19001", "entity_class": "NE", "entity_type": "ORG", "document": "lab52_2020-01-13_apt27-rootkit-updates"}
{"mention": "lab52", "context_left": "![](https://", "context_right": ".io/blog/wp-content/uploads/2020/01/Captura-de-pantalla-de-2020-01-13-11-34-49-1-1024x564.png)", "_context_left": "![](https://", "_context_right": ".io/blog/wp-content/uploads/2020/01/Captura-de-pantalla-de-2020-01-13-11-34-49-1-1024x564.png)", "sentence_left": "Now they only keep part of the name, and complete the rest in a slightly more complex way before calling MmGetSystemRoutineAddress by building it from characters they store in the registers and other areas of the binary:", "sentence_right": "*New code (Red) and old code (Green)*", "label": "A company, abbreviated as co., is a legal entity made up of an association of people, be they natural, legal, or a mixture of both, for carrying on a commercial or industrial enterprise. Company members share a common purpose, and unite to focus their various talents and organize their collectively available skills or resources to achieve specific, declared goals. Companies take various forms, such as:   A company or association of persons can be created at law as a legal person so that the company in itself can accept limited liability for civil responsibility and taxation incurred as members perform (or fail to discharge) their duty within the publicly declared \"\"birth certificate\"\" or published policy.  Companies as legal persons may associate and register themselves collectively as other companies – often known as a corporate group. When a company closes, it may need a \"\"death certificate\"\" to avoid further legal obligations.", "label_id": 986634, "label_title": "Company", "label_link": "https://en.wikipedia.org/wiki?curid=4918223", "entity_class": "NE", "entity_type": "ORG", "document": "lab52_2020-01-13_apt27-rootkit-updates"}
{"mention": "Finally, they have moved part of the logic of some functions to another point, maintaining the same functionality", "context_left": "*", "context_right": ".", "_context_left": "* ", "_context_right": ".", "sentence_left": "*New code (Red) and old code (Green)*", "sentence_right": "An example is the end of the driver entry function, where untill now, at the end they only called two functions that initialized the logic of hiding connections and redirecting files, and now, they have extracted part of the logic of these functions and moved it right after each one of them, but without any impact on the capabilities and behavior of the Driver:", "label": "Adversaries may attempt to make an executable or file difficult to discover or analyze by encrypting, encoding, or otherwise obfuscating its contents on the system or in transit. This is common behavior that can be used across different platforms and the network to evade defenses. Payloads may be compressed, archived, or encrypted in order to avoid detection. These payloads may be used during Initial Access or later to mitigate detection. Sometimes a user's action may be required to open and [Deobfuscate/Decode Files or Information](https://attack.mitre.org/techniques/T1140) for [User Execution](https://attack.mitre.org/techniques/T1204). The user may also be required to input a password to open a password protected compressed/encrypted file that was provided by the adversary. (Citation: Volexity PowerDuke November 2016) Adversaries may also used compressed or archived scripts, such as JavaScript. Portions of files can also be encoded to hide the plain-text strings that would otherwise help defenders with discovery. (Citation: Linux/Cdorked.A We Live Security Analysis) Payloads may also be split into separate, seemingly benign files that only reveal malicious functionality when reassembled. (Citation: Carbon Black Obfuscation Sept 2016) Adversaries may also obfuscate commands executed from payloads or directly via a [Command and Scripting Interpreter](https://attack.mitre.org/techniques/T1059). Environment variables, aliases, characters, and other platform/language specific semantics can be used to evade signature based detections and application control mechanisms. (Citation: FireEye Obfuscation June 2017) (Citation: FireEye Revoke-Obfuscation July 2017)(Citation: PaloAlto EncodedCommand March 2017)", "label_id": 544, "label_title": "Obfuscated Files or Information", "label_link": "https://attack.mitre.org/techniques/T1027", "entity_class": "CI", "entity_type": "TECHNIQUE", "document": "lab52_2020-01-13_apt27-rootkit-updates"}
{"mention": "lab52", "context_left": "![](https://", "context_right": ".io/blog/wp-content/uploads/2020/01/Captura-de-pantalla-de-2020-01-10-14-49-10-1024x130.png)", "_context_left": "![](https://", "_context_right": ".io/blog/wp-content/uploads/2020/01/Captura-de-pantalla-de-2020-01-10-14-49-10-1024x130.png)", "sentence_left": "An example is the end of the driver entry function, where untill now, at the end they only called two functions that initialized the logic of hiding connections and redirecting files, and now, they have extracted part of the logic of these functions and moved it right after each one of them, but without any impact on the capabilities and behavior of the Driver:", "sentence_right": "*New code (Red) and old code (Green)﻿*", "label": "A company, abbreviated as co., is a legal entity made up of an association of people, be they natural, legal, or a mixture of both, for carrying on a commercial or industrial enterprise. Company members share a common purpose, and unite to focus their various talents and organize their collectively available skills or resources to achieve specific, declared goals. Companies take various forms, such as:   A company or association of persons can be created at law as a legal person so that the company in itself can accept limited liability for civil responsibility and taxation incurred as members perform (or fail to discharge) their duty within the publicly declared \"\"birth certificate\"\" or published policy.  Companies as legal persons may associate and register themselves collectively as other companies – often known as a corporate group. When a company closes, it may need a \"\"death certificate\"\" to avoid further legal obligations.", "label_id": 986634, "label_title": "Company", "label_link": "https://en.wikipedia.org/wiki?curid=4918223", "entity_class": "NE", "entity_type": "ORG", "document": "lab52_2020-01-13_apt27-rootkit-updates"}
{"mention": "Sysmon DriverLoaded event", "context_left": "", "context_right": "", "_context_left": "", "_context_right": "", "sentence_left": "![](https://lab52.io/blog/wp-content/uploads/2020/01/Captura-de-pantalla-de-2020-01-13-11-32-47.png)", "sentence_right": "A complete analysis of this threat can be found made by the analyst Ori Damari (@0xrepnz) in his blog (<https://repnz.github.io/posts/autochk-rootkit-analysis/>).", "label": "No Annotation", "label_id": 1906, "label_title": "No Annotation", "label_link": "No Annotation", "entity_class": "CI", "entity_type": "TECHNIQUE", "document": "lab52_2020-01-13_apt27-rootkit-updates"}
{"mention": "In total, there are three notable changes between the two versions:", "context_left": "", "context_right": "", "_context_left": "", "_context_right": "", "sentence_left": "After analyzing the differences between this 5 funtcions, we have been able to observe that all the changes are focused on avoiding detections by slightly “obfuscating” some IOCs hardcoded as strings and code modification without impact in the capabilities on the driver…", "sentence_right": "* The first one basically consists in that they have reversed the list of strings that identify the files that the Driver hides by default when it is loaded:", "label": "No Annotation", "label_id": 1906, "label_title": "No Annotation", "label_link": "No Annotation", "entity_class": "CI", "entity_type": "TECHNIQUE", "document": "lab52_2020-01-13_apt27-rootkit-updates"}
{"mention": "Until now, they had the name of this function in their strings, and used it to resolve it by passing its name to the MmGetSystemRoutineAddress API which returns a pointer to it.", "context_left": "", "context_right": "", "_context_left": "", "_context_right": "", "sentence_left": "* Secondly, they have tried to disguise their use of the undocumented Microsoft API “ObReferenceObjectByName”, which is used to get the pointer to the different Driver\\_Object drivers they intend to hook in each case.", "sentence_right": "Now they only keep part of the name, and complete the rest in a slightly more complex way before calling MmGetSystemRoutineAddress by building it from characters they store in the registers and other areas of the binary:", "label": "No Annotation", "label_id": 1906, "label_title": "No Annotation", "label_link": "No Annotation", "entity_class": "CI", "entity_type": "TECHNIQUE", "document": "lab52_2020-01-13_apt27-rootkit-updates"}
{"mention": "*New code (Red) and old code (Green)*", "context_left": "", "context_right": "", "_context_left": "", "_context_right": "", "sentence_left": "![](https://lab52.io/blog/wp-content/uploads/2020/01/Captura-de-pantalla-de-2020-01-13-11-34-49-1-1024x564.png)", "sentence_right": "* Finally, they have moved part of the logic of some functions to another point, maintaining the same functionality.", "label": "No Annotation", "label_id": 1906, "label_title": "No Annotation", "label_link": "No Annotation", "entity_class": "CI", "entity_type": "TECHNIQUE", "document": "lab52_2020-01-13_apt27-rootkit-updates"}
{"mention": "| x86 Sample | 9b7c1e37d5f56cc0b5e5e22ce9805e237a189297e78405b9c392a0953b6e0321 |", "context_left": "", "context_right": "", "_context_left": "", "_context_right": "", "sentence_left": "| x64 Sample | 42eab05c611bf24d86bb6c985caa2ad7380ed7d98340c7f08de9361be14dc244 |", "sentence_right": "", "label": "No Annotation", "label_id": 1906, "label_title": "No Annotation", "label_link": "No Annotation", "entity_class": "CI", "entity_type": "TECHNIQUE", "document": "lab52_2020-01-13_apt27-rootkit-updates"}
{"mention": "| x64 Sample | 42eab05c611bf24d86bb6c985caa2ad7380ed7d98340c7f08de9361be14dc244 |", "context_left": "", "context_right": "", "_context_left": "", "_context_right": "", "sentence_left": "*New code (Red) and old code (Green)﻿*", "sentence_right": "| x86 Sample | 9b7c1e37d5f56cc0b5e5e22ce9805e237a189297e78405b9c392a0953b6e0321 |", "label": "No Annotation", "label_id": 1906, "label_title": "No Annotation", "label_link": "No Annotation", "entity_class": "CI", "entity_type": "TECHNIQUE", "document": "lab52_2020-01-13_apt27-rootkit-updates"}
{"mention": "* The first one basically consists in that they have reversed the list of strings that identify the files that the Driver hides by default when it is loaded:", "context_left": "", "context_right": "", "_context_left": "", "_context_right": "", "sentence_left": "In total, there are three notable changes between the two versions:", "sentence_right": "![](https://lab52.io/blog/wp-content/uploads/2020/01/Captura-de-pantalla-de-2020-01-13-12-48-53.png)Old and New list of file names", "label": "No Annotation", "label_id": 1906, "label_title": "No Annotation", "label_link": "No Annotation", "entity_class": "CI", "entity_type": "TECHNIQUE", "document": "lab52_2020-01-13_apt27-rootkit-updates"}
{"mention": "January 13, 2020", "context_left": "", "context_right": "", "_context_left": "", "_context_right": "", "sentence_left": "APT27 ZxShell RootKit module updates", "sentence_right": "Within the toolset of the different APT groups, one of the most interesting elements and the one that generally worries the most, are their capabilities in Ring0, generally RootKit/Bootkit type threats that act with the maximum level of privileges.", "label": "No Annotation", "label_id": 1906, "label_title": "No Annotation", "label_link": "No Annotation", "entity_class": "CI", "entity_type": "TECHNIQUE", "document": "lab52_2020-01-13_apt27-rootkit-updates"}
{"mention": "An example is the end of the driver entry function, where untill now, at the end they only called two functions that initialized the logic of hiding connections and redirecting files, and now, they have extracted part of the logic of these functions and moved it right after each one of them, but without any impact on the capabilities and behavior of the Driver:", "context_left": "", "context_right": "", "_context_left": "", "_context_right": "", "sentence_left": "* Finally, they have moved part of the logic of some functions to another point, maintaining the same functionality.", "sentence_right": "![](https://lab52.io/blog/wp-content/uploads/2020/01/Captura-de-pantalla-de-2020-01-10-14-49-10-1024x130.png)", "label": "No Annotation", "label_id": 1906, "label_title": "No Annotation", "label_link": "No Annotation", "entity_class": "CI", "entity_type": "TECHNIQUE", "document": "lab52_2020-01-13_apt27-rootkit-updates"}
{"mention": "Now they only keep part of the name, and complete the rest in a slightly more complex way before calling MmGetSystemRoutineAddress by building it from characters they store in the registers and other areas of the binary:", "context_left": "", "context_right": "", "_context_left": "", "_context_right": "", "sentence_left": "Until now, they had the name of this function in their strings, and used it to resolve it by passing its name to the MmGetSystemRoutineAddress API which returns a pointer to it.", "sentence_right": "![](https://lab52.io/blog/wp-content/uploads/2020/01/Captura-de-pantalla-de-2020-01-13-11-34-49-1-1024x564.png)", "label": "No Annotation", "label_id": 1906, "label_title": "No Annotation", "label_link": "No Annotation", "entity_class": "CI", "entity_type": "TECHNIQUE", "document": "lab52_2020-01-13_apt27-rootkit-updates"}
{"mention": "New code (Red) and old code (Green)", "context_left": "", "context_right": "", "_context_left": "", "_context_right": "", "sentence_left": "![](https://lab52.io/blog/wp-content/uploads/2020/01/Captura-de-pantalla-de-2020-01-13-11-19-52Arrows-1024x346.png)", "sentence_right": "* Secondly, they have tried to disguise their use of the undocumented Microsoft API “ObReferenceObjectByName”, which is used to get the pointer to the different Driver\\_Object drivers they intend to hook in each case.", "label": "No Annotation", "label_id": 1906, "label_title": "No Annotation", "label_link": "No Annotation", "entity_class": "CI", "entity_type": "TECHNIQUE", "document": "lab52_2020-01-13_apt27-rootkit-updates"}
{"mention": "*New code (Red) and old code (Green)﻿*", "context_left": "", "context_right": "", "_context_left": "", "_context_right": "", "sentence_left": "![](https://lab52.io/blog/wp-content/uploads/2020/01/Captura-de-pantalla-de-2020-01-10-14-49-10-1024x130.png)", "sentence_right": "| x64 Sample | 42eab05c611bf24d86bb6c985caa2ad7380ed7d98340c7f08de9361be14dc244 |", "label": "No Annotation", "label_id": 1906, "label_title": "No Annotation", "label_link": "No Annotation", "entity_class": "CI", "entity_type": "TECHNIQUE", "document": "lab52_2020-01-13_apt27-rootkit-updates"}
{"mention": "A complete analysis of this threat can be found made by the analyst Ori Damari (@0xrepnz) in his blog (<https://repnz.github.io/posts/autochk-rootkit-analysis/>).", "context_left": "", "context_right": "", "_context_left": "", "_context_right": "", "sentence_left": "Sysmon DriverLoaded event", "sentence_right": "After analyzing this threat and describing its capabilities, he has rewritten the source code from a sample of this threat uploaded in 2018 to Virustotal, and published it in GitHub, which greatly facilitates the analysis of newer versions.", "label": "No Annotation", "label_id": 1906, "label_title": "No Annotation", "label_link": "No Annotation", "entity_class": "CI", "entity_type": "TECHNIQUE", "document": "lab52_2020-01-13_apt27-rootkit-updates"}
{"mention": "* **File Redirection**", "context_left": "", "context_right": "", "_context_left": "", "_context_right": "", "sentence_left": "As he describes in his blog, the capabilities of this Rootkit are basically the following:", "sentence_right": "– Redirect malicious files to benign files.", "label": "No Annotation", "label_id": 1906, "label_title": "No Annotation", "label_link": "No Annotation", "entity_class": "CI", "entity_type": "TECHNIQUE", "document": "lab52_2020-01-13_apt27-rootkit-updates"}
{"mention": "Different functions", "context_left": "", "context_right": "", "_context_left": "", "_context_right": "", "sentence_left": "![](https://lab52.io/blog/wp-content/uploads/2020/01/Captura-de-pantalla-de-2020-01-10-14-25-24.png)", "sentence_right": "After analyzing the differences between this 5 funtcions, we have been able to observe that all the changes are focused on avoiding detections by slightly “obfuscating” some IOCs hardcoded as strings and code modification without impact in the capabilities on the driver…", "label": "No Annotation", "label_id": 1906, "label_title": "No Annotation", "label_link": "No Annotation", "entity_class": "CI", "entity_type": "TECHNIQUE", "document": "lab52_2020-01-13_apt27-rootkit-updates"}
{"mention": "We found interesting to analyze the differences between the 2018 version and the most recent 2019 version in order to try to identify new capabilities or changes in its capabilities.", "context_left": "", "context_right": "", "_context_left": "", "_context_right": "", "sentence_left": "– Hide network connections from tools like netstat,proceshacker…", "sentence_right": "After comparing both samples using the GitHub source code, we have been able to see that most of the functions are identical, except for 5 of them (including the Driver’s entrypoint):", "label": "No Annotation", "label_id": 1906, "label_title": "No Annotation", "label_link": "No Annotation", "entity_class": "CI", "entity_type": "TECHNIQUE", "document": "lab52_2020-01-13_apt27-rootkit-updates"}
{"mention": "Identical functions in both versions", "context_left": "", "context_right": "", "_context_left": "", "_context_right": "", "sentence_left": "![](https://lab52.io/blog/wp-content/uploads/2020/01/Captura-de-pantalla-de-2020-01-10-14-25-57-1024x188.png)", "sentence_right": "![](https://lab52.io/blog/wp-content/uploads/2020/01/Captura-de-pantalla-de-2020-01-10-14-25-24.png)", "label": "No Annotation", "label_id": 1906, "label_title": "No Annotation", "label_link": "No Annotation", "entity_class": "CI", "entity_type": "TECHNIQUE", "document": "lab52_2020-01-13_apt27-rootkit-updates"}