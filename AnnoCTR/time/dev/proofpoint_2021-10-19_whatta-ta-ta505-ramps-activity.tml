<?xml version="1.0"?>
<TimeML xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="http://timeml.org/timeMLdocs/TimeML_1.2.1.xsd">
<DCT><TIMEX3 functionInDocument="CREATION_TIME" temporalFunction="false" tid="t0" type="DATE" value="2021-10-19">2021-10-19</TIMEX3></DCT>
<TEXT>
Whatta TA: TA505 Ramps Up Activity, Delivers New FlawedGrace Variant  <TIMEX3 tid="t1" type="DATE" value="2021-10-19">October 19, 2021</TIMEX3>  ### **Key Takeaways**  * The prominent TA505 has returned to distributing large volumes of malicious emails affecting most industries.  * New tools include a KiXtart Loader, the MirrorBlast loader, an updated FlawedGrace variant, and updated malicious Excel attachments.  * One of the region-specific campaigns targeted German-speaking countries, notably Germany and Austria.  * The campaigns share many similarities with TA505 campaigns from <TIMEX3 tid="t2" type="DATE" value="2019">2019</TIMEX3> and <TIMEX3 tid="t3" type="DATE" value="2020">2020</TIMEX3>.  ### **Overview**  Since early <TIMEX3 tid="t4" type="DATE" value="2021-09">September 2021</TIMEX3>, Proofpoint researchers are tracking renewed malware campaigns by the financially driven [TA505](/us/threat-insight/post/threat-actor-profile-ta505-dridex-globeimposter "Threat Actor Profile: TA505, From Dridex to GlobeImposter").  The campaigns, which are distributed across a wide range of industries, started with low volume email waves that ramped up in late <TIMEX3 tid="t5" type="DATE" value="2021-09">September</TIMEX3>, resulting in tens to hundreds of thousands of emails.  Many of the campaigns, especially the large volume ones, strongly resemble the historic TA505 activity from <TIMEX3 tid="t6" type="DATE" value="2019">2019</TIMEX3> and <TIMEX3 tid="t7" type="DATE" value="2020">2020</TIMEX3>.  The commonalities include similar domain naming conventions, email lures, Excel file lures, and the delivery of the FlawedGrace remote access trojan (RAT).  The campaigns also contain some noteworthy, new developments, such as retooled intermediate loader stages scripted in Rebol and KiXtart, which are used instead of the previously popular Get2 downloader.  The new downloaders perform similar functionality of reconnaissance and pulling in the next stages.  Lastly, there is an updated version of FlawedGrace.  ### **Evolving Campaigns**  The initial campaigns observed by Proofpoint in <TIMEX3 tid="t8" type="DATE" value="2021-09">September 2021</TIMEX3> were comparatively small in volume, several thousand emails per wave, and delivered malicious Excel attachments.  In late <TIMEX3 tid="t9" type="DATE" value="2021-09">September</TIMEX3> and in early <TIMEX3 tid="t10" type="DATE" value="2021-10">October 2021</TIMEX3> this changed, and TA505 began sending higher email volumes, tens to hundreds of thousands, to more industries.  Additionally, the actor began leveraging both URL and attachment-based email campaigns and diversified from targeting predominantly North America to also targeting German-speaking countries, including Germany and Austria.  ### **<TIMEX3 tid="t11" type="DATE" value="2021-09">September 2021</TIMEX3> Campaigns**  The early campaigns identified by Proofpoint in <TIMEX3 tid="t12" type="DATE" value="2021-09">September 2021</TIMEX3> were low volume compared to typical TA505 activity, with only several thousand messages per wave.  TA505 used more specific lures that did not affect as many industries as the more recent <TIMEX3 tid="t13" type="DATE" value="2021-10">October 2021</TIMEX3> campaigns.  Example lures included legal, media release, situation report, and health claim themes.  These early campaigns also largely focused on targets in North America, such as United States and Canada.  The emails contained an Excel attachment that, when opened and macros enabled, would lead to the download and running of an MSI file.  The MSI file in turn would execute an embedded Rebol loader, dubbed by Proofpoint as MirrorBlast.  ![image-20211015150648-1](/sites/default/files/inline-images/image-20211015150648-1.jpeg)  *Figure 1. Email purporting to be from an insurance claims analyst, part of the <TIMEX3 tid="t14" type="DATE" value="2021-09-28">September 28, 2021</TIMEX3> campaign.*  ![image-20211015150648-2](/sites/default/files/inline-images/image-20211015150648-2.png)  *Figure 2. The insurance claim Excel attachment, part of the <TIMEX3 tid="t15" type="DATE" value="2021-09-28">September 28, 2021</TIMEX3> campaign.*  ### **<TIMEX3 tid="t16" type="DATE" value="2021-10">October 2021</TIMEX3> Campaigns**  In late <TIMEX3 tid="t17" type="DATE" value="2021-09">September</TIMEX3> and throughout <TIMEX3 tid="t18" type="DATE" value="2021-10">October 2021</TIMEX3>, Proofpoint observed a shift to familiar TA505 tactics, techniques, and procedures (TTPs) that are reminiscent of the actor’s <TIMEX3 tid="t19" type="DATE" value="2019">2019</TIMEX3> and <TIMEX3 tid="t20" type="DATE" value="2020">2020</TIMEX3> campaigns.  An additional intermediary loader scripted in KiXtart was introduced, and the attack chain evolved to the following:  * An email containing one of the below:   + Excel attachment   + HTML attachment that links to the download of an Excel file   + URL linking to a landing page that redirects to the download of an Excel file   + URL directly linking to an Excel file  * The Excel file macros download and run an MSI file  * The MSI file executes an embedded KiXtart loader  * The KiXtart loader receives a command from the C&C server to download another MSI file that executes MirrorBlast  * MirrorBlast then downloads additional Rebol script stagers  * The follow-on Rebol stagers drop ReflectiveGnome  * ReflectiveGnome in turn downloads more shellcode, that will then drop and detonate FlawedGrace  The email lures moved away from the detailed lures seen initially in this spate of campaigns.  They became more generic, with subjects such as “SECUREFILE,” “SECURE DOCUMENT,” and “You’ve been sent a secure message.  Additionally, the themes and abused brands included COVID-19, DocuSign, insurance, invoices, and Microsoft.  ![image-20211015150648-3](/sites/default/files/inline-images/image-20211015150648-3.jpeg)  *Figure 3.* *<TIMEX3 tid="t21" type="DATE" value="2021-10-13">October 13, 2021</TIMEX3>* *German-language email* *using a OneDrive shared file lure.*  ![image-20211015150648-4](/sites/default/files/inline-images/image-20211015150648-4.png)  *Figure 4. <TIMEX3 tid="t22" type="DATE" value="2021-10-13">October 13, 2021</TIMEX3> landing page abusing Microsoft and OneDrive branding.*  ![image-20211015150648-5](/sites/default/files/inline-images/image-20211015150648-5.png)  *Figure 5. Excel file used in the <TIMEX3 tid="t23" type="DATE" value="2021-10-13">October 13, 2021</TIMEX3> campaign with a simple green lure.*  ### **Similarities to Historic TA505 Activity**  There is much similarity between the new and historic TA505 campaigns, starting with the **emails**.  ![image-20211015150648-6](/sites/default/files/inline-images/image-20211015150648-6.png)  *Figure 6. The OneDrive shared file email lure used in <TIMEX3 tid="t24" type="DATE" value="2020-08-21">August 21, 2020</TIMEX3> (left) strongly resembles a similar email from <TIMEX3 tid="t25" type="DATE" value="2021-10-07">October 7, 2021</TIMEX3> (right).  Note the additional use of a COVID-19 theme in the recent campaign.*   The **landing pages** in historic and current TA505 campaigns contain “IP Logger” links that likely enable TA505 to track the IP addresses of the machines downloading the malicious files.  Additionally, TA505 is still mimicking file hosting services in the landing pages.  ![image-20211015150648-7](/sites/default/files/inline-images/image-20211015150648-7.png)  *Figure 7. The landing page used in a <TIMEX3 tid="t26" type="DATE" value="2019-11-21">November 21, 2019</TIMEX3> campaign is shown on the left, while the landing page used in the <TIMEX3 tid="t27" type="DATE" value="2021-10-07">October 7, 2021</TIMEX3> campaign is shown on the right.*  While the Excel macros VBA code in the recent TA505 campaigns is different, some of the **Excel graphic lures** are similar or identical to those previously used by TA505.  ![image-20211015150648-8](/sites/default/files/inline-images/image-20211015150648-8.png)  *Figure 8. The Excel sheet lure spoofing Microsoft logos remained identical from <TIMEX3 tid="t28" type="DATE" value="2020-09-02">September 2, 2020</TIMEX3> (Left) to <TIMEX3 tid="t29" type="DATE" value="2021-10-06">October 6, 2021</TIMEX3> (Right).*  **Domain naming conventions:** It is also notable that TA505 has historically used domains that mimic various file hosting service providers and structured them in formats with hyphen separated terms.  The domains used in late <TIMEX3 tid="t30" type="DATE" value="2021-09">September 2021</TIMEX3> and onward follow this structure.  **Code reuse**: Proofpoint researchers found code reuse in parts of the delivery chain such as in multiple parts of the landing page (see [an example mentioned here](https://twitter.com/stoerchl/status/1448561662181658628)).  ### **Excel Macros Analysis**  For TA505’s <TIMEX3 tid="t31" type="DATE" value="2021">2021</TIMEX3> campaigns to be successful, potential victims must enable macros after opening the malicious Excel files.  The code responsible for downloading the next stage MSI file was typically lightly obfuscated with filler characters, string reversing or similar simple functions and hidden in the document Comments, Title, in a Cell or other locations.  ![image-20211015150648-9](/sites/default/files/inline-images/image-20211015150648-9.png)  *Figure 9. Example Excel macros code.*  ![image-20211015150648-10](/sites/default/files/inline-images/image-20211015150648-10.png)  *Figure 10. The parameters Subject and Comments are stored in the workbook properties.*  ![image-20211015150648-11](/sites/default/files/inline-images/image-20211015150648-11.png)  *Figure 11. Deobfuscated downloader JScript. This pulls the next stage—an MSI file.*  ### **Intermediate Loaders**  TA505 now uses multiple intermediate loaders before the delivery of the FlawedGrace RAT. The new loader stages are coded in uncommon scripting languages—Rebol and KiXtart.  They appear to serve the same purpose as [Get2](https://www.proofpoint.com/us/threat-insight/post/ta505-distributes-new-sdbbot-remote-access-trojan-get2-downloader) — a downloader that has been in use by TA505 since <TIMEX3 tid="t32" type="DATE" value="2019">2019</TIMEX3> to deliver a variety of secondary payloads.  The loaders perform minimal reconnaissance of an infected machine, such as collecting user domain and username information, and download further payloads.  ![downloads](/sites/default/files/inline-images/MicrosoftTeams-image%20%2818%29_1.png)  *Figure 12. Attack paths ultimately leading to FlawedGrace.*  In the attack chain, the Excel macros download the first MSI file, which executes the first loader, encoded in KiXtart scripting language.  The KiXtart interpreter then receives a command from the C&C server to download a follow-on MSI package.  Of note, KiXtart loader is not always part of the attack chain.  The second MSI package contains multiple files that may have different names, for example, AudioDriver.exe (the Rebol interpreter), AudioDriver.exe.lnk (command that informs .ico execution), and image.ico (the Rebol script).  This Rebol script is the second new downloader in the chain, that Proofpoint dubbed MirrorBlast.  ![image-20211015150649-13](/sites/default/files/inline-images/image-20211015150649-13.png)  *Figure 13. Example of MirrorBlast script, it may be slightly different in different campaigns.*  MirrorBlast in turn downloads additional Rebol script stagers that execute simple downloaders, dubbed by Proofpoint as ReflectiveGnome.  ReflectiveGnome in turn downloads more shellcode, that will then drop and detonate FlawedGrace.  ![image-20211015150649-14](/sites/default/files/inline-images/image-20211015150649-14.png)  *Figure 14. Rebol script downloaded by MirrorBlast that drops ReflectiveGnome loader (dwm-x64.exe / dwm-x32.exe).*  ![image-20211015150649-15](/sites/default/files/inline-images/image-20211015150649-15.png)  *Figure 15. ReflectiveGnome loader which executes the next stage as a shellcode.*  ![image-20211015150649-16](/sites/default/files/inline-images/image-20211015150649-16.png)  *Figure 16. This shellcode drops and detonates an updated FlawedGrace.*  ### **Updated FlawedGrace RAT**  Proofpoint researchers first observed [FlawedGrace](/us/threat-insight/post/servhelper-and-flawedgrace-new-malware-introduced-ta505 "ServHelper and FlawedGrace - New malware introduced by TA505") in <TIMEX3 tid="t33" type="DATE" value="2017-11">November 2017</TIMEX3>.  It is a full-featured RAT written in C++ that can receive the following commands from its C&C via a custom binary protocol on TCP port 443:   * target\_remove  * target\_update  * target\_reboot  * target\_module\_load  * target\_module\_load\_external  * target\_module\_unload  * target\_download  * target\_upload  * target\_rdp  * target\_passwords  * target\_servers  * target\_script  * destroy\_os  * desktop\_stat  While Proofpoint researchers are still investigating the updates to this version of FlawedGrace, some notable changes include:  * Encrypted strings  * Obfuscated API calls  * Configuration is now stored as an encrypted resource (initial/default config), then it is stored both in a mapped memory region (current configuration instance) and in the registry (persistence)  ### **Attribution**  Proofpoint attributes the campaigns discussed in this blog to TA505 with high confidence.  Proofpoint's assessment that TA505 is responsible for this renewed activity is based on the aforementioned similarities between historic TA505 campaigns and this new activity, including, but not limited to, code similarities, domain naming patterns and the use of FlawedGrace, which has been almost exclusively linked to TA505 activity.  ### **Outlook**  TA505 is an established threat actor that is financially motivated and known for conducting malicious email campaigns on a previously unprecedented scale.  The group regularly changes their TTPs and are considered [trendsetters](/us/threat-insight/post/servhelper-and-flawedgrace-new-malware-introduced-ta505 "ServHelper and FlawedGrace - New malware introduced by TA505") in the world of cybercrime.  This threat actor does not limit its target set, and is, in fact, an equal opportunist with the geographies and verticals it chooses to attack.  This combined with TA505’s ability to be flexible, focusing on what is the most lucrative and shifting its TTPs as necessary, make the actor a continued threat.  Proofpoint researchers expect TA505 to continue to adjust its operations and methods always with an eye to financial gain.  Using intermediate loaders in its attack chain is also likely to become a longer-term technique employed by the threat actor.  #### **EmergingThreats Detection Rules**  2034012 - ET TROJAN MirrorBlast Checkin (trojan.rules)  2034022 - ET TROJAN MirrorBlast CnC Activity M2 (trojan.rules)  2034023 - ET TROJAN MirrorBlast CnC Activity M3 (trojan.rules)  2034091 - ET TROJAN MirrorBlast KiXtart Downloader Client Request (trojan.rules)  2034110 - ET TROJAN MirrorBlast KiXtart Downloader Server Response (trojan.rules)  2034136 - ET TROJAN MirrorBlast KiXtart Downloader Client Request M2 (trojan.rules)  2034042 - ET TROJAN ReflectiveGnome Download Activity (trojan.rules)  #### **EmergingThreats PRO Detection Rules**  2850099 - ETPRO TROJAN FlawedGrace CnC Activity M2 (trojan.rules)  2850098 - ETPRO TROJAN FlawedGrace CnC Activity M1 (trojan.rules)  #### **Indicators of Compromise**  | **IOC** | **IOC Type** | **Description** |  | hxxp://139.59.93.223/c[.]php | URL | MirrorBlast C&C |  | hxxp://menorukis[.]su | URL | MirrorBlast C&C |  | hxxp://fidufagios[.]com/ | URL | MirrorBlast C&C |  | hxxp://feristoaul[.]com/ | URL | MirrorBlast C&C |  | hxxp://172.105.178.119/install[.]msi | URL | MSI Download |  | hxxp://207.246.101.153/chrome[.]msi | URL | MSI Download |  | hxxp://207.246.101.153/setup[.]msi | URL | MSI Download |  | cdn-wfs-nspod[.]com | Domain | FlawedGrace C&C |  | hxxps://cdn03664-dl-fileshare[.]com/files/xls/Employee%20Update%20-%20Covid[.]xls | URL | Initial Download |  | hxxps://cdn-8846-sharepoint-office[.]com/CL09302021\_00137[.]xls | URL | Initial Download |  | hxxps://cdn-8846-sharepoint-office[.]com/COVID19\_list[.]xls | URL | Initial Download |  | hxxps://cdn-8846-sharepoint-office[.]com/FP01102021\_001[.]xls | URL | Initial Download |  | hxxps://dzikic-my-sharepoint[.]com/file/Manulife\_policy[.]xls | URL | Initial Download |  | hxxps://dzikics-my-sharepoint[.]com/file/Employee\_Authorization\_Form[.]xls | URL | Initial Download |  | hxxp://141.164.41[.]231/host64\_sh[.]bin | URL | MirrorBlast Payload (FlawedGrace) |  | hxxp://141.164.41[.]231/host32\_pic[.]bin | URL | MirrorBlast Payload (FlawedGrace) |  | hxxp://89.44.197[.]46/host64\_sh[.]bin | URL | MirrorBlast Payload (FlawedGrace) |  | hxxp://89.44.197[.]46/host32\_pic[.]bin | URL | MirrorBlast Payload (FlawedGrace) |  | hxxp://193.42.36[.]110/host64\_sh[.]bin | URL | MirrorBlast Payload (FlawedGrace) |  | hxxp://193.42.36[.]110/host32\_pic[.]bin | URL | MirrorBlast Payload (FlawedGrace) |  | hxxp://5.149.255[.]14/host64\_sh[.]bin | URL | MirrorBlast Payload (FlawedGrace) |  | hxxp://5.149.255[.]14/host32\_pic[.]bin | URL | MirrorBlast Payload (FlawedGrace) |  | hxxp://155.138.205[.]35/?pool | URL | First Stage Kixtart Script Payload |  | hxxp://45.79.239[.]23/version.php?data= | URL | First Stage Kixtart Script C&C |  | hxxp://185.202.93[.]201:80/mlp[.]php | URL | First Stage Kixtart Script C&C |  | hxxp://185.183.96[.]147/?data= | URL | First Stage Kixtart Script C&C |  | hxxp://185.176.220[.]198/?data= | URL | First Stage Kixtart Script C&C |  | hxxp://155.138.205[.]35/ | URL | Excel MSI Payload |  | hxxp://95.216.138[.]82/ | URL | Excel MSI Payload |  | hxxp://194.180.174[.]6/ | URL | Excel MSI Payload |  | hxxp://185.10.68[.]235/ | URL | Excel MSI Payload |  | hxxp://185.225.19[.]246/ | URL | Excel MSI Payload |  | hxxp://185.225.19[.]156/ | URL | Kixtart Payload (MirrorBlast) |  | hxxp://192.36.27[.]92/10opd3r\_load[.]msi | URL | Kixtart Payload (MirrorBlast) |  | hxxp://5.188.108[.]40/trehjugdr4et6u[.]msi | URL | Kixtart Payload (MirrorBlast) |  
</TEXT>
</TimeML>